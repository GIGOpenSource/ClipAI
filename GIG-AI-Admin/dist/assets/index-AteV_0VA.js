import{r as n,w as te,o as re,c as x,a as u,b as r,t as g,d as s,e as t,g as S,f as v,h as d,u as o,F as q,i as O,j as w,n as se,k as G,l as y,v as k,p as le}from"./index-C_WH1cgn.js";import{_ as oe,a as de}from"./AdminLayout-aCla68Vk.js";import{_ as ie}from"./Primitive-rbbPGzXt.js";import{_ as h}from"./Button.vue_vue_type_script_setup_true_lang-C7mE4dwR.js";import{_ as ne,a as ue,b as E,c as $,d as pe,e as _,f as ge,g as fe,h as me,i as ce,j as be,k as ve}from"./PaginationPrevious.vue_vue_type_script_setup_true_lang-BaJMHx_t.js";import{_ as H,a as ye}from"./DeleteConfirmDialog-Dv8WvOx6.js";import{a as xe,u as we,c as ke,b as _e,d as he}from"./index-D6Vgu1Lv.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./http-BKvr1fmS.js";const $e={class:"space-y-5 sm:space-y-6"},Ce={class:"mb-4 flex items-center justify-between"},Ue={class:"flex items-center justify-end gap-2"},Ve=["onClick"],De={key:0,class:"mt-4"},Se={class:"relative z-10 w-full max-w-xl rounded-xl bg-white p-6 shadow-lg dark:bg-gray-900"},Me={class:"mb-4 text-lg font-semibold"},je={key:0,class:"space-y-3"},ze={key:1,class:"space-y-3"},Be={class:"flex justify-end gap-3 pt-2"},Le={class:"relative z-10 w-full max-w-xl rounded-xl bg-white p-6 shadow-lg dark:bg-gray-900"},Te={class:"flex justify-end gap-3 pt-2"},Pe={key:0,class:"mr-2"},Je={__name:"index",setup(Re){const J=n("AI 用户列表"),c=n([]),C=n(1),F=n(20),z=n(0);function K(i){X(i)}function Q(i,e){V.value=i;const a=e.target.getBoundingClientRect();N.value={top:a.top,left:a.left,width:a.width,height:a.height,bottom:a.bottom},B.value=!0}async function W(){var i,e;if(V.value){j.value=!0;try{await he(String(V.value.id)),c.value=c.value.filter(a=>a.id!==V.value.id),g.success("用户删除成功"),I()}catch(a){console.error("delete failed",a),g.error("删除失败",{description:((e=(i=a.response)==null?void 0:i.data)==null?void 0:e.message)||a.message||"删除用户时发生错误"})}finally{j.value=!1}}}function I(){B.value=!1,V.value=null,j.value=!1}const M=n(!1),U=n(!1),l=n({id:0,username:"",email:"",password:"",is_active:!0}),B=n(!1),j=n(!1),V=n(null),N=n({top:0,left:0,width:0,height:0});function X(i){U.value=!0,l.value={id:i.id,username:i.username,email:i.email||"",password:"",is_active:i.is_active},M.value=!0}function Y(){U.value=!1,l.value={id:0,username:"",email:"",password:"",is_active:!0},M.value=!0}function L(){M.value=!1}async function Z(){var i,e,a,f;if(U.value){const m=c.value.findIndex(R=>R.id===l.value.id);if(m!==-1){const R={username:l.value.username,is_active:l.value.is_active,...l.value.email?{email:l.value.email}:{},is_staff:!1,is_superuser:!1};try{const p=await we(String(l.value.id),R),ae=p&&typeof p.is_active=="boolean"?p.is_active:p&&p.user&&typeof p.user.is_active=="boolean"?p.user.is_active:l.value.is_active;c.value[m]={...c.value[m],is_active:ae},g.success("用户更新成功")}catch(p){console.error("update failed",p),g.error("更新失败",{description:((e=(i=p.response)==null?void 0:i.data)==null?void 0:e.message)||p.message||"更新用户时发生错误"});return}}}else{if(!l.value.username){g.error("用户名不能为空",{description:"请输入用户名"});return}if(!l.value.password){g.error("密码不能为空",{description:"请输入密码"});return}try{await ke({username:l.value.username,email:l.value.email||void 0,password:l.value.password,is_active:l.value.is_active,is_staff:!1,is_superuser:!1}),g.success("用户创建成功"),await T()}catch(m){console.error("create failed",m),g.error("创建失败",{description:((f=(a=m.response)==null?void 0:a.data)==null?void 0:f.message)||m.message||"创建用户时发生错误"});return}}L()}const T=async()=>{var i,e;try{const a=await xe({page:C.value,page_size:F.value});c.value=a.results,z.value=a.count}catch(a){console.error("getList failed",a),g.error("获取用户列表失败",{description:((e=(i=a.response)==null?void 0:i.data)==null?void 0:e.message)||a.message||"获取用户列表时发生错误"})}};te(C,()=>{T()}),re(()=>{T()});const A=n(!1),D=n(!1),b=n({id:0,old_password:"",new_password:""});function P(){A.value=!1}async function ee(){var i,e;if(!(!b.value.old_password||!b.value.new_password)){D.value=!0;try{await _e({old_password:b.value.old_password,new_password:b.value.new_password}),g.success("密码修改成功"),P()}catch(a){console.error("change password failed",a),g.error("修改失败",{description:((e=(i=a.response)==null?void 0:i.data)==null?void 0:e.message)||a.message||"修改密码时发生错误"})}finally{D.value=!1}}}return(i,e)=>(u(),x(oe,null,{default:r(()=>[s(de,{pageTitle:J.value},null,8,["pageTitle"]),t("div",$e,[s(ie,{title:""},{default:r(()=>[t("div",Ce,[e[10]||(e[10]=t("div",null,null,-1)),s(h,{size:"sm",onClick:Y},{default:r(()=>[...e[9]||(e[9]=[d("新增",-1)])]),_:1})]),s(o(ne),{class:"[&_td]:py-3.5 [&_th]:py-3.5"},{default:r(()=>[s(o(ue),null,{default:r(()=>[s(o(E),null,{default:r(()=>[s(o($),{class:"whitespace-nowrap"},{default:r(()=>[...e[11]||(e[11]=[d("ID",-1)])]),_:1}),s(o($),{class:"whitespace-nowrap"},{default:r(()=>[...e[12]||(e[12]=[d("用户名",-1)])]),_:1}),s(o($),{class:"whitespace-nowrap"},{default:r(()=>[...e[13]||(e[13]=[d("电子邮件地址",-1)])]),_:1}),s(o($),{class:"whitespace-nowrap"},{default:r(()=>[...e[14]||(e[14]=[d("角色",-1)])]),_:1}),s(o($),{class:"whitespace-nowrap"},{default:r(()=>[...e[15]||(e[15]=[d("状态",-1)])]),_:1}),s(o($),{class:"whitespace-nowrap text-right"},{default:r(()=>[...e[16]||(e[16]=[d("操作",-1)])]),_:1})]),_:1})]),_:1}),s(o(pe),null,{default:r(()=>[c.value.length>0?(u(!0),v(q,{key:0},O(c.value,a=>(u(),x(o(E),{key:a.id},{default:r(()=>[s(o(_),{class:"whitespace-nowrap"},{default:r(()=>[d(w(a.id),1)]),_:2},1024),s(o(_),{class:"whitespace-nowrap"},{default:r(()=>[d(w(a.username),1)]),_:2},1024),s(o(_),{class:"whitespace-nowrap"},{default:r(()=>[d(w(a.email||"-"),1)]),_:2},1024),s(o(_),{class:"whitespace-nowrap"},{default:r(()=>[d(w(a.is_superuser?"超级管理员":a.is_staff?"管理员":"用户"),1)]),_:2},1024),s(o(_),{class:"whitespace-nowrap"},{default:r(()=>[t("span",{class:se(["inline-flex items-center rounded-full px-2 py-0.5 text-xs font-medium ring-1 ring-inset",a.is_active?"bg-emerald-50 text-emerald-600 ring-emerald-200 dark:bg-emerald-500/10 dark:text-emerald-400 dark:ring-emerald-500/30":"bg-rose-50 text-rose-600 ring-rose-200 dark:bg-rose-500/10 dark:text-rose-400 dark:ring-rose-500/30"])},w(a.is_active?"启用":"停用"),3)]),_:2},1024),s(o(_),{class:"text-right whitespace-nowrap"},{default:r(()=>[t("div",Ue,[s(h,{size:"sm",variant:"outline",onClick:f=>K(a)},{default:r(()=>[...e[17]||(e[17]=[d("编辑",-1)])]),_:1},8,["onClick"]),a.is_superuser?S("",!0):(u(),v("button",{key:0,class:"inline-flex items-center justify-center font-medium gap-2 rounded-lg transition px-4 py-3 text-sm bg-white text-gray-700 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 dark:bg-gray-800 dark:text-gray-400 dark:ring-gray-700 dark:hover:bg-white/[0.03] dark:hover:text-gray-300 text-rose-600 ring-rose-200 hover:bg-rose-50 dark:text-rose-400 dark:ring-rose-500/30",onClick:f=>Q(a,f)}," 删除 ",8,Ve))])]),_:2},1024)]),_:2},1024))),128)):(u(),x(o(E),{key:1},{default:r(()=>[s(o(_),{colspan:6,class:"py-16 text-center text-gray-400 dark:text-white/40"},{default:r(()=>[...e[18]||(e[18]=[d("暂无数据",-1)])]),_:1})]),_:1}))]),_:1})]),_:1}),z.value>0?(u(),v("div",De,[s(o(ge),{page:C.value,"onUpdate:page":e[0]||(e[0]=a=>C.value=a),total:z.value,"items-per-page":F.value,"sibling-count":1},{default:r(()=>[s(o(fe),null,{default:r(({items:a})=>[s(o(me)),(u(!0),v(q,null,O(a,(f,m)=>(u(),v(q,{key:m},[f.type==="page"?(u(),x(o(ce),{key:0,value:f.value,"is-active":f.value===C.value},{default:r(()=>[d(w(f.value),1)]),_:2},1032,["value","is-active"])):(u(),x(o(be),{key:1,index:m},null,8,["index"]))],64))),128)),s(o(ve))]),_:1})]),_:1},8,["page","total","items-per-page"])])):S("",!0)]),_:1}),M.value?(u(),x(H,{key:0,fullScreenBackdrop:!0,onClose:L},{body:r(()=>[t("div",Se,[t("h3",Me,w(U.value?"编辑用户":"新增用户"),1),t("form",{onSubmit:G(Z,["prevent"]),class:"space-y-4"},[U.value?(u(),v("div",ze,[t("div",null,[e[22]||(e[22]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},"用户名",-1)),y(t("input",{"onUpdate:modelValue":e[4]||(e[4]=a=>l.value.username=a),type:"text",disabled:"",placeholder:"用户名不可修改",class:"dark:bg-dark-900 h-11 w-full cursor-not-allowed rounded-lg border border-gray-300 bg-gray-50 px-4 py-2.5 text-sm text-gray-800 opacity-80 shadow-theme-xs dark:border-gray-700 dark:bg-gray-900 dark:text-white/70"},null,512),[[k,l.value.username]])]),t("div",null,[e[23]||(e[23]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},"电子邮件地址",-1)),y(t("input",{"onUpdate:modelValue":e[5]||(e[5]=a=>l.value.email=a),type:"email",placeholder:"name@example.com",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[k,l.value.email,void 0,{trim:!0}]])])])):(u(),v("div",je,[t("div",null,[e[19]||(e[19]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[d("用户名"),t("span",{class:"text-error-500"},"*")],-1)),y(t("input",{"onUpdate:modelValue":e[1]||(e[1]=a=>l.value.username=a),type:"text",required:"",placeholder:"输入用户名",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[k,l.value.username,void 0,{trim:!0}]])]),t("div",null,[e[20]||(e[20]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[d("密码"),t("span",{class:"text-error-500"},"*")],-1)),y(t("input",{"onUpdate:modelValue":e[2]||(e[2]=a=>l.value.password=a),type:"password",required:"",placeholder:"输入密码",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[k,l.value.password]])]),t("div",null,[e[21]||(e[21]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},"电子邮件地址",-1)),y(t("input",{"onUpdate:modelValue":e[3]||(e[3]=a=>l.value.email=a),type:"email",placeholder:"name@example.com",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[k,l.value.email,void 0,{trim:!0}]])])])),t("div",null,[e[25]||(e[25]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},"是否启用",-1)),y(t("select",{"onUpdate:modelValue":e[6]||(e[6]=a=>l.value.is_active=a),class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},[...e[24]||(e[24]=[t("option",{value:!0},"启用",-1),t("option",{value:!1},"停用",-1)])],512),[[le,l.value.is_active]])]),t("div",Be,[s(h,{type:"button",variant:"outline",onClick:L},{default:r(()=>[...e[26]||(e[26]=[d("取消",-1)])]),_:1}),s(h,{type:"submit"},{default:r(()=>[...e[27]||(e[27]=[d("保存",-1)])]),_:1})])],32)])]),_:1})):S("",!0),A.value?(u(),x(H,{key:1,fullScreenBackdrop:!0,onClose:P},{body:r(()=>[t("div",Le,[e[32]||(e[32]=t("h3",{class:"mb-4 text-lg font-semibold"},"修改密码",-1)),t("form",{onSubmit:G(ee,["prevent"]),class:"space-y-4"},[t("div",null,[e[28]||(e[28]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[d("旧密码"),t("span",{class:"text-error-500"},"*")],-1)),y(t("input",{"onUpdate:modelValue":e[7]||(e[7]=a=>b.value.old_password=a),type:"password",required:"",placeholder:"输入旧密码",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[k,b.value.old_password]])]),t("div",null,[e[29]||(e[29]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[d("新密码"),t("span",{class:"text-error-500"},"*")],-1)),y(t("input",{"onUpdate:modelValue":e[8]||(e[8]=a=>b.value.new_password=a),type:"password",required:"",placeholder:"输入新密码",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[k,b.value.new_password]])]),t("div",Te,[s(h,{type:"button",variant:"outline",onClick:P,disabled:D.value},{default:r(()=>[...e[30]||(e[30]=[d("取消",-1)])]),_:1},8,["disabled"]),s(h,{type:"submit",disabled:D.value},{default:r(()=>[D.value?(u(),v("span",Pe,"处理中...")):S("",!0),e[31]||(e[31]=d(" 确认 ",-1))]),_:1},8,["disabled"])])],32)])]),_:1})):S("",!0),s(ye,{isOpen:B.value,title:"删除",description:"确定要删除吗？此操作不可撤销。",isLoading:j.value,triggerRect:N.value,onClose:I,onConfirm:W},null,8,["isOpen","isLoading","triggerRect"])])]),_:1}))}};export{Je as default};
