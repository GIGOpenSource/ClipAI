import{d as xe,r as f,f as Y,w as Z,j as ye,c as b,o as g,x as a,z as y,B as ee,A as e,a as t,E as o,y as s,t as d,n as te,C as H,J as X,F as R,v as K,H as F,D as Re,K as Fe}from"./index-C48miiTf.js";import{_ as Te,a as Ue}from"./AdminLayout-C6b243UD.js";import{i as ae,_ as se,a as le,b as z,c,d as re,e as p,P as we,f as ke,g as be,h as _e,k as he,l as De,j as Ae}from"./DeleteConfirmDialog-DVx0dMiq.js";import{a as D,f as q,_ as oe}from"./chevron-right-B88JNwVU.js";import{l as Ie,p as Ee,a as Ne,t as He,_ as Ke}from"./home-OjZTzywk.js";import{_ as Ce}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{h as Oe}from"./index-DwLEtfjI.js";const Je={class:"space-y-6"},Xe={class:"flex items-center justify-between mb-4"},qe={class:"mb-4"},Ge={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-4 dark:bg-gray-800 dark:border-gray-700"},Qe={class:"flex items-center justify-between"},We={class:"flex items-center gap-4"},Ye={class:"flex items-center gap-2"},Ze={class:"flex items-center gap-6"},et={class:"flex items-center gap-4"},tt={class:"text-sm text-emerald-600 dark:text-emerald-400 font-medium"},at={class:"text-sm text-red-600 dark:text-red-400 font-medium"},st={class:"mt-4"},lt={class:"relative bg-white rounded-lg shadow-xl max-w-md w-full mx-4 dark:bg-gray-800"},rt={class:"p-6"},ot={class:"text-center"},nt={class:"flex justify-center gap-3"},it=xe({__name:"TaskDetail",props:{taskDetail:{}},emits:["close"],setup(O){const T=O,C=f(""),x=f(1),U=f(10),V=f(0),_=f(!1),L=f(!1),w=f([]),j=Y(()=>{const i=w.value.filter(u=>u.status==="success").length,l=w.value.filter(u=>u.status==="failed").length;return{success:i,failed:l}}),B=()=>{x.value=1,$()},P=()=>{console.log("重试按钮被点击"),console.log("失败数量:",j.value.failed),console.log("当前showRetryConfirm:",_.value),_.value=!0,console.log("设置后showRetryConfirm:",_.value)},$=async()=>{var i,l;L.value=!0;try{if(!((i=T.taskDetail)!=null&&i.id)){w.value=[],V.value=0;return}const u={simpletask_id:T.taskDetail.id,currentPage:x.value,pageSize:U.value};C.value&&C.value!=="all"&&(u.status=C.value);const h=await Ie(u);if(h&&h.results){const S=h.results||[];w.value=S.map(M=>({id:M.id||"",account:M.account||"",publish_time:M.created_at||"",status:M.success==="success"?"success":"failed",external_id:M.external_id||"",error_message:M.error_message||""})),V.value=((l=h.pagination)==null?void 0:l.total)||0}else w.value=[],V.value=0}catch(u){console.error("获取执行日志失败:",u),F.error("获取执行日志失败"),w.value=[],V.value=0}finally{L.value=!1}},A=async()=>{var i;try{_.value=!1;const l={simpletask_id:(i=T.taskDetail)==null?void 0:i.id},u=await Ee(l);u.message?F.success(u.message):F.success("已开始重新执行失败的任务"),await $()}catch(l){console.error("重新执行失败:",l),F.error("重新执行失败")}};return Z(x,()=>{$()}),Z(()=>T.taskDetail,i=>{i!=null&&i.id&&$()},{deep:!0}),ye(()=>{$()}),(i,l)=>(g(),b("div",Je,[a(ae,null,{default:e(()=>[t("div",Xe,[l[7]||(l[7]=t("h3",{class:"text-lg font-semibold text-gray-900 dark:text-white"},"任务参数",-1)),a(D,{variant:"outline",onClick:l[0]||(l[0]=u=>i.$emit("close"))},{default:e(()=>[...l[6]||(l[6]=[o(" 返回 ",-1)])]),_:1})]),a(s(se),{class:"[&_td]:py-3.5 [&_th]:py-3.5"},{default:e(()=>[a(s(le),null,{default:e(()=>[a(s(z),null,{default:e(()=>[a(s(c),{class:"whitespace-nowrap"},{default:e(()=>[...l[8]||(l[8]=[o("序号",-1)])]),_:1}),a(s(c),{class:"whitespace-nowrap"},{default:e(()=>[...l[9]||(l[9]=[o("创建用户",-1)])]),_:1}),a(s(c),{class:"whitespace-nowrap"},{default:e(()=>[...l[10]||(l[10]=[o("类型",-1)])]),_:1}),a(s(c),{class:"whitespace-nowrap"},{default:e(()=>[...l[11]||(l[11]=[o("平台",-1)])]),_:1}),a(s(c),{class:"whitespace-nowrap"},{default:e(()=>[...l[12]||(l[12]=[o("语言",-1)])]),_:1}),a(s(c),{class:"whitespace-nowrap"},{default:e(()=>[...l[13]||(l[13]=[o("文本内容",-1)])]),_:1}),a(s(c),{class:"whitespace-nowrap"},{default:e(()=>[...l[14]||(l[14]=[o("提及",-1)])]),_:1}),a(s(c),{class:"whitespace-nowrap"},{default:e(()=>[...l[15]||(l[15]=[o("话题",-1)])]),_:1}),a(s(c),{class:"whitespace-nowrap"},{default:e(()=>[...l[16]||(l[16]=[o("提示词",-1)])]),_:1}),a(s(c),{class:"whitespace-nowrap"},{default:e(()=>[...l[17]||(l[17]=[o("备注",-1)])]),_:1}),a(s(c),{class:"whitespace-nowrap"},{default:e(()=>[...l[18]||(l[18]=[o("创建时间",-1)])]),_:1})]),_:1})]),_:1}),a(s(re),null,{default:e(()=>[i.taskDetail?(g(),y(s(z),{key:0},{default:e(()=>[a(s(p),{class:"whitespace-nowrap"},{default:e(()=>[...l[19]||(l[19]=[o("1",-1)])]),_:1}),a(s(p),{class:"whitespace-nowrap"},{default:e(()=>[o(d(i.taskDetail.owner_name||"--"),1)]),_:1}),a(s(p),{class:"whitespace-nowrap"},{default:e(()=>[t("span",{class:te(["inline-flex items-center rounded-full px-2 py-0.5 text-xs font-medium ring-1 ring-inset",i.taskDetail.type==="post"?"bg-blue-50 text-blue-600 ring-blue-200 dark:bg-blue-500/10 dark:text-blue-400 dark:ring-blue-500/30":i.taskDetail.type==="reply_comment"?"bg-purple-50 text-purple-600 ring-purple-200 dark:bg-purple-500/10 dark:text-purple-400 dark:ring-purple-500/30":"bg-orange-50 text-orange-600 ring-orange-200 dark:bg-orange-500/10 dark:text-orange-400 dark:ring-orange-500/30"])},d(i.taskDetail.type==="post"?"发帖":i.taskDetail.type==="reply_comment"?"回复评论":i.taskDetail.type==="reply_mention"?"回复消息":i.taskDetail.type),3)]),_:1}),a(s(p),{class:"whitespace-nowrap"},{default:e(()=>[o(d(i.taskDetail.provider||"--"),1)]),_:1}),a(s(p),{class:"whitespace-nowrap"},{default:e(()=>[o(d(i.taskDetail.language||"--"),1)]),_:1}),a(s(p),{class:"max-w-[200px] truncate",title:i.taskDetail.text},{default:e(()=>[o(d(i.taskDetail.text||"--"),1)]),_:1},8,["title"]),a(s(p),{class:"max-w-[150px] truncate",title:i.taskDetail.mentions},{default:e(()=>[o(d(i.taskDetail.mentions||"--"),1)]),_:1},8,["title"]),a(s(p),{class:"max-w-[150px] truncate",title:Array.isArray(i.taskDetail.tags)?i.taskDetail.tags.join(", "):i.taskDetail.tags},{default:e(()=>[o(d(Array.isArray(i.taskDetail.tags)?i.taskDetail.tags.join(", "):i.taskDetail.tags||"--"),1)]),_:1},8,["title"]),a(s(p),{class:"whitespace-nowrap"},{default:e(()=>[o(d(i.taskDetail.prompt_name||"--"),1)]),_:1}),a(s(p),{class:"whitespace-nowrap"},{default:e(()=>[o(d(i.taskDetail.task_remark||"--"),1)]),_:1}),a(s(p),{class:"whitespace-nowrap"},{default:e(()=>[o(d(s(q)(i.taskDetail.created_at)),1)]),_:1})]),_:1})):(g(),y(s(z),{key:1},{default:e(()=>[a(s(p),{colspan:11,class:"py-16 text-center text-gray-400 dark:text-white/40"},{default:e(()=>[...l[20]||(l[20]=[o(" 暂无数据 ",-1)])]),_:1})]),_:1}))]),_:1})]),_:1})]),_:1}),a(ae,null,{default:e(()=>[t("div",qe,[l[24]||(l[24]=t("h3",{class:"text-lg font-semibold text-gray-900 dark:text-white mb-4"},"执行日志",-1)),t("div",Ge,[t("div",Qe,[t("div",We,[t("div",Ye,[l[22]||(l[22]=t("label",{class:"text-sm text-gray-600 dark:text-gray-400 whitespace-nowrap"},"发布状态",-1)),H(t("select",{"onUpdate:modelValue":l[1]||(l[1]=u=>C.value=u),onChange:B,class:"w-48 h-10 px-3 rounded-lg border border-gray-300 bg-white text-sm text-gray-800 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white dark:focus:border-blue-400 dark:focus:ring-blue-400"},[...l[21]||(l[21]=[t("option",{value:""},"请选择发布状态",-1),t("option",{value:"all"},"全部",-1),t("option",{value:"success"},"成功",-1),t("option",{value:"failed"},"失败",-1)])],544),[[X,C.value]])])]),t("div",Ze,[t("div",et,[t("span",tt," 成功: "+d(j.value.success),1),t("span",at," 失败: "+d(j.value.failed),1)]),a(D,{size:"sm",class:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors",onClick:P,disabled:j.value.failed===0},{default:e(()=>[...l[23]||(l[23]=[o(" 重新执行失败 ",-1)])]),_:1},8,["disabled"])])])])]),a(s(se),{class:"[&_td]:py-3.5 [&_th]:py-3.5"},{default:e(()=>[a(s(le),null,{default:e(()=>[a(s(z),null,{default:e(()=>[a(s(c),{class:"whitespace-nowrap"},{default:e(()=>[...l[25]||(l[25]=[o("ID",-1)])]),_:1}),a(s(c),{class:"whitespace-nowrap"},{default:e(()=>[...l[26]||(l[26]=[o("账号ID",-1)])]),_:1}),a(s(c),{class:"whitespace-nowrap"},{default:e(()=>[...l[27]||(l[27]=[o("发布时间",-1)])]),_:1}),a(s(c),{class:"whitespace-nowrap"},{default:e(()=>[...l[28]||(l[28]=[o("状态",-1)])]),_:1}),a(s(c),{class:"whitespace-nowrap"},{default:e(()=>[...l[29]||(l[29]=[o("外部ID",-1)])]),_:1}),a(s(c),{class:"whitespace-nowrap"},{default:e(()=>[...l[30]||(l[30]=[o("错误信息",-1)])]),_:1})]),_:1})]),_:1}),a(s(re),null,{default:e(()=>[L.value?(g(),y(s(z),{key:0},{default:e(()=>[a(s(p),{colspan:6,class:"py-16 text-center text-gray-400 dark:text-white/40"},{default:e(()=>[...l[31]||(l[31]=[t("div",{class:"flex items-center justify-center gap-2"},[t("svg",{class:"animate-spin h-5 w-5 text-blue-600",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]),o(" 加载中... ")],-1)])]),_:1})]),_:1})):w.value.length?(g(!0),b(R,{key:1},K(w.value,u=>(g(),y(s(z),{key:u.id},{default:e(()=>[a(s(p),{class:"whitespace-nowrap font-mono text-sm"},{default:e(()=>[o(d(u.id),1)]),_:2},1024),a(s(p),{class:"whitespace-nowrap font-mono text-sm"},{default:e(()=>[o(d(u.account||"--"),1)]),_:2},1024),a(s(p),{class:"whitespace-nowrap"},{default:e(()=>[o(d(s(q)(u.publish_time)),1)]),_:2},1024),a(s(p),{class:"whitespace-nowrap"},{default:e(()=>[t("span",{class:te(["inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium",u.status==="success"?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400":"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400"])},d(u.status==="success"?"成功":u.status==="failed"?"失败":u.status),3)]),_:2},1024),a(s(p),{class:"whitespace-nowrap font-mono text-sm max-w-[120px] truncate",title:u.external_id},{default:e(()=>[o(d(u.external_id||"--"),1)]),_:2},1032,["title"]),a(s(p),{class:"max-w-[200px] truncate text-red-600 dark:text-red-400",title:u.error_message},{default:e(()=>[o(d(u.error_message||"--"),1)]),_:2},1032,["title"])]),_:2},1024))),128)):(g(),y(s(z),{key:2},{default:e(()=>[a(s(p),{colspan:6,class:"py-16 text-center text-gray-400 dark:text-white/40"},{default:e(()=>[...l[32]||(l[32]=[o(" 暂无执行日志 ",-1)])]),_:1})]),_:1}))]),_:1})]),_:1}),t("div",st,[a(s(we),{page:x.value,"onUpdate:page":l[2]||(l[2]=u=>x.value=u),total:V.value,"items-per-page":U.value,"sibling-count":1,"show-edges":""},{default:e(()=>[a(s(ke),null,{default:e(({items:u})=>[a(s(be)),(g(!0),b(R,null,K(u,(h,S)=>(g(),b(R,{key:S},[h.type==="page"?(g(),y(s(he),{key:0,value:h.value,"is-active":h.value===x.value},{default:e(()=>[o(d(h.value),1)]),_:2},1032,["value","is-active"])):(g(),y(s(De),{key:1,index:S},null,8,["index"]))],64))),128)),a(s(_e))]),_:1})]),_:1},8,["page","total","items-per-page"])])]),_:1}),_.value?(g(),y(oe,{key:0,onClose:l[5]||(l[5]=u=>_.value=!1)},{body:e(()=>[t("div",{class:"fixed inset-0 bg-black/50 backdrop-blur-sm",onClick:l[3]||(l[3]=u=>_.value=!1)}),t("div",lt,[t("div",rt,[t("div",ot,[l[35]||(l[35]=t("h3",{class:"text-lg font-semibold text-blue-600 dark:text-blue-400 mb-2"}," 确认重试失败任务? ",-1)),l[36]||(l[36]=t("p",{class:"text-gray-600 dark:text-gray-400 text-sm mb-6"}," 一键重新发送所有执行失败的机器人任务 (此操作仅能进行一次) ",-1)),t("div",nt,[a(D,{onClick:A,class:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg text-sm font-medium"},{default:e(()=>[...l[33]||(l[33]=[o(" 确认重试 ",-1)])]),_:1}),a(D,{onClick:l[4]||(l[4]=u=>_.value=!1),variant:"outline",class:"border-blue-600 text-blue-600 hover:bg-blue-50 px-6 py-2 rounded-lg text-sm font-medium"},{default:e(()=>[...l[34]||(l[34]=[o(" 不重试 ",-1)])]),_:1})])])])])]),_:1})):ee("",!0)]))}}),dt=Ce(it,[["__scopeId","data-v-dbcc3ddc"]]),ut=O=>Oe(`/tasks/logs/${O}/`),pt={key:0,class:"space-y-5 sm:space-y-6"},ft={key:1,class:"space-y-5 sm:space-y-6"},gt={class:"mb-4"},ct={class:"relative"},vt={class:"mb-4 flex items-center gap-3 flex-wrap"},mt=["value"],xt={class:"flex items-center gap-2"},yt={class:"flex items-center gap-2"},wt={key:0,class:"mr-2"},kt={key:1},bt={class:"inline-flex items-center text-emerald-600 dark:text-emerald-400 font-medium"},_t={class:"inline-flex items-center text-red-600 dark:text-red-400 font-medium"},ht={class:"flex items-center justify-end gap-2"},Dt={class:"mt-4"},Ct={class:"relative z-10 w-full max-w-3xl rounded-xl bg-white p-6 shadow-lg dark:bg-gray-900"},$t={class:"space-y-4"},zt={class:"grid grid-cols-2 gap-4"},Vt={class:"text-sm text-gray-900 dark:text-white"},jt={class:"text-sm text-gray-900 dark:text-white"},St={class:"grid grid-cols-2 gap-4"},Mt={class:"text-sm text-gray-900 dark:text-white"},Lt={class:"text-sm text-gray-900 dark:text-white"},Bt={class:"text-sm text-gray-900 dark:text-white p-3 bg-gray-50 dark:bg-gray-800 rounded-lg"},Pt={class:"grid grid-cols-2 gap-4"},Rt={class:"text-sm text-gray-900 dark:text-white"},Ft={class:"text-sm text-emerald-600 dark:text-emerald-400 font-medium"},Tt={class:"flex justify-end gap-3 pt-6 mt-6 border-t border-gray-200 dark:border-gray-700"},Ut={class:"relative bg-white rounded-lg shadow-xl p-6 max-w-4xl mx-auto dark:bg-gray-900"},At={class:"mb-6"},It={class:"mb-4 p-3 bg-gray-50 rounded-lg dark:bg-gray-800"},Et={class:"text-sm text-gray-600 dark:text-gray-400"},Nt={class:"font-semibold text-gray-900 dark:text-white"},Ht={class:"flex justify-end gap-3"},Kt=xe({__name:"taskLog",setup(O){const T=f("任务日志"),C=f([]),x=f(1),U=f(20),V=f(0),_=f(0),L=f(!1),w=f([]),j=f(""),B=f(""),P=f(""),$=f(""),A=f(!1),i=f(!1),l=f({start:void 0,end:void 0}),u=Y(()=>{if(!l.value.start||!l.value.end)return"";const v=S(l.value.start),r=S(l.value.end);return`${v} 至 ${r}`}),h=Y(()=>l.value.start&&l.value.end),S=v=>{if(!v)return"";const r=v.year,n=String(v.month).padStart(2,"0"),m=String(v.day).padStart(2,"0");return`${r}-${n}-${m}`},M=f(!1),G=f(!1),k=f(null),ne=f(!1),J=f(!1),Q=f(null),$e=f({top:0,left:0,width:0,height:0});function ze(v){k.value=v,G.value=!0}function ie(){M.value=!1,k.value=null}function Ve(){G.value=!1,k.value=null}async function je(){if(Q.value){J.value=!0;try{await ut(Q.value.id.toString()),F.success("删除成功"),await E(),de()}catch(v){console.error("删除失败:",v);const r=v instanceof Error?v.message:"删除任务日志时发生错误";F.error("删除失败",{description:r})}finally{J.value=!1}}}function de(){ne.value=!1,Q.value=null,J.value=!1}const I=async()=>{A.value=!0,x.value=1;try{await E()}finally{A.value=!1}},Se=()=>{j.value="",B.value="",P.value="",$.value="",l.value={start:void 0,end:void 0},x.value=1,E()},Me=()=>{x.value=1,E()},Le=()=>{i.value=!0},W=()=>{i.value=!1},Be=()=>{h.value&&(i.value=!1,I())},Pe=async()=>{try{const v=await Ne({});console.log(v.results,"res"),v&&v.results?w.value=v.results:w.value=[],console.log(w.value,"promptConfigs.value")}catch(v){console.error("获取提示词配置失败:",v),w.value=[]}},E=async()=>{var v,r;L.value=!0;try{const n={currentPage:x.value,pageSize:U.value};j.value&&(n.search=j.value),B.value&&(n.type=B.value),P.value&&(n.provider=P.value),$.value&&(n.prompt__id=parseInt($.value)),l.value.start&&l.value.end&&(n.start_date=S(l.value.start),n.end_date=S(l.value.end));const m=await He(n);m&&m.results?(C.value=m.results||[],V.value=((v=m.pagination)==null?void 0:v.total)||0,_.value=((r=m.pagination)==null?void 0:r.total_pages)||0):(C.value=[],V.value=0,_.value=0)}catch(n){console.error("获取任务日志失败:",n);const m=n instanceof Error?n.message:"获取任务日志时发生错误";F.error("获取列表失败",{description:m}),C.value=[],V.value=0,_.value=0}finally{L.value=!1}};return Z(x,()=>{E()}),ye(()=>{Pe(),E()}),(v,r)=>(g(),y(Te,null,{default:e(()=>[a(Ue,{pageTitle:T.value},null,8,["pageTitle"]),G.value?(g(),b("div",pt,[a(dt,{taskDetail:k.value,onClose:Ve},null,8,["taskDetail"])])):(g(),b("div",ft,[a(ae,null,{default:e(()=>[t("div",gt,[t("div",ct,[H(t("input",{"onUpdate:modelValue":r[0]||(r[0]=n=>j.value=n),type:"text",placeholder:"请输入文本内容",class:"w-64 h-10 px-4 pl-10 rounded-lg border border-gray-300 bg-transparent text-sm text-gray-800 shadow-theme-xs focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:focus:border-brand-800",onKeyup:Fe(I,["enter"])},null,544),[[Re,j.value]]),r[6]||(r[6]=t("svg",{class:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1))])]),t("div",vt,[H(t("select",{"onUpdate:modelValue":r[1]||(r[1]=n=>B.value=n),onChange:I,class:"w-48 h-10 px-4 rounded-lg border border-gray-300 bg-transparent text-sm text-gray-800 shadow-theme-xs focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:focus:border-brand-800"},[...r[7]||(r[7]=[t("option",{value:""},"请选择类型",-1),t("option",{value:"post"},"发帖",-1),t("option",{value:"reply_comment"},"回复评论",-1),t("option",{value:"reply_mention"},"回复消息",-1)])],544),[[X,B.value]]),H(t("select",{"onUpdate:modelValue":r[2]||(r[2]=n=>P.value=n),onChange:I,class:"w-48 h-10 px-4 rounded-lg border border-gray-300 bg-transparent text-sm text-gray-800 shadow-theme-xs focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:focus:border-brand-800"},[...r[8]||(r[8]=[t("option",{value:""},"请选择平台",-1),t("option",{value:"twitter"},"X",-1),t("option",{value:"facebook"},"Facebook",-1),t("option",{value:"instagram"},"Instagram",-1),t("option",{value:"threads"},"Threads",-1)])],544),[[X,P.value]]),H(t("select",{"onUpdate:modelValue":r[3]||(r[3]=n=>$.value=n),onChange:I,class:"w-48 h-10 px-4 rounded-lg border border-gray-300 bg-transparent text-sm text-gray-800 shadow-theme-xs focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:focus:border-brand-800"},[r[9]||(r[9]=t("option",{value:""},"请选择提示词",-1)),(g(!0),b(R,null,K(w.value,n=>(g(),b("option",{key:n.id,value:n.id},d(n.name),9,mt))),128))],544),[[X,$.value]]),t("div",xt,[a(D,{variant:"outline",onClick:Le,class:"px-4 py-2 h-10 min-w-[220px] justify-start text-left"},{default:e(()=>[r[10]||(r[10]=t("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)),o(" "+d(u.value||"选择日期时间段"),1)]),_:1})]),t("div",yt,[a(D,{size:"sm",onClick:I,disabled:A.value,class:"bg-blue-600 hover:bg-blue-700"},{default:e(()=>[A.value?(g(),b("span",wt,"查询中...")):(g(),b("span",kt,"查询"))]),_:1},8,["disabled"]),a(D,{size:"sm",variant:"outline",onClick:Se},{default:e(()=>[...r[11]||(r[11]=[o(" 重置 ",-1)])]),_:1}),a(D,{size:"sm",onClick:Me,variant:"outline",class:"text-red-600 hover:text-red-700 border-red-200 hover:border-red-300"},{default:e(()=>[...r[12]||(r[12]=[o(" 刷新 ",-1)])]),_:1})])]),a(s(se),{class:"[&_td]:py-3.5 [&_th]:py-3.5"},{default:e(()=>[a(s(le),null,{default:e(()=>[a(s(z),null,{default:e(()=>[a(s(c),{class:"whitespace-nowrap"},{default:e(()=>[...r[13]||(r[13]=[o("序号",-1)])]),_:1}),a(s(c),{class:"whitespace-nowrap"},{default:e(()=>[...r[14]||(r[14]=[o("创建时间",-1)])]),_:1}),a(s(c),{class:"whitespace-nowrap"},{default:e(()=>[...r[15]||(r[15]=[o("创建用户",-1)])]),_:1}),a(s(c),{class:"whitespace-nowrap"},{default:e(()=>[...r[16]||(r[16]=[o("类型",-1)])]),_:1}),a(s(c),{class:"whitespace-nowrap"},{default:e(()=>[...r[17]||(r[17]=[o("平台",-1)])]),_:1}),a(s(c),{class:"whitespace-nowrap"},{default:e(()=>[...r[18]||(r[18]=[o("文本内容",-1)])]),_:1}),a(s(c),{class:"whitespace-nowrap"},{default:e(()=>[...r[19]||(r[19]=[o("提示词",-1)])]),_:1}),a(s(c),{class:"whitespace-nowrap"},{default:e(()=>[...r[20]||(r[20]=[o("机器人数量",-1)])]),_:1}),a(s(c),{class:"whitespace-nowrap"},{default:e(()=>[...r[21]||(r[21]=[o("发送成功数",-1)])]),_:1}),a(s(c),{class:"whitespace-nowrap"},{default:e(()=>[...r[22]||(r[22]=[o("发送失败数",-1)])]),_:1}),a(s(c),{class:"whitespace-nowrap text-right sticky right-0 bg-white dark:bg-gray-900 z-10"},{default:e(()=>[...r[23]||(r[23]=[o("操作",-1)])]),_:1})]),_:1})]),_:1}),a(s(re),null,{default:e(()=>[L.value?(g(),y(s(z),{key:0},{default:e(()=>[a(s(p),{colspan:11,class:"py-16 text-center text-gray-400 dark:text-white/40"},{default:e(()=>[...r[24]||(r[24]=[t("div",{class:"flex items-center justify-center gap-2"},[t("svg",{class:"animate-spin h-5 w-5 text-blue-600",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]),o(" 加载中... ")],-1)])]),_:1})]),_:1})):C.value.length?(g(!0),b(R,{key:1},K(C.value,(n,m)=>(g(),y(s(z),{key:n.id},{default:e(()=>[a(s(p),{class:"whitespace-nowrap"},{default:e(()=>[o(d((x.value-1)*U.value+m+1),1)]),_:2},1024),a(s(p),{class:"whitespace-nowrap"},{default:e(()=>[o(d(s(q)(n.created_at)),1)]),_:2},1024),a(s(p),{class:"whitespace-nowrap"},{default:e(()=>[o(d(n.owner_name||"--"),1)]),_:2},1024),a(s(p),{class:"whitespace-nowrap"},{default:e(()=>[t("span",{class:te(["inline-flex items-center rounded-full px-2 py-0.5 text-xs font-medium ring-1 ring-inset",n.type==="post"?"bg-blue-50 text-blue-600 ring-blue-200 dark:bg-blue-500/10 dark:text-blue-400 dark:ring-blue-500/30":n.type==="reply_comment"?"bg-purple-50 text-purple-600 ring-purple-200 dark:bg-purple-500/10 dark:text-purple-400 dark:ring-purple-500/30":"bg-orange-50 text-orange-600 ring-orange-200 dark:bg-orange-500/10 dark:text-orange-400 dark:ring-orange-500/30"])},d(n.type==="post"?"发帖":n.type==="reply_comment"?"回复评论":n.type==="reply_mention"?"回复消息":n.type),3)]),_:2},1024),a(s(p),{class:"whitespace-nowrap"},{default:e(()=>[o(d(n.provider||"--"),1)]),_:2},1024),a(s(p),{class:"max-w-[300px] truncate",title:n.text},{default:e(()=>[o(d(n.text||"--"),1)]),_:2},1032,["title"]),a(s(p),{class:"max-w-[200px] truncate",title:n.prompt_name},{default:e(()=>[o(d(n.prompt_name||"--"),1)]),_:2},1032,["title"]),a(s(p),{class:"whitespace-nowrap"},{default:e(()=>[o(d(n.account_count||0),1)]),_:2},1024),a(s(p),{class:"whitespace-nowrap"},{default:e(()=>[t("span",bt,d(n.success_count||0),1)]),_:2},1024),a(s(p),{class:"whitespace-nowrap"},{default:e(()=>[t("span",_t,d(n.fail_count||0),1)]),_:2},1024),a(s(p),{class:"text-right whitespace-nowrap sticky right-0 bg-white dark:bg-gray-900 z-10"},{default:e(()=>[t("div",ht,[a(D,{size:"sm",variant:"outline",onClick:N=>ze(n),class:"!text-blue-600 hover:!text-blue-700"},{default:e(()=>[...r[25]||(r[25]=[o(" 查看详情 ",-1)])]),_:1},8,["onClick"])])]),_:2},1024)]),_:2},1024))),128)):(g(),y(s(z),{key:2},{default:e(()=>[a(s(p),{colspan:10,class:"py-16 text-center text-gray-400 dark:text-white/40"},{default:e(()=>[...r[26]||(r[26]=[o("暂无数据",-1)])]),_:1})]),_:1}))]),_:1})]),_:1}),t("div",Dt,[a(s(we),{page:x.value,"onUpdate:page":r[4]||(r[4]=n=>x.value=n),total:V.value,"items-per-page":U.value,"sibling-count":1,"show-edges":""},{default:e(()=>[a(s(ke),null,{default:e(({items:n})=>[a(s(be)),(g(!0),b(R,null,K(n,(m,N)=>(g(),b(R,{key:N},[m.type==="page"?(g(),y(s(he),{key:0,value:m.value,"is-active":m.value===x.value},{default:e(()=>[o(d(m.value),1)]),_:2},1032,["value","is-active"])):(g(),y(s(De),{key:1,index:N},null,8,["index"]))],64))),128)),a(s(_e))]),_:1})]),_:1},8,["page","total","items-per-page"])])]),_:1}),M.value?(g(),y(oe,{key:0,fullScreenBackdrop:!0,onClose:ie},{body:e(()=>{var n,m,N,ue,pe,fe,ge,ce,ve,me;return[t("div",Ct,[r[35]||(r[35]=t("h3",{class:"mb-6 text-lg font-semibold"},"任务日志详情",-1)),t("div",$t,[t("div",zt,[t("div",null,[r[27]||(r[27]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-400 mb-1"},"创建时间",-1)),t("p",Vt,d(s(q)((n=k.value)==null?void 0:n.created_at)),1)]),t("div",null,[r[28]||(r[28]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-400 mb-1"},"创建用户",-1)),t("p",jt,d(((m=k.value)==null?void 0:m.owner_name)||"--"),1)])]),t("div",St,[t("div",null,[r[29]||(r[29]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-400 mb-1"},"类型",-1)),t("p",Mt,d(((N=k.value)==null?void 0:N.type)==="post"?"发帖":((ue=k.value)==null?void 0:ue.type)==="reply_comment"?"回复评论":((pe=k.value)==null?void 0:pe.type)==="reply_mention"?"回复消息":(fe=k.value)==null?void 0:fe.type),1)]),t("div",null,[r[30]||(r[30]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-400 mb-1"},"平台",-1)),t("p",Lt,d(((ge=k.value)==null?void 0:ge.provider)||"--"),1)])]),t("div",null,[r[31]||(r[31]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-400 mb-1"},"文本内容",-1)),t("p",Bt,d(((ce=k.value)==null?void 0:ce.text)||"--"),1)]),t("div",Pt,[t("div",null,[r[32]||(r[32]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-400 mb-1"},"机器人数量",-1)),t("p",Rt,d(((ve=k.value)==null?void 0:ve.account_count)||0),1)]),t("div",null,[r[33]||(r[33]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-400 mb-1"},"发送成功数",-1)),t("p",Ft,d(((me=k.value)==null?void 0:me.success_count)||0),1)])])]),t("div",Tt,[a(D,{variant:"outline",onClick:ie},{default:e(()=>[...r[34]||(r[34]=[o("关闭",-1)])]),_:1})])])]}),_:1})):ee("",!0),i.value?(g(),y(oe,{key:1,fullScreenBackdrop:!0,onClose:W},{body:e(()=>[t("div",Ut,[t("div",{class:"flex items-center justify-between mb-4"},[r[37]||(r[37]=t("h3",{class:"text-lg font-semibold text-gray-900 dark:text-white"},"选择日期时间段",-1)),t("button",{onClick:W,class:"text-gray-400 hover:text-gray-600 transition-colors dark:text-gray-500 dark:hover:text-gray-300"},[...r[36]||(r[36]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),t("div",At,[a(s(Ke),{modelValue:l.value,"onUpdate:modelValue":r[5]||(r[5]=n=>l.value=n),locale:"zh-CN",class:"border border-gray-200 rounded-lg dark:border-gray-700"},null,8,["modelValue"])]),t("div",It,[t("p",Et,[r[38]||(r[38]=o(" 已选择: ",-1)),t("span",Nt,d(u.value),1)])]),t("div",Ht,[a(D,{variant:"outline",class:"px-6 py-2 border-gray-300 text-gray-700 hover:bg-gray-50 dark:border-gray-600 dark:text-gray-300 dark:hover:bg-gray-800",onClick:W},{default:e(()=>[...r[39]||(r[39]=[o(" 取消 ",-1)])]),_:1}),a(D,{variant:"primary",class:"px-6 py-2 bg-orange-500 hover:bg-orange-600 text-white",onClick:Be,disabled:!h.value},{default:e(()=>[...r[40]||(r[40]=[o(" 确定 ",-1)])]),_:1},8,["disabled"])])])]),_:1})):ee("",!0),a(Ae,{isOpen:ne.value,title:"删除",description:"确定要删除这条任务日志吗？此操作不可撤销。",isLoading:J.value,triggerRect:$e.value,onClose:de,onConfirm:je},null,8,["isOpen","isLoading","triggerRect"])]))]),_:1}))}}),Yt=Ce(Kt,[["__scopeId","data-v-2bdca0ad"]]);export{Yt as default};
