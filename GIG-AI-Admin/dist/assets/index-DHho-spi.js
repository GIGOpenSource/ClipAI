import{r as n,w as N,j as ee,z as x,o as u,A as r,x as l,a,B as j,c as y,E as i,y as o,v as G,F as U,t as g,I as te,C as w,D as A,J as ae,H as p,n as re}from"./index-BHC7kEdK.js";import{a as le,_ as se}from"./AdminLayout-Dg6K-VCk.js";import{_ as oe,a as ie,b as L,c as v,d as ne,e as m,P as de,f as ue,g as pe,h as ge,i as fe,j as me,k as ce,l as ve}from"./DeleteConfirmDialog-DSDvSMLe.js";import{a as V,_ as be,f as ye}from"./chevron-right-GkbwViRt.js";import{e as F,p as ke,f as xe,h as we}from"./index-DwLEtfjI.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const _e=f=>F("/ai/configs/",{params:f}),he=f=>xe("/ai/configs/",f),$e=f=>F(`/ai/configs/${f}`),Ae=(f,T)=>ke(`/ai/configs/${f}/`,T),Ie=f=>we(`/ai/configs/${f}/`),Ce={class:"space-y-5 sm:space-y-6"},De={class:"mb-4 flex items-center justify-between"},ze={class:"flex gap-2"},Ue=["title"],Ve=["title"],Te={class:"flex items-center justify-end gap-2"},Oe=["onClick"],Se={key:0,class:"mt-4"},Be={class:"relative z-10 w-full max-w-xl rounded-xl bg-white p-6 shadow-lg dark:bg-gray-900"},Pe={class:"mb-4 text-lg font-semibold"},je=["value"],Ge={class:"flex justify-end gap-3 pt-2"},Le={key:0,class:"mr-2"},He={__name:"index",setup(f){const T=n("AI 服务配置"),O=n([]),_=n(1),K=n(20),S=n(0),H=n("");n(null),n(!1);const J=n([{title:"OpenAI",value:"openai"},{title:"Azure OpenAI",value:"azure"},{title:"Google Gemini",value:"gemini"},{title:"Anthropic",value:"anthropic"},{title:"Custom",value:"custom"},{title:"Grok",value:"grok"},{title:"Deepseek",value:"deepseek"}]),Q={openai:"OpenAI",azure:"Azure OpenAI",gemini:"Google Gemini",anthropic:"Anthropic Claude",together:"Together Al",deepseek:"Deepseek",moonshot:"Moonshot",zhipuai:"智谱AI",custom:"自定义OpenAl兼容接口"};async function q(d){try{const e=await $e(d.id);c.value=!0,C.value=d.id,s.value={name:e.name||"",provider:e.provider||"",priority:e.priority||"",api_key:e.api_key||"",base_url:e.base_url||"",model:e.model||""},I.value=!0}catch(e){console.error("获取详情失败:",e),p.error("获取详情失败")}}function W(d,e){z.value=d;const t=e.target.getBoundingClientRect();E.value={top:t.top,left:t.left,width:t.width,height:t.height,bottom:t.bottom},B.value=!0}async function X(){var d,e;if(z.value){D.value=!0;try{await Ie(z.value.id),p.success("删除成功"),await h(),M()}catch(t){console.error("删除失败:",t),p.error("删除失败",{description:((e=(d=t.response)==null?void 0:d.data)==null?void 0:e.message)||t.message||"删除配置时发生错误"})}finally{D.value=!1}}}function M(){B.value=!1,z.value=null,D.value=!1}const I=n(!1),c=n(!1),C=n(null),k=n(!1),B=n(!1),D=n(!1),z=n(null),E=n({top:0,left:0,width:0,height:0}),s=n({name:"",provider:"",priority:"",api_key:"",base_url:"",model:""});function Y(){c.value=!1,C.value=null,s.value={name:"",provider:"",priority:"",api_key:"",base_url:"",model:""},I.value=!0}function P(){I.value=!1,c.value=!1,C.value=null,s.value={name:"",provider:"",priority:"",api_key:"",base_url:"",model:""}}async function Z(){var d,e;if(!k.value){if(!s.value.name||s.value.name.trim()===""){p.error("请填写配置名称",{description:"配置名称不能为空"});return}if(!s.value.provider||s.value.provider===""){p.error("请选择平台名称",{description:"平台名称不能为空"});return}if(!s.value.api_key||s.value.api_key.trim()===""){p.error("请填写API Key",{description:"API Key不能为空"});return}if(!s.value.base_url||s.value.base_url.trim()===""){p.error("请填写基础地址",{description:"基础地址不能为空"});return}if(!s.value.model||s.value.model.trim()===""){p.error("请填写模型名称",{description:"模型名称不能为空"});return}if(!s.value.priority||s.value.priority===""){p.error("请填写优先级",{description:"优先级不能为空"});return}k.value=!0;try{const t={name:s.value.name.trim(),provider:s.value.provider,priority:s.value.priority,api_key:s.value.api_key.trim(),base_url:s.value.base_url.trim(),model:s.value.model.trim()};c.value?(await Ae(C.value,t),p.success("配置更新成功")):(await he(t),p.success("配置新增成功")),P(),await h()}catch(t){console.error(c.value?"更新失败:":"新增失败:",t),p.error(c.value?"更新失败":"新增失败",{description:((e=(d=t.response)==null?void 0:d.data)==null?void 0:e.message)||t.message||(c.value?"更新配置时发生错误":"新增配置时发生错误")})}finally{k.value=!1}}}const h=async()=>{var d,e;try{let t=await _e({search:H.value,page:_.value,enterprise_id:localStorage.getItem("selectedUserId")||""});O.value=t.results,S.value=t.count}catch(t){console.error("获取列表失败:",t),p.error("获取列表失败",{description:((e=(d=t.response)==null?void 0:d.data)==null?void 0:e.message)||t.message||"获取配置列表时发生错误"})}};N(_,d=>{console.log("Page changed to:",d),h()});const R=n(localStorage.getItem("selectedUserId")||"");return N(R,()=>{h()}),window.addEventListener("enterprise-data-changed",()=>{R.value=localStorage.getItem("selectedUserId")||""}),ee(()=>{h()}),(d,e)=>(u(),x(se,null,{default:r(()=>[l(le,{pageTitle:T.value},null,8,["pageTitle"]),a("div",Ce,[l(fe,null,{default:r(()=>[a("div",De,[e[8]||(e[8]=a("div",{class:"flex items-center gap-3"},null,-1)),a("div",ze,[l(V,{size:"sm",onClick:Y},{default:r(()=>[...e[7]||(e[7]=[i("新增",-1)])]),_:1})])]),l(o(oe),{class:"[&_td]:py-3.5 [&_th]:py-3.5"},{default:r(()=>[l(o(ie),null,{default:r(()=>[l(o(L),null,{default:r(()=>[l(o(v),{class:"whitespace-nowrap"},{default:r(()=>[...e[9]||(e[9]=[i("序号",-1)])]),_:1}),l(o(v),{class:"whitespace-nowrap"},{default:r(()=>[...e[10]||(e[10]=[i("配置名称",-1)])]),_:1}),l(o(v),{class:"whitespace-nowrap"},{default:r(()=>[...e[11]||(e[11]=[i("平台名称",-1)])]),_:1}),l(o(v),{class:"whitespace-nowrap"},{default:r(()=>[...e[12]||(e[12]=[i("key",-1)])]),_:1}),l(o(v),{class:"whitespace-nowrap"},{default:r(()=>[...e[13]||(e[13]=[i("基础地址",-1)])]),_:1}),l(o(v),{class:"whitespace-nowrap"},{default:r(()=>[...e[14]||(e[14]=[i("状态",-1)])]),_:1}),l(o(v),{class:"whitespace-nowrap"},{default:r(()=>[...e[15]||(e[15]=[i("优先级",-1)])]),_:1}),l(o(v),{class:"whitespace-nowrap"},{default:r(()=>[...e[16]||(e[16]=[i("创建时间",-1)])]),_:1}),l(o(v),{class:"whitespace-nowrap text-right"},{default:r(()=>[...e[17]||(e[17]=[i("操作",-1)])]),_:1})]),_:1})]),_:1}),l(o(ne),null,{default:r(()=>[O.value.length?(u(!0),y(U,{key:0},G(O.value,(t,b)=>(u(),x(o(L),{key:t.id},{default:r(()=>[l(o(m),{class:"whitespace-nowrap"},{default:r(()=>[i(g(b+1),1)]),_:2},1024),l(o(m),{class:"whitespace-nowrap"},{default:r(()=>[i(g(t.name),1)]),_:2},1024),l(o(m),{class:"whitespace-nowrap"},{default:r(()=>[i(g(Q[t.provider]),1)]),_:2},1024),l(o(m),null,{default:r(()=>[a("div",{class:"max-w-[200px] truncate",title:t.api_key},g(t.api_key),9,Ue)]),_:2},1024),l(o(m),null,{default:r(()=>[a("div",{class:"max-w-[200px] truncate",title:t.base_url},g(t.base_url),9,Ve)]),_:2},1024),l(o(m),{class:"whitespace-nowrap"},{default:r(()=>[a("span",{class:re(["inline-flex items-center rounded-full px-2 py-0.5 text-xs font-medium ring-1 ring-inset",t.enabled?"bg-emerald-50 text-emerald-600 ring-emerald-200 dark:bg-emerald-500/10 dark:text-emerald-400 dark:ring-emerald-500/30":"bg-rose-50 text-rose-600 ring-rose-200 dark:bg-rose-500/10 dark:text-rose-400 dark:ring-rose-500/30"])},g(t.enabled?"正常":"禁用"),3)]),_:2},1024),l(o(m),{class:"whitespace-nowrap"},{default:r(()=>[i(g(t.priority),1)]),_:2},1024),l(o(m),{class:"whitespace-nowrap"},{default:r(()=>[i(g(o(ye)(t.created_at)),1)]),_:2},1024),l(o(m),{class:"text-right whitespace-nowrap"},{default:r(()=>[a("div",Te,[l(V,{size:"sm",variant:"outline",onClick:$=>q(t)},{default:r(()=>[...e[18]||(e[18]=[i("编辑",-1)])]),_:1},8,["onClick"]),a("button",{class:"inline-flex items-center justify-center font-medium gap-2 rounded-lg transition px-4 py-3 text-sm bg-white text-gray-700 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 dark:bg-gray-800 dark:text-gray-400 dark:ring-gray-700 dark:hover:bg-white/[0.03] dark:hover:text-gray-300 text-rose-600 ring-rose-200 hover:bg-rose-50 dark:text-rose-400 dark:ring-rose-500/30",onClick:$=>W(t,$)}," 删除 ",8,Oe)])]),_:2},1024)]),_:2},1024))),128)):(u(),x(o(L),{key:1},{default:r(()=>[l(o(m),{colspan:7,class:"py-16 text-center text-gray-400 dark:text-white/40"},{default:r(()=>[...e[19]||(e[19]=[i("暂无数据",-1)])]),_:1})]),_:1}))]),_:1})]),_:1}),S.value>0?(u(),y("div",Se,[l(o(de),{page:_.value,"onUpdate:page":e[0]||(e[0]=t=>_.value=t),total:S.value,"items-per-page":K.value,"sibling-count":1,"show-edges":""},{default:r(()=>[l(o(ue),null,{default:r(({items:t})=>[l(o(pe)),(u(!0),y(U,null,G(t,(b,$)=>(u(),y(U,{key:$},[b.type==="page"?(u(),x(o(ce),{key:0,value:b.value,"is-active":b.value===_.value},{default:r(()=>[i(g(b.value),1)]),_:2},1032,["value","is-active"])):(u(),x(o(ve),{key:1,index:$},null,8,["index"]))],64))),128)),l(o(ge))]),_:1})]),_:1},8,["page","total","items-per-page"])])):j("",!0)]),_:1}),I.value?(u(),x(be,{key:0,fullScreenBackdrop:!0,onClose:P},{body:r(()=>[a("div",Be,[a("h3",Pe,g(c.value?"编辑服务配置":"新增服务配置"),1),a("form",{onSubmit:te(Z,["prevent"]),class:"space-y-4"},[a("div",null,[e[20]||(e[20]=a("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[i("配置名称"),a("span",{class:"text-error-500"},"*")],-1)),w(a("input",{"onUpdate:modelValue":e[1]||(e[1]=t=>s.value.name=t),type:"text",placeholder:"如：OpenAI GPT-4配置",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[A,s.value.name]])]),a("div",null,[e[22]||(e[22]=a("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[i("平台名称"),a("span",{class:"text-error-500"},"*")],-1)),w(a("select",{"onUpdate:modelValue":e[2]||(e[2]=t=>s.value.provider=t),class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},[e[21]||(e[21]=a("option",{value:""},"请选择平台",-1)),(u(!0),y(U,null,G(J.value,(t,b)=>(u(),y("option",{value:t.value,key:b},g(t.title),9,je))),128))],512),[[ae,s.value.provider]])]),a("div",null,[e[23]||(e[23]=a("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[i("key"),a("span",{class:"text-error-500"},"*")],-1)),w(a("input",{"onUpdate:modelValue":e[3]||(e[3]=t=>s.value.api_key=t),type:"password",placeholder:"请输入key",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[A,s.value.api_key]])]),a("div",null,[e[24]||(e[24]=a("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[i("基础地址"),a("span",{class:"text-error-500"},"*")],-1)),w(a("input",{"onUpdate:modelValue":e[4]||(e[4]=t=>s.value.base_url=t),type:"text",placeholder:"如：https://api.openai.com/v1",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[A,s.value.base_url]])]),a("div",null,[e[25]||(e[25]=a("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[i("模型名称"),a("span",{class:"text-error-500"},"*")],-1)),w(a("input",{"onUpdate:modelValue":e[5]||(e[5]=t=>s.value.model=t),type:"text",placeholder:"如：gpt-4、claude-3-sonnet",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[A,s.value.model]])]),a("div",null,[e[26]||(e[26]=a("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[i("优先级"),a("span",{class:"text-error-500"},"*")],-1)),w(a("input",{"onUpdate:modelValue":e[6]||(e[6]=t=>s.value.priority=t),type:"number",placeholder:"如：8",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[A,s.value.priority]])]),a("div",Ge,[l(V,{type:"button",variant:"outline",onClick:P,disabled:k.value},{default:r(()=>[...e[27]||(e[27]=[i("取消",-1)])]),_:1},8,["disabled"]),l(V,{type:"submit",disabled:k.value},{default:r(()=>[k.value?(u(),y("span",Le,"处理中...")):j("",!0),i(" "+g(c.value?"更新":"保存"),1)]),_:1},8,["disabled"])])],32)])]),_:1})):j("",!0),l(me,{isOpen:B.value,title:"删除",description:"确定要删除吗？此操作不可撤销。",isLoading:D.value,triggerRect:E.value,onClose:M,onConfirm:X},null,8,["isOpen","isLoading","triggerRect"])])]),_:1}))}};export{He as default};
