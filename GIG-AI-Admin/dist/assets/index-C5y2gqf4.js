import{r as y,p as Q,w as ue,o as ge,m as Xe,c as $,a as d,b as u,t as p,d as g,e as a,g as A,f as c,h as n,u as i,F as m,i as w,j as f,n as W,k as ce,l as k,q as x,v as fe}from"./index-xq2XRaRu.js";import{_ as Ye,a as Ge}from"./AdminLayout-B0_4BplP.js";import{_ as He,f as Z}from"./Primitive-B-hdltSd.js";import{_ as V}from"./Button.vue_vue_type_script_setup_true_lang-BOYf09sq.js";import{_ as pe,a as Qe}from"./DeleteConfirmDialog-nyBrJccv.js";import{_ as We,a as Ze,b as ee,c as _,d as er,e as b,f as rr,g as tr,h as ar,i as or,j as sr,k as lr}from"./PaginationPrevious.vue_vue_type_script_setup_true_lang-DYzsThT8.js";import{g as ve,p as nr,a as dr,d as ir}from"./http-VbNDWnN5.js";import{g as ur}from"./keywrods-C-vDhztC.js";import{g as gr}from"./prompts-DVSTLn-0.js";import{a as cr}from"./index-gNOMr9Xr.js";import{g as fr}from"./tag-DedOpex5.js";import{g as pr}from"./aiCofig-BCxDF537.js";import{g as yr,r as vr}from"./platform-whPn9DHK.js";import{a as br}from"./follow-Cxjrz1QX.js";import{T as re,P as ye}from"./platforms-DK9rrH31.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const _r=T=>ve("/tasks/scheduled/",{params:T}),mr=T=>ve(`/tasks/scheduled/${T}/`),wr=T=>dr("/tasks/scheduled/",T),kr=(T,C)=>nr(`/tasks/scheduled/${T}/`,C),xr=T=>ir(`/tasks/scheduled/${T}/`),hr={class:"space-y-5 sm:space-y-6"},Ar={class:"mb-4 flex items-center justify-between"},Tr={class:"flex items-center justify-end gap-2"},$r=["onClick"],Cr={key:0,class:"mt-4"},Sr={class:"relative z-10 w-full max-w-xl rounded-xl bg-white p-6 shadow-lg dark:bg-gray-900"},Fr={class:"mb-4 text-lg font-semibold"},Or={key:0},Ur={key:0},Vr=["value"],Mr={class:"grid grid-cols-1 gap-4 sm:grid-cols-2 mt-4"},jr=["disabled"],Nr=["value"],zr={key:1},Dr={key:0},Pr=["value"],Lr={class:"grid grid-cols-1 gap-4 sm:grid-cols-2 mt-4"},Br=["value"],Rr=["disabled"],Ir=["value"],Er={key:2,class:"grid grid-cols-1 gap-4 sm:grid-cols-2"},Kr={class:"sm:col-span-2"},qr=["value"],Jr={key:3,class:"grid grid-cols-1 gap-4 sm:grid-cols-2"},Xr=["value"],Yr=["value"],Gr=["value"],Hr=["value"],Qr={class:"sm:col-span-2"},Wr={class:"sm:col-span-2"},Zr={class:"relative tag-dropdown"},et={key:0,class:"text-gray-400"},rt={key:1,class:"flex flex-wrap gap-1"},tt={class:"px-1"},at=["onClick"],ot={class:"absolute right-3 top-1/2 transform -translate-y-1/2 pointer-events-none"},st={key:0,class:"absolute z-50 w-full mt-1 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded-lg shadow-lg max-h-60 overflow-y-auto"},lt={key:0,class:"px-4 py-2 text-sm text-gray-500 dark:text-gray-400"},nt={key:1},dt=["onClick"],it={key:0,class:"text-blue-500"},ut={class:"mt-1 text-xs text-gray-500"},gt={class:"flex justify-end gap-3 pt-2"},ct={class:"relative z-10 w-full max-w-4xl rounded-xl bg-white p-6 shadow-lg dark:bg-gray-900"},ft={key:0,class:"flex items-center justify-center py-8"},pt={key:1,class:"space-y-4"},yt={class:"flex items-center justify-between mb-2"},vt={class:"text-sm font-medium text-gray-700 dark:text-gray-300"},bt={class:"text-sm text-gray-600 dark:text-gray-400 space-y-1"},_t={key:0},mt={key:1},wt={key:2},kt={key:2,class:"text-center py-8 text-gray-500 dark:text-gray-400"},xt={class:"flex justify-end gap-3 pt-4"},Lt={__name:"index",setup(T){const C=localStorage.getItem("role"),te=JSON.parse(localStorage.getItem("profile")),be=y("任务列表"),S=y([]),z=y([]),I=y([]),E=y([]),K=y([]),D=y([]),F=y([]),O=y(!1),h=y(""),ae=y(!1),oe=y(!1),_e=y(!1),q=y(!1),P=y([]),M=y(1),se=y(20),J=y(0),L=y(!1),j=y(null),o=y({owner:C=="user"?te.id:"",provider:"",type:"",keyword:"",prompt:"",ai_config_id:"",social_config_id:"",recurrence_type:"daily",day_of_month:1,time_of_day:"09:00",enabled:!0,tags:[],follow_target_ids:[],interval_value:1}),X=y(!1),B=y(!1),R=y(null),le=y({top:0,left:0,width:0,height:0}),U=Q(()=>j.value!==null);Q(()=>S.value.some(t=>t.type==="follow"));function me(){j.value=null,L.value=!0}async function we(t){var r,e;j.value=t.id;try{const s=await mr(String(t.id));if(o.value={owner:s.owner??t.owner,provider:s.provider??t.provider,type:s.type??t.type,keyword:s.keyword_config_id??t.keyword_config_id,prompt:s.prompt_config_id??t.prompt_config_id,ai_config_id:s.ai_config_id??t.ai_config_id??"",social_config_id:s.social_config_id??t.social_config_id??"",recurrence_type:s.recurrence_type??t.recurrence_type,day_of_month:s.day_of_month??t.day_of_month,time_of_day:s.time_of_day??t.time_of_day,enabled:typeof s.enabled=="boolean"?s.enabled:t.enabled,tags:Array.isArray(s.tags)?s.tags:Array.isArray(t.tags)?t.tags:[],follow_target_ids:Array.isArray(s.follow_target_ids)?s.follow_target_ids:Array.isArray(t.follow_target_ids)?t.follow_target_ids:[],interval_value:s.interval_value??t.interval_value??1},s.follow_targets&&Array.isArray(s.follow_targets)&&s.follow_targets.length>0){const l=s.follow_targets.map(v=>v.id).filter(v=>v);o.value.follow_target_ids=l,h.value=l[0]||""}else o.value.follow_target_ids&&o.value.follow_target_ids.length>0?h.value=o.value.follow_target_ids[0]:h.value=""}catch(s){if(console.error("Failed to fetch task detail:",s),p.error("获取任务详情失败",{description:((e=(r=s.response)==null?void 0:r.data)==null?void 0:e.message)||s.message||"获取任务详情时发生错误"}),o.value={owner:t.owner,provider:t.provider,type:t.type,keyword:t.keyword_config_id,prompt:t.prompt_config_id,ai_config_id:t.ai_config_id??"",social_config_id:t.social_config_id??"",recurrence_type:t.recurrence_type,day_of_month:t.day_of_month,time_of_day:t.time_of_day,enabled:t.enabled,tags:Array.isArray(t.tags)?t.tags:[],follow_target_ids:Array.isArray(t.follow_target_ids)?t.follow_target_ids:[],interval_value:t.interval_value??1},t.follow_targets&&Array.isArray(t.follow_targets)&&t.follow_targets.length>0){const l=t.follow_targets.map(v=>v.id).filter(v=>v);o.value.follow_target_ids=l,h.value=l[0]||""}else o.value.follow_target_ids&&o.value.follow_target_ids.length>0?h.value=o.value.follow_target_ids[0]:h.value=""}L.value=!0}function Y(){L.value=!1,j.value=null,o.value={owner:C=="user"?te.id:"",provider:"",type:"",keyword:"",prompt:"",ai_config_id:"",social_config_id:"",recurrence_type:"daily",day_of_month:1,time_of_day:"09:00",enabled:!0,tags:[],follow_target_ids:[],interval_value:1},h.value=""}async function ke(){var t,r;if(o.value.tags.length>5){p.error("话题选择数量超限",{description:"最多只能选择5个话题"});return}if(o.value.type==="follow"){if(!o.value.owner){p.error("目标用户不能为空",{description:"请选择目标用户"});return}if(!o.value.type){p.error("类型不能为空",{description:"请选择类型"});return}if(!o.value.follow_target_ids||o.value.follow_target_ids.length===0){p.error("关注列表不能为空",{description:"请选择关注列表"});return}}else{if(!o.value.owner){p.error("目标用户不能为空",{description:"请选择目标用户"});return}if(!o.value.provider){p.error("平台不能为空",{description:"请选择平台"});return}if(!o.value.type){p.error("类型不能为空",{description:"请选择类型"});return}if(!o.value.keyword){p.error("关键词不能为空",{description:"请选择关键词"});return}if(!o.value.prompt){p.error("提示词不能为空",{description:"请选择提示词"});return}if(!o.value.ai_config_id){p.error("大模型不能为空",{description:"请选择大模型"});return}if(!o.value.social_config_id){p.error("平台账号不能为空",{description:"请选择平台账号"});return}if(!o.value.day_of_month){p.error("循环周期不能为空",{description:"请输入循环周期"});return}if(!o.value.time_of_day){p.error("执行时间不能为空",{description:"请选择执行时间"});return}}try{const e={type:o.value.type,enabled:o.value.enabled};o.value.type==="follow"?(e.owner=o.value.owner,e.provider=o.value.provider,e.follow_target_ids=o.value.follow_target_ids,e.interval_value=o.value.interval_value):(e.owner=o.value.owner,e.provider=o.value.provider,e.keyword_config_id=o.value.keyword,e.prompt_config_id=o.value.prompt,e.ai_config_id=o.value.ai_config_id,e.social_config_id=o.value.social_config_id,e.recurrence_type=o.value.recurrence_type,e.day_of_month=o.value.day_of_month,e.time_of_day=o.value.time_of_day,e.tags=o.value.tags),U.value?(await kr(String(j.value),e),p.success("任务更新成功")):(await wr(e),p.success("任务创建成功")),await N(),Y()}catch(e){console.error("Failed to save task:",e),p.error(U.value?"更新失败":"创建失败",{description:((r=(t=e.response)==null?void 0:t.data)==null?void 0:r.message)||e.message||(U.value?"更新任务时发生错误":"创建任务时发生错误")})}}async function xe(t){var r,e;try{q.value=!0,await vr(String(t.id),{}),p.success("任务执行成功",{description:"任务已开始执行"}),N()}catch(s){console.error("Failed to run task:",s),p.error("执行失败",{description:((e=(r=s.response)==null?void 0:r.data)==null?void 0:e.message)||s.message||"执行任务时发生错误"})}finally{q.value=!1}}function ne(){oe.value=!1,P.value=[]}function he(t){return{pending:"等待中",running:"执行中",completed:"已完成",failed:"执行失败",cancelled:"已取消"}[t]||t||"未知状态"}function Ae(t){return{pending:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200",running:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200",completed:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",failed:"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200",cancelled:"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200"}[t]||"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200"}function Te(t,r){R.value=t;const e=r.target.getBoundingClientRect();le.value={top:e.top,left:e.left,width:e.width,height:e.height,bottom:e.bottom},X.value=!0}async function $e(){var t,r;if(R.value){B.value=!0;try{await xr(String(R.value.id)),p.success("任务删除成功"),await N(),de()}catch(e){console.error("Failed to delete task:",e),p.error("删除失败",{description:((r=(t=e.response)==null?void 0:t.data)==null?void 0:r.message)||e.message||"删除任务时发生错误"})}finally{B.value=!1}}}function de(){X.value=!1,R.value=null,B.value=!1}function Ce(t){return{daily:"日",weekly:"周",monthly:"月"}[t]||t}function Se(t){const r=re.find(e=>e.value===t);return r?r.label:t}function Fe(t){const r=ye.find(e=>e.value===t);return r?r.label:t}function Oe(t){if(!t)return"--";const r=D.value.find(e=>e.id===t);return r?r.name:`账号${t}`}function Ue(t){if(!t||!Array.isArray(t)||t.length===0)return"--";const r=t.filter(s=>s&&s.id);return r.length===0?"--":r.map(s=>{const l=I.value.find(v=>v.id===s.id);return l?l.name:`账号${s.id}`}).join(", ")}function Ve(t){return!t||!Array.isArray(t)||t.length===0?"--":t.map(e=>{const s=F.value.find(l=>l.id===e);return s?s.name:`话题${e}`}).join(", ")}function Me(t){const r=F.value.find(e=>e.id===t);return r?r.name:`话题${t}`}function je(t){const r=o.value.tags.indexOf(t);r>-1&&o.value.tags.splice(r,1)}function Ne(){O.value=!O.value}function ze(t){const r=o.value.tags.indexOf(t);r>-1?o.value.tags.splice(r,1):o.value.tags.length<5?o.value.tags.push(t):p.error("话题选择数量超限",{description:"最多只能选择5个话题"})}function De(){h.value?o.value.follow_target_ids=[h.value]:o.value.follow_target_ids=[]}const G=y([]),H=y([]),Pe=Q(()=>H.value);async function N(){var t,r;try{const e=await _r({page:M.value,page_size:se.value}),s=e&&e.results?e.results:e;S.value=Array.isArray(s)?s.map(l=>({id:l.id,owner:l.owner,provider:l.provider,type:l.type,keyword_config_id:l.keyword_config_id,keyword_config:l.keyword_config,prompt_config_id:l.prompt_config_id,prompt_config:l.prompt_config,ai_config_id:l.ai_config_id,ai_config:l.ai_config,social_config_id:l.social_config_id,recurrence_type:l.recurrence_type,day_of_month:l.day_of_month,time_of_day:l.time_of_day,enabled:l.enabled,created_at:l.created_at,tags:l.tags,target_account:l.target_account,ai_accounts:l.ai_accounts,follow_result:l.follow_result,follow_target_ids:l.follow_target_ids,follow_targets:l.follow_targets})):[],console.log(S.value,"tasks.value"),J.value=e.count||0}catch(e){console.error("Failed to fetch tasks:",e),p.error("获取任务列表失败",{description:((r=(t=e.response)==null?void 0:t.data)==null?void 0:r.message)||e.message||"获取任务列表时发生错误"}),S.value=[]}}async function Le(){var t,r;if(C!="user")try{const e=await cr({}),s=e&&e.results?e.results:e;z.value=Array.isArray(s)?s.map(l=>({id:l.id??l.pk??l.uuid,name:l.username||l.name||l.email||`用户${l.id}`})):[]}catch(e){console.error("Failed to fetch users:",e),p.error("获取用户列表失败",{description:((r=(t=e.response)==null?void 0:t.data)==null?void 0:r.message)||e.message||"获取用户列表时发生错误"}),z.value=[]}}async function Be(){var t,r;try{const e=await ur(),s=e&&e.results?e.results:e;G.value=Array.isArray(s)?s.map(l=>({id:l.id,name:l.name,keyword:l.include_keywords})).filter(Boolean):[]}catch(e){console.error("Failed to fetch keywords:",e),p.error("获取关键词列表失败",{description:((r=(t=e.response)==null?void 0:t.data)==null?void 0:r.message)||e.message||"获取关键词列表时发生错误"}),G.value=[]}}async function Re(){var t,r;try{const e=await gr(),s=e&&e.results?e.results:e;H.value=Array.isArray(s)?s.map(l=>({id:l.id,name:l.name,content:l.content})):[]}catch(e){console.error("Failed to fetch prompts:",e),p.error("获取提示词列表失败",{description:((r=(t=e.response)==null?void 0:t.data)==null?void 0:r.message)||e.message||"获取提示词列表时发生错误"}),H.value=[]}}async function Ie(){var t,r;try{I.value=[{id:"1",name:"AI账号1"},{id:"2",name:"AI账号2"},{id:"3",name:"AI账号3"}]}catch(e){console.error("Failed to fetch AI accounts:",e),p.error("获取AI账号列表失败",{description:((r=(t=e.response)==null?void 0:t.data)==null?void 0:r.message)||e.message||"获取AI账号列表时发生错误"}),I.value=[]}}async function Ee(){var t,r;try{const e=await fr({}),s=e&&e.results?e.results:e;F.value=Array.isArray(s)?s.map(l=>({id:l.id,name:l.name})):[]}catch(e){console.error("Failed to fetch tags:",e),p.error("获取话题列表失败",{description:((r=(t=e.response)==null?void 0:t.data)==null?void 0:r.message)||e.message||"获取话题列表时发生错误"}),F.value=[]}}async function Ke(){try{const t=await br({});E.value=t.results||[]}catch(t){console.error("获取关注列表失败:",t),E.value=[]}}async function qe(){var t,r;try{const e=await pr({search:"",page:1}),s=e&&e.results?e.results:e;K.value=Array.isArray(s)?s.map(l=>({id:l.id,name:l.name})):[]}catch(e){console.error("Failed to fetch models:",e),p.error("获取大模型列表失败",{description:((r=(t=e.response)==null?void 0:t.data)==null?void 0:r.message)||e.message||"获取大模型列表时发生错误"}),K.value=[]}}async function Je(){var t,r;try{const e=await yr({}),s=e&&e.results?e.results:e;D.value=Array.isArray(s)?s.map(l=>({id:l.id,name:l.external_username||l.name||l.username||`账号${l.id}`})):[]}catch(e){console.error("Failed to fetch platform accounts:",e),p.error("获取平台账号列表失败",{description:((r=(t=e.response)==null?void 0:t.data)==null?void 0:r.message)||e.message||"获取平台账号列表时发生错误"}),D.value=[]}}ue(M,()=>{N()}),ue(()=>o.value.type,t=>{t==="follow"&&(o.value.provider="twitter")});function ie(t){O.value&&!t.target.closest(".tag-dropdown")&&(O.value=!1),ae.value&&!t.target.closest(".ai-account-dropdown")&&(ae.value=!1)}return ge(()=>{document.addEventListener("click",ie)}),Xe(()=>{document.removeEventListener("click",ie)}),ge(async()=>{await Promise.all([N(),Le(),Be(),Re(),Ie(),Ke(),Ee(),qe(),Je()])}),(t,r)=>(d(),$(Ye,null,{default:u(()=>[g(Ge,{pageTitle:be.value},null,8,["pageTitle"]),a("div",hr,[g(He,null,{default:u(()=>[a("div",Ar,[r[16]||(r[16]=a("div",null,null,-1)),g(V,{size:"sm",onClick:me},{default:u(()=>[...r[15]||(r[15]=[n("新增",-1)])]),_:1})]),g(i(We),{class:"[&_td]:py-3.5 [&_th]:py-3.5"},{default:u(()=>[g(i(Ze),null,{default:u(()=>[g(i(ee),null,{default:u(()=>[g(i(_),{class:"whitespace-nowrap"},{default:u(()=>[...r[17]||(r[17]=[n("序号",-1)])]),_:1}),g(i(_),{class:"whitespace-nowrap"},{default:u(()=>[...r[18]||(r[18]=[n("平台名称",-1)])]),_:1}),g(i(_),{class:"whitespace-nowrap"},{default:u(()=>[...r[19]||(r[19]=[n("关注账户",-1)])]),_:1}),g(i(_),{class:"whitespace-nowrap"},{default:u(()=>[...r[20]||(r[20]=[n("触发关键词",-1)])]),_:1}),g(i(_),{class:"whitespace-nowrap"},{default:u(()=>[...r[21]||(r[21]=[n("提示词",-1)])]),_:1}),g(i(_),{class:"whitespace-nowrap"},{default:u(()=>[...r[22]||(r[22]=[n("大模型",-1)])]),_:1}),g(i(_),{class:"whitespace-nowrap"},{default:u(()=>[...r[23]||(r[23]=[n("平台账户",-1)])]),_:1}),g(i(_),{class:"whitespace-nowrap"},{default:u(()=>[...r[24]||(r[24]=[n("任务类型",-1)])]),_:1}),g(i(_),{class:"whitespace-nowrap"},{default:u(()=>[...r[25]||(r[25]=[n("状态",-1)])]),_:1}),g(i(_),{class:"whitespace-nowrap"},{default:u(()=>[...r[26]||(r[26]=[n("循环周期",-1)])]),_:1}),g(i(_),{class:"whitespace-nowrap"},{default:u(()=>[...r[27]||(r[27]=[n("循环类型",-1)])]),_:1}),g(i(_),{class:"whitespace-nowrap"},{default:u(()=>[...r[28]||(r[28]=[n("执行时间",-1)])]),_:1}),g(i(_),{class:"whitespace-nowrap"},{default:u(()=>[...r[29]||(r[29]=[n("话题",-1)])]),_:1}),g(i(_),{class:"whitespace-nowrap"},{default:u(()=>[...r[30]||(r[30]=[n("对方账号",-1)])]),_:1}),g(i(_),{class:"whitespace-nowrap",style:{"min-width":"100px"}},{default:u(()=>[...r[31]||(r[31]=[n("AI账号",-1)])]),_:1}),g(i(_),{class:"whitespace-nowrap"},{default:u(()=>[...r[32]||(r[32]=[n("执行结果",-1)])]),_:1}),g(i(_),{class:"whitespace-nowrap"},{default:u(()=>[...r[33]||(r[33]=[n("创建时间",-1)])]),_:1}),g(i(_),{class:"whitespace-nowrap text-right sticky right-0 bg-white dark:bg-gray-900 z-10 w-40"},{default:u(()=>[...r[34]||(r[34]=[n("操作",-1)])]),_:1})]),_:1})]),_:1}),g(i(er),null,{default:u(()=>[S.value.length?(d(!0),c(m,{key:0},w(S.value,(e,s)=>(d(),$(i(ee),{key:e.id},{default:u(()=>{var l;return[g(i(b),{class:"whitespace-nowrap"},{default:u(()=>[n(f(s+1),1)]),_:2},1024),g(i(b),{class:"whitespace-nowrap"},{default:u(()=>[n(f(Fe(e.provider)),1)]),_:2},1024),g(i(b),{class:"whitespace-nowrap"},{default:u(()=>[n(f(e.follow_targets&&e.follow_targets.length>0?e.follow_targets[0].external_user_id:"--"),1)]),_:2},1024),g(i(b),{class:"whitespace-nowrap"},{default:u(()=>{var v;return[n(f(((v=e.keyword_config)==null?void 0:v.name)||"--"),1)]}),_:2},1024),g(i(b),{class:"max-w-[380px] truncate",title:(l=e.prompt_config)==null?void 0:l.name},{default:u(()=>{var v;return[n(f(((v=e.prompt_config)==null?void 0:v.name)||"--"),1)]}),_:2},1032,["title"]),g(i(b),{class:"whitespace-nowrap"},{default:u(()=>{var v;return[n(f(((v=e.ai_config)==null?void 0:v.name)||"--"),1)]}),_:2},1024),g(i(b),{class:"whitespace-nowrap"},{default:u(()=>[n(f(Oe(e.social_config_id)),1)]),_:2},1024),g(i(b),{class:"whitespace-nowrap"},{default:u(()=>[n(f(Se(e.type)),1)]),_:2},1024),g(i(b),{class:"whitespace-nowrap"},{default:u(()=>[a("span",{class:W(["inline-flex items-center rounded-full px-2 py-0.5 text-xs font-medium ring-1 ring-inset",e.enabled?"bg-emerald-50 text-emerald-600 ring-emerald-200 dark:bg-emerald-500/10 dark:text-emerald-400 dark:ring-emerald-500/30":"bg-rose-50 text-rose-600 ring-rose-200 dark:bg-rose-500/10 dark:text-rose-400 dark:ring-rose-500/30"])},f(e.enabled?"启用":"停用"),3)]),_:2},1024),g(i(b),{class:"whitespace-nowrap"},{default:u(()=>[n(f(e.day_of_month),1)]),_:2},1024),g(i(b),{class:"whitespace-nowrap"},{default:u(()=>[n(f(Ce(e.recurrence_type)),1)]),_:2},1024),g(i(b),{class:"whitespace-nowrap"},{default:u(()=>[n(f(e.time_of_day),1)]),_:2},1024),g(i(b),{class:"whitespace-nowrap"},{default:u(()=>[n(f(Ve(e.tags)),1)]),_:2},1024),g(i(b),{class:"whitespace-nowrap"},{default:u(()=>[n(f(e.target_account||"--"),1)]),_:2},1024),g(i(b),{class:"whitespace-nowrap",style:{"min-width":"100px"}},{default:u(()=>[n(f(Ue(e.ai_accounts)),1)]),_:2},1024),g(i(b),{class:"whitespace-nowrap"},{default:u(()=>[n(f(e.completed?"已完成":"未完成"),1)]),_:2},1024),g(i(b),{class:"whitespace-nowrap"},{default:u(()=>[n(f(i(Z)(e.created_at)),1)]),_:2},1024),g(i(b),{class:"text-right whitespace-nowrap sticky right-0 bg-white dark:bg-gray-900 z-10 w-40"},{default:u(()=>[a("div",Tr,[e.completed?A("",!0):(d(),$(V,{key:0,size:"sm",variant:"outline",onClick:v=>xe(e),disabled:q.value},{default:u(()=>[...r[35]||(r[35]=[n("立即执行",-1)])]),_:1},8,["onClick","disabled"])),g(V,{size:"sm",variant:"outline",onClick:v=>we(e)},{default:u(()=>[...r[36]||(r[36]=[n("编辑",-1)])]),_:1},8,["onClick"]),a("button",{class:"inline-flex items-center justify-center font-medium gap-2 rounded-lg transition px-4 py-3 text-sm bg-white text-gray-700 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 dark:bg-gray-800 dark:text-gray-400 dark:ring-gray-700 dark:hover:bg-white/[0.03] dark:hover:text-gray-300 text-rose-600 ring-rose-200 hover:bg-rose-50 dark:text-rose-400 dark:ring-rose-500/30",onClick:v=>Te(e,v)}," 删除 ",8,$r)])]),_:2},1024)]}),_:2},1024))),128)):(d(),$(i(ee),{key:1},{default:u(()=>[g(i(b),{colspan:10,class:"py-16 text-center text-gray-400 dark:text-white/40"},{default:u(()=>[...r[37]||(r[37]=[n("暂无数据",-1)])]),_:1})]),_:1}))]),_:1})]),_:1}),J.value>0?(d(),c("div",Cr,[g(i(rr),{page:M.value,"onUpdate:page":r[0]||(r[0]=e=>M.value=e),total:J.value,"items-per-page":se.value,"sibling-count":1},{default:u(()=>[g(i(tr),null,{default:u(({items:e})=>[g(i(ar)),(d(!0),c(m,null,w(e,(s,l)=>(d(),c(m,{key:l},[s.type==="page"?(d(),$(i(or),{key:0,value:s.value,"is-active":s.value===M.value},{default:u(()=>[n(f(s.value),1)]),_:2},1032,["value","is-active"])):(d(),$(i(sr),{key:1,index:l},null,8,["index"]))],64))),128)),g(i(lr))]),_:1})]),_:1},8,["page","total","items-per-page"])])):A("",!0)]),_:1}),L.value?(d(),$(pe,{key:0,fullScreenBackdrop:!0,onClose:Y},{body:u(()=>[a("div",Sr,[a("h3",Fr,f(U.value?"编辑任务":"新增任务"),1),a("form",{onSubmit:ce(ke,["prevent"]),class:"space-y-4"},[o.value.type==="follow"?(d(),c("div",Or,[i(C)=="admin"?(d(),c("div",Ur,[r[39]||(r[39]=a("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[n("目标用户"),a("span",{class:"text-error-500"},"*")],-1)),k(a("select",{"onUpdate:modelValue":r[1]||(r[1]=e=>o.value.owner=e),class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},[r[38]||(r[38]=a("option",{value:"",disabled:""},"请选择目标用户",-1)),(d(!0),c(m,null,w(z.value,e=>(d(),c("option",{key:e.id,value:e.id},f(e.name),9,Vr))),128))],512),[[x,o.value.owner]])])):A("",!0),a("div",Mr,[a("div",null,[r[41]||(r[41]=a("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[n("类型"),a("span",{class:"text-error-500"},"*")],-1)),k(a("select",{"onUpdate:modelValue":r[2]||(r[2]=e=>o.value.type=e),disabled:U.value,class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800 disabled:opacity-50 disabled:cursor-not-allowed"},[r[40]||(r[40]=a("option",{value:""},"请选择类型",-1)),(d(!0),c(m,null,w(i(re),e=>(d(),c("option",{key:e.value,value:e.value},f(e.label),9,Nr))),128))],8,jr),[[x,o.value.type]])])])])):(d(),c("div",zr,[i(C)=="admin"?(d(),c("div",Dr,[r[43]||(r[43]=a("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[n("目标用户"),a("span",{class:"text-error-500"},"*")],-1)),k(a("select",{"onUpdate:modelValue":r[3]||(r[3]=e=>o.value.owner=e),class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},[r[42]||(r[42]=a("option",{value:"",disabled:""},"请选择目标用户",-1)),(d(!0),c(m,null,w(z.value,e=>(d(),c("option",{key:e.id,value:e.id},f(e.name),9,Pr))),128))],512),[[x,o.value.owner]])])):A("",!0),a("div",Lr,[a("div",null,[r[45]||(r[45]=a("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[n("平台"),a("span",{class:"text-error-500"},"*")],-1)),k(a("select",{"onUpdate:modelValue":r[4]||(r[4]=e=>o.value.provider=e),class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},[r[44]||(r[44]=a("option",{value:""},"请选择平台",-1)),(d(!0),c(m,null,w(i(ye),e=>(d(),c("option",{key:e.value,value:e.value},f(e.label),9,Br))),128))],512),[[x,o.value.provider]])]),a("div",null,[r[47]||(r[47]=a("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[n("类型"),a("span",{class:"text-error-500"},"*")],-1)),k(a("select",{"onUpdate:modelValue":r[5]||(r[5]=e=>o.value.type=e),disabled:U.value,class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800 disabled:opacity-50 disabled:cursor-not-allowed"},[r[46]||(r[46]=a("option",{value:""},"请选择类型",-1)),(d(!0),c(m,null,w(i(re),e=>(d(),c("option",{key:e.value,value:e.value},f(e.label),9,Ir))),128))],8,Rr),[[x,o.value.type]])])])])),o.value.type==="follow"?(d(),c("div",Er,[a("div",Kr,[r[49]||(r[49]=a("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[n("关注账户"),a("span",{class:"text-error-500"},"*")],-1)),k(a("select",{"onUpdate:modelValue":r[6]||(r[6]=e=>h.value=e),onChange:De,class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},[r[48]||(r[48]=a("option",{value:""},"请选择关注账户",-1)),(d(!0),c(m,null,w(E.value,e=>(d(),c("option",{key:e.id,value:e.id},f(e.external_user_id),9,qr))),128))],544),[[x,h.value]])])])):(d(),c("div",Jr,[a("div",null,[r[51]||(r[51]=a("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[n("关键词"),a("span",{class:"text-error-500"},"*")],-1)),k(a("select",{"onUpdate:modelValue":r[7]||(r[7]=e=>o.value.keyword=e),class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},[r[50]||(r[50]=a("option",{value:""},"请选择关键词",-1)),(d(!0),c(m,null,w(G.value,e=>(d(),c("option",{key:e.id,value:e.id},f(e.name),9,Xr))),128))],512),[[x,o.value.keyword]])]),a("div",null,[r[53]||(r[53]=a("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[n("提示词"),a("span",{class:"text-error-500"},"*")],-1)),k(a("select",{"onUpdate:modelValue":r[8]||(r[8]=e=>o.value.prompt=e),class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},[r[52]||(r[52]=a("option",{value:""},"请选择提示词",-1)),(d(!0),c(m,null,w(Pe.value,e=>(d(),c("option",{key:e.id,value:e.id},f(e.name),9,Yr))),128))],512),[[x,o.value.prompt]])]),a("div",null,[r[55]||(r[55]=a("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[n("大模型"),a("span",{class:"text-error-500"},"*")],-1)),k(a("select",{"onUpdate:modelValue":r[9]||(r[9]=e=>o.value.ai_config_id=e),class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},[r[54]||(r[54]=a("option",{value:""},"请选择大模型",-1)),(d(!0),c(m,null,w(K.value,e=>(d(),c("option",{key:e.id,value:e.id},f(e.name),9,Gr))),128))],512),[[x,o.value.ai_config_id]])]),a("div",null,[r[57]||(r[57]=a("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[n("平台账号"),a("span",{class:"text-error-500"},"*")],-1)),k(a("select",{"onUpdate:modelValue":r[10]||(r[10]=e=>o.value.social_config_id=e),class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},[r[56]||(r[56]=a("option",{value:""},"请选择平台账号",-1)),(d(!0),c(m,null,w(D.value,e=>(d(),c("option",{key:e.id,value:e.id},f(e.name),9,Hr))),128))],512),[[x,o.value.social_config_id]])]),a("div",null,[r[59]||(r[59]=a("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[n("循环类型"),a("span",{class:"text-error-500"},"*")],-1)),k(a("select",{"onUpdate:modelValue":r[11]||(r[11]=e=>o.value.recurrence_type=e),class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},[...r[58]||(r[58]=[a("option",{value:"daily"},"日",-1),a("option",{value:"weekly"},"周",-1),a("option",{value:"monthly"},"月",-1)])],512),[[x,o.value.recurrence_type]])]),a("div",null,[r[60]||(r[60]=a("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[n("循环周期"),a("span",{class:"text-error-500"},"*")],-1)),k(a("input",{"onUpdate:modelValue":r[12]||(r[12]=e=>o.value.day_of_month=e),type:"number",min:"1",placeholder:"如：1",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[fe,o.value.day_of_month,void 0,{number:!0}]])]),a("div",Qr,[r[61]||(r[61]=a("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[n("执行时间"),a("span",{class:"text-error-500"},"*")],-1)),k(a("input",{"onUpdate:modelValue":r[13]||(r[13]=e=>o.value.time_of_day=e),type:"time",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[fe,o.value.time_of_day]])]),a("div",Wr,[r[64]||(r[64]=a("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[n("话题"),a("span",{class:"text-gray-500 text-xs ml-1"},"(最多选择5个)")],-1)),a("div",Zr,[a("div",{onClick:Ne,class:"dark:bg-dark-900 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs cursor-pointer focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800 min-h-[44px] flex items-center"},[o.value.tags.length===0?(d(),c("div",et,"请选择话题")):(d(),c("div",rt,[(d(!0),c(m,null,w(o.value.tags,e=>(d(),c("span",{key:e,class:"inline-flex items-center px-1.5 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200 whitespace-nowrap"},[a("span",tt,f(Me(e)),1),a("button",{type:"button",onClick:ce(s=>je(e),["stop"]),class:"inline-flex items-center justify-center w-3 h-3 rounded-full text-blue-400 hover:bg-blue-200 hover:text-blue-500 dark:hover:bg-blue-800 dark:hover:text-blue-300"}," X ",8,at)]))),128))])),a("div",ot,[(d(),c("svg",{class:W(["w-4 h-4 text-gray-400 transition-transform duration-200",{"rotate-180":O.value}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...r[62]||(r[62]=[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)])],2))])]),O.value?(d(),c("div",st,[F.value.length===0?(d(),c("div",lt," 暂无话题选项 ")):(d(),c("div",nt,[(d(!0),c(m,null,w(F.value,e=>(d(),c("div",{key:e.id,onClick:s=>ze(e.id),class:"px-4 py-2 text-sm cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center justify-between"},[a("span",null,f(e.name),1),o.value.tags.includes(e.id)?(d(),c("div",it,[...r[63]||(r[63]=[a("svg",{class:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20"},[a("path",{"fill-rule":"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z","clip-rule":"evenodd"})],-1)])])):A("",!0)],8,dt))),128))]))])):A("",!0)]),a("div",ut," 已选择: "+f(o.value.tags.length)+"/5 ",1)]),a("div",null,[r[66]||(r[66]=a("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},"状态",-1)),k(a("select",{"onUpdate:modelValue":r[14]||(r[14]=e=>o.value.enabled=e),class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},[...r[65]||(r[65]=[a("option",{value:!0},"启用",-1),a("option",{value:!1},"停用",-1)])],512),[[x,o.value.enabled]])])])),a("div",gt,[g(V,{type:"button",variant:"outline",onClick:Y},{default:u(()=>[...r[67]||(r[67]=[n("取消",-1)])]),_:1}),g(V,{type:"submit"},{default:u(()=>[...r[68]||(r[68]=[n("保存",-1)])]),_:1})])],32)])]),_:1})):A("",!0),g(Qe,{isOpen:X.value,title:"删除",description:"确定要删除吗？此操作不可撤销。",isLoading:B.value,triggerRect:le.value,onClose:de,onConfirm:$e},null,8,["isOpen","isLoading","triggerRect"]),oe.value?(d(),$(pe,{key:1,fullScreenBackdrop:!0,onClose:ne},{body:u(()=>[a("div",ct,[r[75]||(r[75]=a("h3",{class:"mb-4 text-lg font-semibold"},"执行结果",-1)),_e.value?(d(),c("div",ft,[...r[69]||(r[69]=[a("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"},null,-1),a("span",{class:"ml-2 text-gray-600"},"加载中...",-1)])])):P.value&&P.value.length>0?(d(),c("div",pt,[(d(!0),c(m,null,w(P.value,(e,s)=>(d(),c("div",{key:s,class:"border border-gray-200 dark:border-gray-700 rounded-lg p-4"},[a("div",yt,[a("span",vt,"执行记录 "+f(s+1),1),a("span",{class:W(["text-xs px-2 py-1 rounded-full",Ae(e.status)])},f(he(e.status)),3)]),a("div",bt,[a("div",null,[r[70]||(r[70]=a("strong",null,"开始时间:",-1)),n(" "+f(i(Z)(e.started_at)),1)]),e.finished_at?(d(),c("div",_t,[r[71]||(r[71]=a("strong",null,"结束时间:",-1)),n(" "+f(i(Z)(e.finished_at)),1)])):A("",!0),e.error_message?(d(),c("div",mt,[r[72]||(r[72]=a("strong",null,"错误信息:",-1)),n(" "+f(e.error_message),1)])):A("",!0),e.result?(d(),c("div",wt,[r[73]||(r[73]=a("strong",null,"执行结果:",-1)),n(" "+f(e.result),1)])):A("",!0)])]))),128))])):(d(),c("div",kt," 暂无执行结果 ")),a("div",xt,[g(V,{type:"button",variant:"outline",onClick:ne},{default:u(()=>[...r[74]||(r[74]=[n("关闭",-1)])]),_:1})])])]),_:1})):A("",!0)])]),_:1}))}};export{Lt as default};
