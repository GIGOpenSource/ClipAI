import{_ as Z,a as ee}from"./AdminLayout-DQIL8PPP.js";import{_ as te,f as ae}from"./Primitive-BzEJsbHJ.js";import{_ as A}from"./Button.vue_vue_type_script_setup_true_lang-BdSejp5h.js";import{_ as se,a as le}from"./DeleteConfirmDialog-BR5qq7Pd.js";import{r as o,w as P,c as z,g as V,a as m,b as s,e as n,l as re,d as a,v as oe,f as C,h as r,j as p,t as k,o as ne,s as ie,u as l,F as O,i as N,n as ue}from"./index-ISKAqpWi.js";import{_ as de}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{a as pe,g as fe,b as ce,c as ge,d as me,e as _e,f as ve,h as we}from"./platform-whPn9DHK.js";import{_ as ke,a as xe,b as S,c,d as ye,e as d,f as be,g as he,h as Ce,i as $e,j as Me,k as ze}from"./PaginationPrevious.vue_vue_type_script_setup_true_lang-CwCaibc-.js";import"./http-VbNDWnN5.js";const Te={class:"relative z-10 w-full max-w-lg rounded-xl bg-white p-6 shadow-lg dark:bg-gray-900"},je={class:"space-y-4"},Ae={class:"flex gap-2"},De={key:0,class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Be={key:1,class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Ue={class:"flex justify-end gap-3 pt-4"},Re={__name:"CallbackUrlModal",props:{isOpen:{type:Boolean,default:!1},url:{type:String,default:""}},emits:["close"],setup(U,{emit:D}){const b=U,B=D,v=o(""),w=o(!1),T=o(null);P(()=>b.url,M=>{v.value=M||""},{immediate:!0});const $=async()=>{if(v.value)try{await navigator.clipboard.writeText(v.value),w.value=!0,k.success("回调地址已复制到剪贴板"),setTimeout(()=>{w.value=!1},2e3)}catch(M){console.error("复制失败:",M),k.error("复制失败，请手动复制")}},x=()=>{B("close"),w.value=!1};return(M,i)=>U.isOpen?(m(),z(se,{key:0,fullScreenBackdrop:!0,onClose:x},{body:s(()=>[n("div",Te,[n("div",{class:"mb-4 flex items-center justify-between"},[i[2]||(i[2]=n("h3",{class:"text-lg font-semibold text-gray-900 dark:text-white"},"查看回调地址",-1)),n("button",{onClick:x,class:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300"},[...i[1]||(i[1]=[n("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),n("div",je,[n("div",null,[i[5]||(i[5]=n("label",{class:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300"}," 回调地址 ",-1)),n("div",Ae,[re(n("input",{ref_key:"urlInput",ref:T,"onUpdate:modelValue":i[0]||(i[0]=y=>v.value=y),type:"text",readonly:"",class:"flex-1 rounded-lg border border-gray-300 bg-gray-50 px-3 py-2 text-sm text-gray-800 dark:border-gray-600 dark:bg-gray-800 dark:text-white",placeholder:"暂无回调地址"},null,512),[[oe,v.value]]),a(A,{type:"button",variant:"outline",size:"sm",onClick:$,disabled:!v.value,class:"px-4"},{default:s(()=>[w.value?(m(),C("svg",Be,[...i[4]||(i[4]=[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])):(m(),C("svg",De,[...i[3]||(i[3]=[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"},null,-1)])])),r(" "+p(w.value?"已复制":"复制"),1)]),_:1},8,["disabled"])])]),n("div",Ue,[a(A,{type:"button",variant:"outline",onClick:x},{default:s(()=>[...i[6]||(i[6]=[r(" 关闭 ",-1)])]),_:1})])])])]),_:1})):V("",!0)}},Ie=de(Re,[["__scopeId","data-v-7bdce6bb"]]),Oe={class:"space-y-5 sm:space-y-6"},Se={class:"mb-4 flex items-center justify-between"},Ve={class:"flex gap-2"},Le={class:"flex items-center justify-end gap-2"},Fe={key:0,class:"mr-2"},Ne=["onClick"],Pe={key:0,class:"mt-4"},Ze={__name:"index",setup(U){const D=ie(),b=o({}),B=o({top:0,left:0,width:0,height:0}),v=o(!1),w=o(!1),T=o(!1),$=o(""),x=o(!1),M=o("平台账户配置"),i=o([]),y=o(1),E=o(20),j=o(0),G=o("");o([]);const q=o("");o(null),o(!1),o([{title:"OpenAI",value:"openai"},{title:"Azure OpenAI",value:"azure"},{title:"Google Gemini",value:"gemini"},{title:"Anthropic",value:"anthropic"},{title:"Custom",value:"custom"}]);function H(){D.push("/platform-accounts/new")}function Q(u){D.push({path:"/platform-accounts/edit",query:{id:u.account_id,config:u.config}})}async function J(u){var e,t;if(!u.provider){k.error("平台信息不完整");return}x.value=!0,$.value="";try{const _={twitter:_e,facebook:me,instagram:ge,threads:ce}[u.provider];if(!_){k.error("暂不支持该平台的回调地址获取");return}const h=await _();h&&h.auth_url?($.value=h.auth_url,T.value=!0):k.error("获取回调地址失败")}catch(f){console.error("获取回调地址失败:",f),k.error("获取回调地址失败",{description:((t=(e=f.response)==null?void 0:e.data)==null?void 0:t.message)||f.message||"请稍后重试"})}finally{x.value=!1}}function K(){T.value=!1,$.value=""}function W(u,e){b.value=u,console.log(e,"evet");const t=e.target.getBoundingClientRect();console.log(t,"buttonRect"),B.value={top:t.top,left:t.left,width:t.width,height:t.height,bottom:t.bottom},v.value=!0}async function X(){var u,e;if(b.value){w.value=!0;try{await ve(b.value.id),await we(b.value.account_id),k.success("删除成功"),await R(),L()}catch(t){console.error("删除失败:",t),k.error("删除失败",{description:((e=(u=t.response)==null?void 0:u.data)==null?void 0:e.message)||t.message||"删除配置时发生错误"})}finally{w.value=!1}}}function L(){v.value=!1,b.value=null,w.value=!1}const R=async()=>{var u,e;try{const t=await pe({page:y.value}),f=t.results||t||[],_=await fe({search:G.value,provider:q.value,page:y.value}),h=_.results||_||[];console.log(h,"配置数据");let Y=f.map(g=>{const F=h.find(I=>I.id===g.config||I.id===g.config_id||I.id===g.configId);return F?{...g,...F,account_id:g.id,account_owner:g.owner,account_created_at:g.created_at,account_updated_at:g.updated_at}:{...g,account_id:g.id,account_owner:g.owner,account_created_at:g.created_at,account_updated_at:g.updated_at}});i.value=Y,j.value=t.count,(h.length==0||f.length==0)&&(i.value=[],j.value=0)}catch(t){console.error("获取列表失败:",t),k.error("获取列表失败",{description:((e=(u=t.response)==null?void 0:u.data)==null?void 0:e.message)||t.message||"获取配置列表时发生错误"}),i.value=[],j.value=0}};return P(y,u=>{console.log("Page changed to:",u),R()}),ne(()=>{R()}),(u,e)=>(m(),z(Z,null,{default:s(()=>[a(ee,{pageTitle:M.value},null,8,["pageTitle"]),n("div",Oe,[a(te,null,{default:s(()=>[n("div",Se,[e[2]||(e[2]=n("div",{class:"flex items-center gap-3"},null,-1)),n("div",Ve,[a(A,{size:"sm",onClick:H},{default:s(()=>[...e[1]||(e[1]=[r("新增",-1)])]),_:1})])]),a(l(ke),{class:"[&_td]:py-3.5 [&_th]:py-3.5"},{default:s(()=>[a(l(xe),null,{default:s(()=>[a(l(S),null,{default:s(()=>[a(l(c),{class:"whitespace-nowrap"},{default:s(()=>[...e[3]||(e[3]=[r("序号",-1)])]),_:1}),a(l(c),{class:"whitespace-nowrap"},{default:s(()=>[...e[4]||(e[4]=[r("平台",-1)])]),_:1}),a(l(c),{class:"whitespace-nowrap"},{default:s(()=>[...e[5]||(e[5]=[r("项目名称",-1)])]),_:1}),a(l(c),{class:"whitespace-nowrap"},{default:s(()=>[...e[6]||(e[6]=[r("是否默认",-1)])]),_:1}),a(l(c),{class:"whitespace-nowrap"},{default:s(()=>[...e[7]||(e[7]=[r("API版本",-1)])]),_:1}),a(l(c),{class:"whitespace-nowrap"},{default:s(()=>[...e[8]||(e[8]=[r("appid",-1)])]),_:1}),a(l(c),{class:"whitespace-nowrap"},{default:s(()=>[...e[9]||(e[9]=[r("app密钥",-1)])]),_:1}),a(l(c),{class:"whitespace-nowrap"},{default:s(()=>[...e[10]||(e[10]=[r("读取使用token",-1)])]),_:1}),a(l(c),{class:"whitespace-nowrap"},{default:s(()=>[...e[11]||(e[11]=[r("账号uid",-1)])]),_:1}),a(l(c),{class:"whitespace-nowrap"},{default:s(()=>[...e[12]||(e[12]=[r("用户名",-1)])]),_:1}),a(l(c),{class:"whitespace-nowrap"},{default:s(()=>[...e[13]||(e[13]=[r("输入token",-1)])]),_:1}),a(l(c),{class:"whitespace-nowrap"},{default:s(()=>[...e[14]||(e[14]=[r("最近调用时间",-1)])]),_:1}),a(l(c),{class:"whitespace-nowrap"},{default:s(()=>[...e[15]||(e[15]=[r("状态",-1)])]),_:1}),a(l(c),{class:"whitespace-nowrap text-right sticky right-0 bg-white dark:bg-gray-900 z-10 w-[100px]"},{default:s(()=>[...e[16]||(e[16]=[r("操作",-1)])]),_:1})]),_:1})]),_:1}),a(l(ye),null,{default:s(()=>[i.value.length?(m(!0),C(O,{key:0},N(i.value,(t,f)=>(m(),z(l(S),{key:t.id},{default:s(()=>[a(l(d),{class:"whitespace-nowrap"},{default:s(()=>[r(p(f+1),1)]),_:2},1024),a(l(d),{class:"whitespace-nowrap"},{default:s(()=>[r(p(t.provider||"--"),1)]),_:2},1024),a(l(d),{class:"whitespace-nowrap"},{default:s(()=>[r(p(t.name||"--"),1)]),_:2},1024),a(l(d),{class:"whitespace-nowrap"},{default:s(()=>[r(p(t.is_default?"是":"否"),1)]),_:2},1024),a(l(d),{class:"whitespace-nowrap"},{default:s(()=>[r(p(t.api_version||"--"),1)]),_:2},1024),a(l(d),{class:"max-w-[200px] truncate",title:t.app_id||t.client_id||"--"},{default:s(()=>[r(p(t.app_id||t.client_id||"--"),1)]),_:2},1032,["title"]),a(l(d),{class:"max-w-[200px] truncate",title:t.refresh_token||"--"},{default:s(()=>[r(p(t.refresh_token||"--"),1)]),_:2},1032,["title"]),a(l(d),{class:"max-w-[200px] truncate",title:t.bearer_token_masked||"--"},{default:s(()=>[r(p(t.bearer_token_masked||"--"),1)]),_:2},1032,["title"]),a(l(d),{class:"max-w-[200px] truncate",title:t.external_user_id||"--"},{default:s(()=>[r(p(t.external_user_id||"--"),1)]),_:2},1032,["title"]),a(l(d),{class:"max-w-[200px] truncate",title:t.external_username||"--"},{default:s(()=>[r(p(t.external_username||"--"),1)]),_:2},1032,["title"]),a(l(d),{class:"max-w-[200px] truncate",title:t.access_token||"--"},{default:s(()=>[r(p(t.access_token||"--"),1)]),_:2},1032,["title"]),a(l(d),{class:"whitespace-nowrap"},{default:s(()=>[r(p(l(ae)(t.updated_at)||"--"),1)]),_:2},1024),a(l(d),{class:"whitespace-nowrap"},{default:s(()=>[n("span",{class:ue(["inline-flex items-center rounded-full px-2 py-0.5 text-xs font-medium ring-1 ring-inset",t.status?"bg-emerald-50 text-emerald-600 ring-emerald-200 dark:bg-emerald-500/10 dark:text-emerald-400 dark:ring-emerald-500/30":"bg-rose-50 text-rose-600 ring-rose-200 dark:bg-rose-500/10 dark:text-rose-400 dark:ring-rose-500/30"])},p(t.status=="active"?"正常":"禁用"),3)]),_:2},1024),a(l(d),{class:"text-right whitespace-nowrap sticky right-0 bg-white dark:bg-gray-900 z-10 w-[280px]"},{default:s(()=>[n("div",Le,[a(A,{size:"sm",variant:"outline",onClick:_=>J(t),disabled:x.value},{default:s(()=>[x.value?(m(),C("span",Fe,"获取中...")):V("",!0),e[17]||(e[17]=r(" 查看回调地址 ",-1))]),_:1},8,["onClick","disabled"]),a(A,{size:"sm",variant:"outline",onClick:_=>Q(t)},{default:s(()=>[...e[18]||(e[18]=[r("编辑",-1)])]),_:1},8,["onClick"]),n("button",{class:"inline-flex items-center justify-center font-medium gap-2 rounded-lg transition px-4 py-3 text-sm bg-white text-gray-700 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 dark:bg-gray-800 dark:text-gray-400 dark:ring-gray-700 dark:hover:bg-white/[0.03] dark:hover:text-gray-300 text-rose-600 ring-rose-200 hover:bg-rose-50 dark:text-rose-400 dark:ring-rose-500/30",onClick:_=>W(t,_)}," 删除 ",8,Ne)])]),_:2},1024)]),_:2},1024))),128)):(m(),z(l(S),{key:1},{default:s(()=>[a(l(d),{colspan:12,class:"py-16 text-center text-gray-400 dark:text-white/40"},{default:s(()=>[...e[19]||(e[19]=[r("暂无数据",-1)])]),_:1})]),_:1}))]),_:1})]),_:1}),j.value>0?(m(),C("div",Pe,[a(l(be),{page:y.value,"onUpdate:page":e[0]||(e[0]=t=>y.value=t),total:j.value,"items-per-page":E.value,"sibling-count":1},{default:s(()=>[a(l(he),null,{default:s(({items:t})=>[a(l(Ce)),(m(!0),C(O,null,N(t,(f,_)=>(m(),C(O,{key:_},[f.type==="page"?(m(),z(l($e),{key:0,value:f.value,"is-active":f.value===y.value},{default:s(()=>[r(p(f.value),1)]),_:2},1032,["value","is-active"])):(m(),z(l(Me),{key:1,index:_},null,8,["index"]))],64))),128)),a(l(ze))]),_:1})]),_:1},8,["page","total","items-per-page"])])):V("",!0)]),_:1}),a(le,{isOpen:v.value,title:"删除",description:"确定要删除吗？此操作不可撤销。",isLoading:w.value,triggerRect:B.value,onClose:L,onConfirm:X},null,8,["isOpen","isLoading","triggerRect"]),a(Ie,{isOpen:T.value,url:$.value,onClose:K},null,8,["isOpen","url"])])]),_:1}))}};export{Ze as default};
