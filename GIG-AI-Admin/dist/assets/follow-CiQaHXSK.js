import{_ as Z,a as ee}from"./AdminLayout-B0_4BplP.js";import{_ as te}from"./Primitive-B-hdltSd.js";import{_ as V}from"./Button.vue_vue_type_script_setup_true_lang-BOYf09sq.js";import{_ as ae,a as se}from"./DeleteConfirmDialog-nyBrJccv.js";import{g as H,u as re,c as ne,a as oe,b as le,d as ie}from"./follow-Cxjrz1QX.js";import{r as u,w as J,o as K,m as ue,c as E,g as R,a as l,b as n,e as o,j as x,k as G,l as de,h as p,v as ce,f,F,i as z,n as Q,d as r,t as y,u as i}from"./index-xq2XRaRu.js";import{_ as fe,a as ge,b as q,c as L,d as pe,e as j,f as ve,g as _e,h as me,i as xe,j as ye,k as be}from"./PaginationPrevious.vue_vue_type_script_setup_true_lang-DYzsThT8.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./http-VbNDWnN5.js";const he={class:"relative z-10 w-full max-w-xl rounded-xl bg-white p-6 shadow-lg dark:bg-gray-900"},ke={class:"mb-4 text-lg font-semibold"},we={class:"relative ai-account-dropdown"},$e={key:0,class:"text-gray-400"},Ae={key:1,class:"flex flex-wrap gap-1"},Ce={class:"px-1"},Me=["onClick"],De={class:"absolute right-3 top-1/2 transform -translate-y-1/2 pointer-events-none"},je={key:0,class:"absolute z-50 w-full mt-1 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded-lg shadow-lg max-h-60 overflow-y-auto"},Ee={key:0,class:"px-4 py-2 text-sm text-gray-500 dark:text-gray-400"},Fe={key:1},Be=["onClick"],Oe={key:0,class:"text-blue-500"},Le={class:"flex justify-end gap-3 pt-2"},ze={__name:"form",props:{showModal:{type:Boolean,default:!1},isEditMode:{type:Boolean,default:!1},editData:{type:Object,default:()=>({})}},emits:["close","success"],setup(I,{emit:U}){const _=I,b=U,g=u({external_user_id:"",runner_accounts:[]}),m=u(!1),v=u([]),h=u(!1);J(()=>_.editData,a=>{a&&Object.keys(a).length>0&&(g.value={external_user_id:a.external_user_id||"",runner_accounts:a.runner_accounts||[]})},{immediate:!0,deep:!0});function B(){b("close"),P()}function P(){g.value={external_user_id:"",runner_accounts:[]}}async function X(){var a,s;if(!m.value){if(!g.value.external_user_id.trim()){y.error("请填写对方账号",{description:"对方账号不能为空"});return}if(g.value.runner_accounts.length===0){y.error("请选择AI账号",{description:"至少需要选择一个AI账号"});return}m.value=!0;try{const d={external_user_id:g.value.external_user_id.trim(),runner_accounts:g.value.runner_accounts};_.isEditMode?(await re(_.editData.id,d),y.success("更新成功",{description:"关注列表已成功更新"})):(await ne(d),y.success("创建成功",{description:"关注列表已成功创建"})),b("success"),B()}catch(d){console.error("Failed to save follow config:",d),y.error(_.isEditMode?"更新失败":"创建失败",{description:((s=(a=d.response)==null?void 0:a.data)==null?void 0:s.message)||d.message||(_.isEditMode?"更新关注列表时发生错误":"创建关注列表时发生错误")})}finally{m.value=!1}}}function N(){h.value=!h.value}function w(a){const s=g.value.runner_accounts.indexOf(a);s>-1?g.value.runner_accounts.splice(s,1):g.value.runner_accounts.push(a)}function $(a){const s=g.value.runner_accounts.indexOf(a);s>-1&&g.value.runner_accounts.splice(s,1)}function O(a){const s=v.value.find(d=>d.id===a);return s?s.bot:`账号${a}`}async function A(){try{v.value=[{id:"1",name:"AI账号1"},{id:"2",name:"AI账号2"},{id:"3",name:"AI账号3"}]}catch(a){console.error("Failed to fetch AI accounts:",a),v.value=[]}}function C(a){h.value&&!a.target.closest(".ai-account-dropdown")&&(h.value=!1)}const M=()=>{H({}).then(a=>{v.value=a})};return K(()=>{console.log(111),M(),A(),document.addEventListener("click",C)}),ue(()=>{document.removeEventListener("click",C)}),(a,s)=>I.showModal?(l(),E(ae,{key:0,fullScreenBackdrop:!0,onClose:B},{body:n(()=>[o("div",he,[o("h3",ke,x(I.isEditMode?"编辑关注列表":"新增关注列表"),1),o("form",{onSubmit:G(X,["prevent"]),class:"space-y-4"},[o("div",null,[s[1]||(s[1]=o("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[p("对方账号"),o("span",{class:"text-error-500"},"*")],-1)),de(o("input",{"onUpdate:modelValue":s[0]||(s[0]=d=>g.value.external_user_id=d),type:"text",placeholder:"请输入对方账号",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[ce,g.value.external_user_id]])]),o("div",null,[s[4]||(s[4]=o("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[p("AI账号选择"),o("span",{class:"text-error-500"},"*")],-1)),o("div",we,[o("div",{onClick:N,class:"dark:bg-dark-900 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs cursor-pointer focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800 min-h-[44px] flex items-center"},[g.value.runner_accounts.length===0?(l(),f("div",$e,"请选择AI账号")):(l(),f("div",Ae,[(l(!0),f(F,null,z(g.value.runner_accounts,d=>(l(),f("span",{key:d,class:"inline-flex items-center px-1.5 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200 whitespace-nowrap"},[o("span",Ce,x(O(d)),1),o("button",{type:"button",onClick:G(S=>$(d),["stop"]),class:"inline-flex items-center justify-center w-3 h-3 rounded-full text-blue-400 hover:bg-blue-200 hover:text-blue-500 dark:hover:bg-blue-800 dark:hover:text-blue-300"}," X ",8,Me)]))),128))])),o("div",De,[(l(),f("svg",{class:Q(["w-4 h-4 text-gray-400 transition-transform duration-200",{"rotate-180":h.value}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...s[2]||(s[2]=[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)])],2))])]),h.value?(l(),f("div",je,[v.value.length===0?(l(),f("div",Ee," 暂无AI账号选项 ")):(l(),f("div",Fe,[(l(!0),f(F,null,z(v.value,d=>(l(),f("div",{key:d.id,onClick:S=>w(d.id),class:"px-4 py-2 text-sm cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center justify-between"},[o("span",null,x(d.bot),1),g.value.runner_accounts.includes(d.id)?(l(),f("div",Oe,[...s[3]||(s[3]=[o("svg",{class:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20"},[o("path",{"fill-rule":"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z","clip-rule":"evenodd"})],-1)])])):R("",!0)],8,Be))),128))]))])):R("",!0)])]),o("div",Le,[r(V,{type:"button",variant:"outline",onClick:B},{default:n(()=>[...s[5]||(s[5]=[p("取消",-1)])]),_:1}),r(V,{type:"submit",disabled:m.value},{default:n(()=>[p(x(m.value?"保存中...":"保存"),1)]),_:1},8,["disabled"])])],32)])]),_:1})):R("",!0)}},Ie={class:"space-y-5 sm:space-y-6"},Ne={class:"mb-4 flex items-center justify-between"},Se={class:"flex gap-2"},Te={key:0,class:"flex flex-wrap gap-1"},Re={key:1,class:"text-gray-400"},Ve={class:"flex items-center justify-end gap-2"},Ue=["onClick"],Pe={key:0,class:"mt-4"},Ze={__name:"follow",setup(I){const U=u("关注列表"),_=u([]),b=u(1),g=u(20),m=u(0);u(""),u(null),u(!1);const v=u([]);function h(c){const e=v.value.find(t=>t.id===c);return e?e.bot:`账号${c}`}async function B(c){try{const e=await le(c.id);$.value=!0,O.value=c.id,A.value={id:c.id,external_user_id:e.external_user_id||"",runner_accounts:e.runner_accounts||[]},w.value=!0}catch(e){console.error("获取详情失败:",e),y.error("获取详情失败")}}function P(c,e){a.value=c;const t=e.target.getBoundingClientRect();s.value={top:t.top,left:t.left,width:t.width,height:t.height,bottom:t.bottom},C.value=!0}async function X(){var c,e;if(a.value){M.value=!0;try{await ie(a.value.id),y.success("删除成功"),await T(),N()}catch(t){console.error("删除失败:",t),y.error("删除失败",{description:((e=(c=t.response)==null?void 0:c.data)==null?void 0:e.message)||t.message||"删除关注列表时发生错误"})}finally{M.value=!1}}}function N(){C.value=!1,a.value=null,M.value=!1}const w=u(!1),$=u(!1),O=u(null),A=u({});u(!1);const C=u(!1),M=u(!1),a=u(null),s=u({top:0,left:0,width:0,height:0});function d(){$.value=!1,O.value=null,A.value={},w.value=!0}function S(){w.value=!1,$.value=!1,O.value=null,A.value={}}function W(){T(),S()}const T=async()=>{var c,e;try{let t=await oe({page:b.value});_.value=t.results,m.value=t.count}catch(t){console.error("获取列表失败:",t),y.error("获取列表失败",{description:((e=(c=t.response)==null?void 0:c.data)==null?void 0:e.message)||t.message||"获取关注列表时发生错误"})}},Y=async()=>{try{const c=await H({});v.value=c}catch(c){console.error("获取AI账号失败:",c),v.value=[]}};return J(b,c=>{console.log("Page changed to:",c),T()}),K(()=>{T(),Y()}),(c,e)=>(l(),E(Z,null,{default:n(()=>[r(ee,{pageTitle:U.value},null,8,["pageTitle"]),o("div",Ie,[r(te,null,{default:n(()=>[o("div",Ne,[e[2]||(e[2]=o("div",{class:"flex items-center gap-3"},null,-1)),o("div",Se,[r(V,{size:"sm",onClick:d},{default:n(()=>[...e[1]||(e[1]=[p("新增",-1)])]),_:1})])]),r(i(fe),{class:"[&_td]:py-3.5 [&_th]:py-3.5"},{default:n(()=>[r(i(ge),null,{default:n(()=>[r(i(q),null,{default:n(()=>[r(i(L),{class:"whitespace-nowrap"},{default:n(()=>[...e[3]||(e[3]=[p("序号",-1)])]),_:1}),r(i(L),{class:"whitespace-nowrap"},{default:n(()=>[...e[4]||(e[4]=[p("对方账号",-1)])]),_:1}),r(i(L),{class:"whitespace-nowrap"},{default:n(()=>[...e[5]||(e[5]=[p("AI账号选择",-1)])]),_:1}),r(i(L),{class:"whitespace-nowrap"},{default:n(()=>[...e[6]||(e[6]=[p("关注执行结果",-1)])]),_:1}),r(i(L),{class:"whitespace-nowrap text-right"},{default:n(()=>[...e[7]||(e[7]=[p("操作",-1)])]),_:1})]),_:1})]),_:1}),r(i(pe),null,{default:n(()=>[_.value.length?(l(!0),f(F,{key:0},z(_.value,(t,D)=>(l(),E(i(q),{key:t.id},{default:n(()=>[r(i(j),{class:"whitespace-nowrap"},{default:n(()=>[p(x(D+1),1)]),_:2},1024),r(i(j),{class:"whitespace-nowrap"},{default:n(()=>[p(x(t.external_user_id||"--"),1)]),_:2},1024),r(i(j),{class:"whitespace-nowrap"},{default:n(()=>[t.runner_accounts&&t.runner_accounts.length>0?(l(),f("div",Te,[(l(!0),f(F,null,z(t.runner_accounts,k=>(l(),f("span",{key:k,class:"inline-flex items-center px-1.5 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200 whitespace-nowrap"},x(h(k)),1))),128))])):(l(),f("span",Re,"--"))]),_:2},1024),r(i(j),{class:"whitespace-nowrap"},{default:n(()=>[o("span",{class:Q(["inline-flex items-center rounded-full px-2 py-0.5 text-xs font-medium ring-1 ring-inset",t.completed==!0?"bg-emerald-50 text-emerald-600 ring-emerald-200 dark:bg-emerald-500/10 dark:text-emerald-400 dark:ring-emerald-500/30":t.completed==!1?"bg-rose-50 text-rose-600 ring-rose-200 dark:bg-rose-500/10 dark:text-rose-400 dark:ring-rose-500/30":"bg-gray-50 text-gray-600 ring-gray-200 dark:bg-gray-500/10 dark:text-gray-400 dark:ring-gray-500/30"])},x(t.completed?"已完成":"未完成"),3)]),_:2},1024),r(i(j),{class:"text-right whitespace-nowrap"},{default:n(()=>[o("div",Ve,[r(V,{size:"sm",variant:"outline",onClick:k=>B(t)},{default:n(()=>[...e[8]||(e[8]=[p("编辑",-1)])]),_:1},8,["onClick"]),o("button",{class:"inline-flex items-center justify-center font-medium gap-2 rounded-lg transition px-4 py-3 text-sm bg-white text-gray-700 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 dark:bg-gray-800 dark:text-gray-400 dark:ring-gray-700 dark:hover:bg-white/[0.03] dark:hover:text-gray-300 text-rose-600 ring-rose-200 hover:bg-rose-50 dark:text-rose-400 dark:ring-rose-500/30",onClick:k=>P(t,k)}," 删除 ",8,Ue)])]),_:2},1024)]),_:2},1024))),128)):(l(),E(i(q),{key:1},{default:n(()=>[r(i(j),{colspan:5,class:"py-16 text-center text-gray-400 dark:text-white/40"},{default:n(()=>[...e[9]||(e[9]=[p("暂无数据",-1)])]),_:1})]),_:1}))]),_:1})]),_:1}),m.value>0?(l(),f("div",Pe,[r(i(ve),{page:b.value,"onUpdate:page":e[0]||(e[0]=t=>b.value=t),total:m.value,"items-per-page":g.value,"sibling-count":1},{default:n(()=>[r(i(_e),null,{default:n(({items:t})=>[r(i(me)),(l(!0),f(F,null,z(t,(D,k)=>(l(),f(F,{key:k},[D.type==="page"?(l(),E(i(xe),{key:0,value:D.value,"is-active":D.value===b.value},{default:n(()=>[p(x(D.value),1)]),_:2},1032,["value","is-active"])):(l(),E(i(ye),{key:1,index:k},null,8,["index"]))],64))),128)),r(i(be))]),_:1})]),_:1},8,["page","total","items-per-page"])])):R("",!0)]),_:1}),r(ze,{showModal:w.value,isEditMode:$.value,editData:A.value,onClose:S,onSuccess:W},null,8,["showModal","isEditMode","editData"]),r(se,{isOpen:C.value,title:"删除",description:"确定要删除吗？此操作不可撤销。",isLoading:M.value,triggerRect:s.value,onClose:N,onConfirm:X},null,8,["isOpen","isLoading","triggerRect"])])]),_:1}))}};export{Ze as default};
