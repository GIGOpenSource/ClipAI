import{r as c,f as ie,w as ge,j as Ae,c as b,o as g,a as t,C as A,D as F,K as qe,t as h,B as T,F as ne,v as ce,m as fe,u as Fe,z as Y,A as n,x as i,E as d,n as ye,J as Z,y as p,I as Ee,H as D}from"./index-CPBg-leY.js";import{a as Ne,_ as Ge}from"./AdminLayout-BWlSSXP9.js";import{_ as Qe,a as Ye,b as be,c as R,d as We,e as M,P as Xe,f as Je,g as He,h as Ze,i as et,j as tt,k as at,l as lt}from"./DeleteConfirmDialog-C3ez2aH_.js";import{a as ee,_ as ot,f as Se}from"./chevron-right-BH6xvSO4.js";import{_ as rt}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{e as Ve,f as xe,p as st,h as nt}from"./index-BSm4yeEa.js";import{g as dt}from"./prompts-DkOhQ8bq.js";import{g as ut}from"./pool-9c5yIoTf.js";const it="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAVCAYAAACpF6WWAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAHpSURBVHgBtVVRTvJAEJ7Z7Z/8f/Kr5QRyBDmBPBtB9AKiYOKbeAM9gfBmYip6AVOU+CregBtYT0CxJprY3XHaaq3QGqnxS5rt7sx8O518M0X4ArXdp2Kq4e+za7cLblYcZhkq2w91tnYzgpwHpUqDs3TiT6SV5rgFGvdCA4JJvGoNraSPQChzVB0InGBPiI7xx9+yjwvOu4/x/lKrj0xFeEQIgyATIuJgNIUQ5c95UJEfJoMh+7kCqKZe5BEb1qdIGWYYAuKsb/0/r+2MlnwlughqgjTMbtC35kOSSsMr8hVm0m5ABuyTwpCXEuSAgF9AaqZBfbWUd/RWklQQ7V+dLrS/TWqzVKoN74DoC1KhhjBLpgEurbkO5EQmabU55kzlYnyA2pWG6iT1OBNpUFNfwxrL6ePzucC+Dz1+cyAPqR21Xy45BcgtqZWdx6VgJfA7gOowaTMgB1abXhm1vlmpj0p9q2BP2n8kfonGQtr5TJkG45D7fhM06xfDSdZebXguku4lG2GmTDWrASEciG97DRhNLEr6xfOUZVRU3Jp80ibA3hQh+u51NGSimhLd8GH5qjt3O+kbfz7LyKluj4dM2OKLW5OOkmSchMEXqGifiqnfSWXLW05zlOSP+eK43zcaT4sX1r/7NN9XGQO8MiUQW74AAAAASUVORK5CYII=",ct={class:"robot-selector-container"},pt={class:"search-section"},gt={class:"search-input-group"},vt={class:"search-buttons"},mt=["disabled"],ft={class:"selection-section"},yt={class:"selection-box"},bt={class:"selection-header"},xt={class:"select-all-label"},kt=["checked","indeterminate"],_t={key:0,class:"loading-state"},wt={key:1,class:"empty-state"},ht={key:2,class:"robot-list"},St=["checked","onChange"],At={class:"robot-name"},Vt={key:0,class:"loading-more"},$t={key:1,class:"no-more-data"},Ct={__name:"RobotSelector",props:{fetchApi:{type:Function,required:!0},modelValue:{type:Array,default:()=>[]},labelKey:{type:String,default:"name"},valueKey:{type:String,default:"id"}},emits:["update:modelValue","selectionChange"],setup(V,{emit:E}){const u=V,$=E,S=c(""),C=c([]),te=c(!1),z=c(!1),I=c(!1),L=c(1),O=c(!0),W=c(0),ae=c(20),w=c(!1),de=c([]),X=c(0),j=ie(()=>{if(!S.value.trim())return C.value;const r=S.value.toLowerCase();return C.value.filter(v=>N(v).toLowerCase().includes(r))}),J=ie(()=>u.modelValue.map(r=>String(typeof r=="object"?r[u.valueKey]:r)));ge([C,w],()=>{w.value&&u.modelValue.length===0?console.log("全选状态：robots 变化，所有机器人应该显示为选中"):w.value&&u.modelValue.length>0&&console.log("反选状态：robots 变化，根据 modelValue 决定选中状态")},{deep:!0});const le=ie(()=>w.value?u.modelValue.length===0:j.value.length>0&&j.value.every(r=>H(r))),P=ie(()=>{if(w.value)return u.modelValue.length>0;const r=j.value.filter(v=>H(v)).length;return r>0&&r<j.value.length}),q=ie(()=>w.value?u.modelValue.length===0?{selected:!0,selected_accounts:[]}:{selectStatus:!1,selected_accounts:u.modelValue.map(r=>({id:String(typeof r=="object"?r[u.valueKey]:r),name:typeof r=="object"&&(r[u.labelKey]||r[u.valueKey])||String(r)}))}:u.modelValue.length>0?{selected:!0,selected_accounts:u.modelValue.map(r=>({id:String(typeof r=="object"?r[u.valueKey]:r),name:typeof r=="object"&&(r[u.labelKey]||r[u.valueKey])||String(r)}))}:{selected:!1,selected_accounts:[]}),N=r=>{const v=r[u.labelKey]||r[u.valueKey]||String(r);return(r.remark?`(${r.remark})`:"")+v},H=r=>{if(w.value){if(u.modelValue.length===0)return console.log(`全选状态：机器人 ${r[u.valueKey]} 应该显示为选中`),!0;const x=String(r[u.valueKey]),_=u.modelValue.some(B=>String(typeof B=="object"?B[u.valueKey]:B)===x),U=!_;return console.log(`反选模式：机器人 ${x} 是否在未选中列表中: ${_}, 应该显示为选中: ${U}`),U}const v=String(r[u.valueKey]),f=J.value.includes(v);return console.log(`普通模式：机器人 ${v} 是否选中: ${f}`),console.log("当前 modelValue:",u.modelValue),console.log("selectedRobotIds:",J.value),f},oe=r=>{const v=String(r[u.valueKey]),f=H(r);if(console.log("=== toggleRobot 被调用 ==="),console.log("机器人:",r),console.log("机器人ID:",v),console.log("当前是否选中:",f),console.log("是否全局全选:",w.value),console.log("当前modelValue:",u.modelValue),w.value){if(u.modelValue.length===0){const _={id:String(v),name:r[u.labelKey]||String(v)};$("update:modelValue",[_]),console.log("从全局全选中移除项目，进入反选模式，反选列表:",[_])}else{let _=[...u.modelValue];if(f){const U={id:String(v),name:r[u.labelKey]||String(v)};_.push(U),console.log("添加到反选列表:",U),$("update:modelValue",_)}else _=_.filter(U=>String(typeof U=="object"?U[u.valueKey]:U)!==v),console.log("从反选列表中移除项目"),_.length===0?($("update:modelValue",[]),console.log("反选列表为空，回到真正的全选状态")):$("update:modelValue",_)}fe(()=>{$("selectionChange",q.value)});return}let x=[...u.modelValue];f?x=x.filter(_=>String(typeof _=="object"?_[u.valueKey]:_)!==v):(x.push(r),console.log("添加机器人到选择列表:",r),console.log("新的选择列表:",x)),console.log("准备发送 update:modelValue 事件:",x),$("update:modelValue",x),fe(()=>{console.log("触发 selectionChange 事件:",q.value),$("selectionChange",q.value)})},re=()=>{if(!le.value)w.value=!0,$("update:modelValue",[]),console.log("=== 启用全局全选模式 ==="),console.log("全选模式：selected: true, selected_accounts: []");else if(w.value)if(u.modelValue.length>0)$("update:modelValue",[]),console.log("从反选状态回到真正的全选状态");else{w.value=!1;const v=j.value.map(x=>String(x[u.valueKey])),f=u.modelValue.filter(x=>{const _=String(typeof x=="object"?x[u.valueKey]:x);return!v.includes(_)});$("update:modelValue",f),console.log("取消全局全选模式")}else{w.value=!1;const v=j.value.map(x=>String(x[u.valueKey])),f=u.modelValue.filter(x=>{const _=String(typeof x=="object"?x[u.valueKey]:x);return!v.includes(_)});$("update:modelValue",f)}fe(()=>{$("selectionChange",q.value)})},ue=async()=>{z.value=!0;try{w.value=!1,await l(!0)}finally{z.value=!1}},G=()=>{S.value="",w.value=!1,l(!0)},se=r=>{const{scrollTop:v,scrollHeight:f,clientHeight:x}=r.target;v+x>=f-10&&O.value&&!I.value&&K()},l=async(r=!1)=>{r&&(L.value=1,C.value=[],O.value=!0),te.value=!0;try{const v={page:L.value,page_size:ae.value};S.value.trim()&&(v.remark=S.value.trim());const f=await u.fetchApi(v),x=f.results||f.data||[];if(W.value=f.count||f.total||0,r&&L.value===1&&!S.value.trim()&&(de.value=f.results||f.data||[],X.value=f.count||f.total||0),r)C.value=x;else{const _=new Set(C.value.map(B=>B[u.valueKey])),U=x.filter(B=>!_.has(B[u.valueKey]));C.value=[...C.value,...U],U.length>0&&(de.value=[...de.value,...U],X.value=f.count||f.total||0)}w.value&&u.modelValue.length===0?console.log("全选状态下加载数据，当前页机器人应该都显示为选中"):w.value&&u.modelValue.length>0&&console.log("反选状态下加载数据，根据 modelValue 决定选中状态"),O.value=C.value.length<W.value}catch(v){console.error("获取机器人列表失败:",v),r&&(C.value=[])}finally{te.value=!1}},K=async()=>{if(!(I.value||!O.value)){I.value=!0,L.value+=1;try{await l(!1)}finally{I.value=!1}}};return ge(S,r=>{r.trim()===""&&(w.value=!1,l(!0))}),Ae(()=>{l(!0)}),(r,v)=>(g(),b("div",ct,[t("div",pt,[t("div",gt,[A(t("input",{"onUpdate:modelValue":v[0]||(v[0]=f=>S.value=f),type:"text",placeholder:"搜索机器人",class:"search-input",onKeyup:qe(ue,["enter"])},null,544),[[F,S.value]]),t("div",vt,[t("button",{type:"button",onClick:ue,disabled:z.value,class:"search-btn"},h(z.value?"搜索中...":"搜索"),9,mt),t("button",{type:"button",onClick:G,class:"reset-btn"}," 重置 ")])])]),t("div",ft,[t("div",yt,[t("div",bt,[t("label",xt,[t("input",{type:"checkbox",checked:le.value,indeterminate:P.value,onChange:re,class:"select-all-checkbox"},null,40,kt),v[1]||(v[1]=t("span",{class:"select-all-text"},"全选",-1))])]),t("div",{class:"selection-list",ref:"selectionList",onScroll:se},[te.value&&C.value.length===0?(g(),b("div",_t,[...v[2]||(v[2]=[t("div",{class:"loading-spinner"},null,-1),t("span",null,"加载中...",-1)])])):C.value.length===0?(g(),b("div",wt,h(S.value?"无搜索结果":"暂无机器人"),1)):(g(),b("div",ht,[(g(!0),b(ne,null,ce(j.value,f=>(g(),b("label",{key:f.id,class:"robot-item"},[t("input",{type:"checkbox",checked:H(f),onChange:x=>oe(f),class:"robot-checkbox"},null,40,St),t("span",At,h(N(f)),1)]))),128)),I.value?(g(),b("div",Vt,[...v[3]||(v[3]=[t("div",{class:"loading-spinner-small"},null,-1),t("span",null,"加载更多...",-1)])])):!O.value&&C.value.length>0?(g(),b("div",$t," 没有更多数据了 ")):T("",!0)]))],544)])])]))}},It=rt(Ct,[["__scopeId","data-v-c4703836"]]),jt=V=>Ve("/tasks/simple/",{params:V}),Kt=V=>Ve(`/tasks/simple/${V}/`),Ut=V=>xe("/tasks/simple/",V),Dt=(V,E)=>st(`/tasks/simple/${V}/`,E),Bt=V=>nt(`/tasks/simple/${V}/`),Mt=(V,E)=>xe(`/tasks/simple/${V}/run/`,E),Tt=(V,E)=>xe(`/tasks/simple/${V}/schedule/`,E),zt={class:"space-y-5 sm:space-y-6"},Rt={class:"flex justify-between items-center mb-4"},Lt={class:"relative"},Pt={key:0,class:"absolute right-0 mt-2 w-48 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 z-50"},Ot={class:"py-1"},qt={class:"mb-4 flex items-center gap-1 border-b border-gray-200"},Ft={key:0,class:"absolute bottom-0 left-1/2 transform -translate-x-1/2 w-12 h-0.5 bg-blue-600"},Et={key:0,class:"absolute bottom-0 left-1/2 transform -translate-x-1/2 w-12 h-0.5 bg-blue-600"},Nt={class:"mb-4 flex items-center justify-between"},Gt={class:"flex items-center gap-3"},Qt={key:0,class:"mr-2"},Yt={key:1,class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Wt=["title"],Xt={class:"flex items-center justify-end gap-2"},Jt=["onClick"],Ht={key:0,class:"mt-4"},Zt={class:"relative z-10 w-full max-w-2xl rounded-xl bg-white p-6 shadow-lg dark:bg-gray-900"},ea={class:"mb-4 text-lg font-semibold"},ta={class:"grid grid-cols-3 gap-4"},aa={class:"relative prompt-dropdown"},la={class:"absolute right-3 top-1/2 transform -translate-y-1/2 pointer-events-none"},oa={key:0,class:"absolute z-50 w-full mt-1 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded-lg shadow-lg max-h-60 overflow-y-auto"},ra=["onMousedown"],sa={class:"font-medium text-gray-900 dark:text-gray-100"},na={key:0},da={key:1},ua={key:2},ia={key:3},ca={class:"grid grid-cols-2 gap-4"},pa=["disabled"],ga=["value"],va={class:"relative"},ma={class:"absolute bottom-2 right-2 text-xs text-gray-400"},fa={class:"flex justify-end gap-3 pt-2"},ya={key:0,class:"mr-2"},ba={key:1,class:"fixed inset-0 bg-transparent flex items-center justify-center z-50"},$a={__name:"new",setup(V){const E={execting:"执行中",paused:"已暂停",waiting:"等待中",completed:"已完成",part_success:" 部分成功",part_failure:"部分失败"},u=c("任务列表"),$=c([]),S=c(1),C=c(20),te=c(0),z=c("task_timing_type"),I=c("once"),L=c(!1),O=c(""),W=c(""),ae=c(""),w=c(!1),de={zh:"中文",en:"英文",ja:"日文",ko:"韩文",es:"西班牙文",fr:"法文",de:"德文"},X=c([]);c([]);const j=c(!1),J=c([]),le=c(!1),P=c(!1),q=c(null),N=c(!1),H=c(!1),oe=c(!1),re=c(null),ue=c({top:0,left:0,width:0,height:0}),G=c(!1),se=c(null),l=c({type:"",provider:"",language:"",text:"",last_text:"",mentions:"",tags:"",payload:"",selected_accounts:[],prompt:"",prompt_id:"",prompt_display:"",task_timing_type:"",exec_type:"",exec_datetime:"",exec_nums:"",twitter_reply_to_tweet_id:"",facebook_page_id:"",facebook_comment_id:"",task_orig_id:"",task_remark:"",frequency_value:""});c("once");const K=c({selected:!1,selectStatus:!1,selected_accounts:[]}),r=c(0),v=s=>{console.log("机器人选择状态变化:",s),K.value={...s}},f=()=>{console.log("平台变化:",l.value.provider),l.value.selected_accounts=[],K.value={selected:!1,selectStatus:!1,selected_accounts:[]},r.value=Date.now()},x=()=>{const s=l.value.prompt_display.toLowerCase();l.value.prompt_id="",l.value.prompt=l.value.prompt_display,s?J.value=X.value.filter(e=>e.name.toLowerCase().includes(s)||e.content&&e.content.toLowerCase().includes(s)):J.value=X.value,j.value=!0},_=()=>{setTimeout(()=>{j.value=!1},200)},U=s=>{l.value.prompt_display=s.name,l.value.prompt=s.id,l.value.prompt_id=s.id,j.value=!1},B=c([]),ve=()=>{switch(l.value.exec_datetime="",l.value.exec_nums="",l.value.exec_type){case"fixed":B.value=[];break;case"daily":case"weekly":case"monthly":B.value=Array.from({length:5},(s,e)=>({value:`${e+1}`,label:`${e+1}次`}));break;default:B.value=[]}},$e=s=>{if(!s)return"";const e=new Date(s),a=e.getFullYear(),o=String(e.getMonth()+1).padStart(2,"0"),m=String(e.getDate()).padStart(2,"0"),y=String(e.getHours()).padStart(2,"0"),k=String(e.getMinutes()).padStart(2,"0"),Oe=String(e.getSeconds()).padStart(2,"0");return`${a}-${o}-${m} ${y}:${k}:${Oe}`},Ce=s=>{if(!s)return"";const e=new Date(s),a=e.getFullYear(),o=String(e.getMonth()+1).padStart(2,"0"),m=String(e.getDate()).padStart(2,"0"),y=String(e.getHours()).padStart(2,"0"),k=String(e.getMinutes()).padStart(2,"0");return`${a}-${o}-${m}T${y}:${k}`};async function Ie(s){var e,a;if(!G.value){G.value=!0,se.value=s.id;try{const o=await Mt(String(s.id),{});D.success("任务执行成功",{description:`任务已开始执行，成功${o.summary.ok}条，失败${o.summary.error}条`}),Q()}catch(o){console.error("Failed to run task:",o),D.error("执行失败",{description:((a=(e=o.response)==null?void 0:e.data)==null?void 0:a.message)||o.message||"执行任务时发生错误"})}finally{G.value=!1,se.value=null}}}async function je(s){if(!G.value){G.value=!0,se.value=s.id;try{const e=await Tt(String(s.id),{method:s.exec_status=="execting"?"pause":"resume"});console.log(e,"resres"),Q()}catch(e){console.error("Failed to run task:",e)}finally{G.value=!1,se.value=null}}}async function Ke(s){var e;try{const a=await Kt(s.id);P.value=!0,q.value=s.id;let o="";Array.isArray(a.tags)?o=a.tags.join(","):o=a.tags||"";let m=[];if(console.log("=== 编辑时处理 selected_accounts ==="),console.log("原始 selected_accounts 数据:",a.selected_accounts),console.log("数据类型:",typeof a.selected_accounts),console.log("是否为数组:",Array.isArray(a.selected_accounts)),Array.isArray(a.selected_accounts)?m=a.selected_accounts.map(y=>{const k={id:String(y.id||y),name:y.name||y.remark||String(y.id||y)};return console.log("处理数组中的账户:",y,"->",k),k}):typeof a.selected_accounts=="object"&&a.selected_accounts!==null?m=Object.keys(a.selected_accounts).map(y=>{const k={id:String(y),name:a.selected_accounts[y]||String(y)};return console.log("处理对象中的账户:",y,"->",k),k}):typeof a.selected_accounts=="string"&&(m=a.selected_accounts.split(",").map(y=>{const k={id:String(y.trim()),name:String(y.trim())};return console.log("处理字符串中的账户:",y,"->",k),k})),console.log("处理后的 selectedAccountsValue:",m),l.value={type:a.type||"",provider:a.provider||"",language:a.language||"",text:a.text||"",last_text:a.last_text||"",mentions:a.mentions||"",tags:o,payload:a.payload||"",selected_accounts:m,exec_prom_text:!!a.prompt_id,prompt:a.prompt_id?a.prompt_id:null,prompt_text:a.prompt_id?null:a.prompt||"",prompt_display:a.prompt_id?((e=X.value.find(y=>y.id===a.prompt_id))==null?void 0:e.name)||a.prompt||"":a.prompt||"",task_timing_type:a.task_timing_type||z.value,exec_type:a.exec_type||"",exec_datetime:Ce(a.exec_datetime)||"",exec_nums:a.exec_nums||"",twitter_reply_to_tweet_id:a.twitter_reply_to_tweet_id||"",facebook_page_id:a.facebook_page_id||"",facebook_comment_id:a.facebook_comment_id||"",task_remark:a.task_remark||"",frequency_value:a.frequency_value||""},z.value=a.task_timing_type,K.value={selected:!1,selectStatus:!1,selected_accounts:[]},console.log("=== 编辑模式表单数据填充完成 ==="),console.log("form.value.selected_accounts:",l.value.selected_accounts),console.log("selectionStatus.value:",K.value),console.log("原始 exec_datetime:",a.exec_datetime),console.log("转换后 exec_datetime:",l.value.exec_datetime),console.log("form.value.exec_type:",l.value.exec_type),a.exec_type){l.value.exec_type=a.exec_type;const y=l.value.exec_datetime,k=l.value.exec_nums;ve(),l.value.exec_datetime=y,l.value.exec_nums=k||a.exec_nums||""}le.value=!0}catch(a){console.error("获取详情失败:",a),D.error("获取详情失败")}}function Ue(s,e){re.value=s;const a=e.target.getBoundingClientRect();ue.value={top:a.top,left:a.left,width:a.width,height:a.height,bottom:a.bottom},H.value=!0}async function De(){var s,e;if(re.value){oe.value=!0;try{await Bt(re.value.id),D.success("删除成功"),await Q(),ke()}catch(a){console.error("删除失败:",a),D.error("删除失败",{description:((e=(s=a.response)==null?void 0:s.data)==null?void 0:e.message)||a.message||"删除任务时发生错误"})}finally{oe.value=!1}}}function ke(){H.value=!1,re.value=null,oe.value=!1}function _e(){P.value=!1,q.value=null,l.value={type:"",provider:"",language:"",text:"",mentions:"",tags:"",payload:"",selected_accounts:[],prompt:"",prompt_id:"",prompt_display:"",task_timing_type:z.value,exec_type:"",exec_datetime:"",exec_nums:"",twitter_reply_to_tweet_id:"",facebook_page_id:"",facebook_comment_id:"",task_remark:"",frequency_value:""},B.value=[],le.value=!0}function me(){le.value=!1,P.value=!1,q.value=null,l.value={type:"",provider:"",language:"",text:"",mentions:"",tags:"",payload:"",selected_accounts:[],prompt:"",prompt_id:"",prompt_display:"",task_timing_type:"",exec_type:"",exec_datetime:"",exec_nums:"",twitter_reply_to_tweet_id:"",facebook_page_id:"",facebook_comment_id:"",task_remark:"",frequency_value:""},B.value=[]}async function Be(){var e,a;if(N.value)return;if(!l.value.type||l.value.type.trim()===""){D.error("请选择类型",{description:"类型不能为空"});return}if(!l.value.provider||l.value.provider.trim()===""){D.error("请选择平台",{description:"平台不能为空"});return}if(!l.value.language||l.value.language.trim()===""){D.error("请选择语言",{description:"语言不能为空"});return}if(!(K.value.selected===!0||K.value.selectStatus===!1&&K.value.selected_accounts.length>0||l.value.selected_accounts.length>0)){D.error("请选择机器人",{description:"机器人不能为空"});return}if(z.value==="timing"){if(!l.value.exec_type||l.value.exec_type.trim()===""){D.error("请选择执行频率类型",{description:"执行频率类型不能为空"});return}if(l.value.exec_type==="fixed"){if(!l.value.exec_datetime||l.value.exec_datetime.trim()===""){D.error("请选择指定日期",{description:"指定日期不能为空"});return}}else if(!l.value.exec_nums||l.value.exec_nums.trim()===""){D.error("请选择执行次数",{description:"执行次数不能为空"});return}}N.value=!0;try{let o=[];l.value.tags&&l.value.tags.trim()!==""&&(o=l.value.tags.split(",").map(k=>k.trim()).filter(k=>k!==""));let m={};K.value.selected===!0&&K.value.selected_accounts.length===0?m={select_status:!0,selected_accounts:[]}:K.value.selected===!0&&K.value.selected_accounts.length>0?m={select_status:!0,selected_accounts:K.value.selected_accounts.map(k=>({id:String(k.id),name:k.name||String(k.id)}))}:K.value.selectStatus===!1?m={select_status:!1,selected_accounts:K.value.selected_accounts.map(k=>({id:String(k.id),name:k.name||String(k.id)}))}:m={select_status:!0,selected_accounts:[]};const y={type:l.value.type,provider:l.value.provider,language:l.value.language,text:l.value.text.trim(),last_text:l.value.last_text,mentions:l.value.mentions||"",tags:o,payload:"",...m,exec_prom_text:!!l.value.prompt_id,prompt:l.value.prompt_id?l.value.prompt_id:null,prompt_text:l.value.prompt_id?null:l.value.prompt||"",twitter_reply_to_tweet_id:"",facebook_page_id:"",facebook_comment_id:"",task_remark:l.value.task_remark.trim()||"",...z.value==="timing"?{exec_type:l.value.exec_type,...l.value.exec_type==="fixed"?{exec_datetime:$e(l.value.exec_datetime)}:{exec_nums:l.value.exec_nums}}:{},task_timing_type:z.value};console.log("=== 提交给 createAutoPlay 的数据 ===",y),P.value?(await Dt(q.value,y),D.success("任务更新成功")):(await Ut(y),D.success("任务新增成功")),me(),await Q()}catch(o){console.error(P.value?"更新失败:":"新增失败:",o),D.error(P.value?"更新失败":"新增失败",{description:((a=(e=o.response)==null?void 0:e.data)==null?void 0:a.message)||o.message||(P.value?"更新任务时发生错误":"新增任务时发生错误")})}finally{N.value=!1}}const Me=async s=>{console.log(111);try{const e={page:s.page,provider:l.value.provider||""};s.search&&(e.remark=s.search);const a=await ut(e);console.log("=== API返回原始数据 ===",a);let o=a.results||a.data||[];return console.log("=== 过滤前的数据 ===",o),s.exclude_ids&&s.exclude_ids.length>0&&(console.log("=== 排除ID列表 ===",s.exclude_ids),o=o.filter(m=>{const y=s.exclude_ids.includes(String(m.id));return console.log(`项目 ${m.id} (${m.name}) 是否排除: ${y}`),!y})),s.include_ids&&s.include_ids.length>0&&(console.log("=== 包含ID列表 ===",s.include_ids),o=o.filter(m=>{const y=s.include_ids.includes(String(m.id));return console.log(`项目 ${m.id} (${m.name}) 是否包含: ${y}`),y})),console.log("=== 过滤后的数据 ===",o),{results:o,count:a.count||a.total||0,total:a.count||a.total||0}}catch(e){return console.error("获取机器人列表失败:",e),{results:[],count:0,total:0}}},Te=async()=>{try{const s=await dt({page:1});X.value=s.results||s.data||[],J.value=X.value}catch(s){console.error("获取提示词列表失败:",s)}},ze=()=>{L.value=!L.value},Re=s=>{L.value=!1,z.value=s,_e()},Le=()=>{L.value=!1,z.value="timing",_e()},pe=async()=>{w.value=!0,S.value=1;try{await Q()}finally{w.value=!1}},Pe=()=>{O.value="",W.value="",ae.value="",S.value=1,Q()},Q=async()=>{var s,e;try{const a={page:S.value,page_size:C.value,task_timing_type:I.value,enterprise_id:localStorage.getItem("selectedUserId")||""};O.value&&(a.type=O.value),W.value&&(a.provider=W.value),ae.value&&(a.status=ae.value);let o=await jt(a);$.value=o.results||o.data||[],te.value=o.count||o.total||0}catch(a){console.error("获取列表失败:",a),D.error("获取列表失败",{description:((e=(s=a.response)==null?void 0:s.data)==null?void 0:e.message)||a.message||"获取任务列表时发生错误"})}};ge([S,I],()=>{Q()});const we=c(localStorage.getItem("selectedUserId")||"");ge(we,()=>{Q()}),window.addEventListener("enterprise-data-changed",()=>{we.value=localStorage.getItem("selectedUserId")||""});const he=s=>{L.value&&!s.target.closest(".relative")&&(L.value=!1),j.value&&!s.target.closest(".prompt-dropdown")&&(j.value=!1)};return Ae(()=>{Q(),Te(),document.addEventListener("click",he)}),Fe(()=>{document.removeEventListener("click",he)}),(s,e)=>(g(),Y(Ge,null,{default:n(()=>[i(Ne,{pageTitle:u.value},null,8,["pageTitle"]),t("div",zt,[i(et,null,{default:n(()=>[t("div",Rt,[e[27]||(e[27]=t("div",null,null,-1)),t("div",Lt,[i(ee,{size:"sm",class:"!text-blue-600 flex items-center gap-2 border border-blue-600 bg-white hover:bg-gray-50 dark:bg-gray-800 dark:border-blue-400 dark:text-blue-400 dark:hover:bg-gray-700",onClick:ze},{default:n(()=>[...e[24]||(e[24]=[t("img",{src:it,alt:""},null,-1),d(" 新建任务 ",-1),t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"})],-1)])]),_:1}),L.value?(g(),b("div",Pt,[t("div",Ot,[t("button",{onClick:e[0]||(e[0]=a=>Re("once")),class:"w-full px-4 py-2 text-left text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center gap-2"},[...e[25]||(e[25]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})],-1),d(" 创建即时任务 ",-1)])]),t("button",{onClick:e[1]||(e[1]=a=>Le("timing")),class:"w-full px-4 py-2 text-left text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center gap-2"},[...e[26]||(e[26]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("circle",{cx:"12",cy:"12",r:"9","stroke-width":"2"}),t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6v6l4 2"}),t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 2v2M16 2v2"})],-1),d(" 创建定时任务 ",-1)])])])])):T("",!0)])]),t("div",qt,[t("button",{class:ye(["px-4 py-2 text-sm font-medium transition-colors relative",I.value==="once"?"text-blue-600":"text-gray-500 hover:text-gray-700"]),onClick:e[2]||(e[2]=a=>I.value="once")},[I.value==="once"?(g(),b("div",Ft)):T("",!0),e[28]||(e[28]=t("svg",{class:"w-4 h-4 inline mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e[29]||(e[29]=d(" 即时任务列表 ",-1))],2),t("button",{class:ye(["px-4 py-2 text-sm font-medium transition-colors relative",I.value==="timing"?"text-blue-600":"text-gray-500 hover:text-gray-700"]),onClick:e[3]||(e[3]=a=>I.value="timing")},[I.value==="timing"?(g(),b("div",Et)):T("",!0),e[30]||(e[30]=t("svg",{class:"w-4 h-4 inline mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("circle",{cx:"12",cy:"12",r:"9","stroke-width":"2"}),t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6v6l4 2"}),t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 2v2M16 2v2"})],-1)),e[31]||(e[31]=d(" 定时任务列表 ",-1))],2)]),t("div",Nt,[t("div",Gt,[A(t("select",{"onUpdate:modelValue":e[4]||(e[4]=a=>O.value=a),onChange:pe,class:"w-48 h-10 px-4 rounded-lg border border-gray-300 bg-transparent text-sm text-gray-800 shadow-theme-xs focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:focus:border-brand-800"},[...e[32]||(e[32]=[t("option",{value:""},"请选择类型",-1),t("option",{value:"post"},"发帖",-1),t("option",{value:"reply_comment"},"回复评论",-1)])],544),[[Z,O.value]]),A(t("select",{"onUpdate:modelValue":e[5]||(e[5]=a=>W.value=a),onChange:pe,class:"w-48 h-10 px-4 rounded-lg border border-gray-300 bg-transparent text-sm text-gray-800 shadow-theme-xs focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:focus:border-brand-800"},[...e[33]||(e[33]=[t("option",{value:""},"请选择平台",-1),t("option",{value:"twitter"},"Twitter",-1),t("option",{value:"facebook"},"Facebook",-1)])],544),[[Z,W.value]]),A(t("select",{"onUpdate:modelValue":e[6]||(e[6]=a=>ae.value=a),onChange:pe,class:"w-48 h-10 px-4 rounded-lg border border-gray-300 bg-transparent text-sm text-gray-800 shadow-theme-xs focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:focus:border-brand-800"},[...e[34]||(e[34]=[t("option",{value:""},"请选择状态",-1),t("option",{value:"execting"},"执行中",-1),t("option",{value:"paused"},"已暂停",-1),t("option",{value:"completed"},"已完成",-1),t("option",{value:"part_success"},"部分成功",-1),t("option",{value:"part_failure"},"部分失败",-1)])],544),[[Z,ae.value]]),i(ee,{size:"sm",onClick:pe,disabled:w.value},{default:n(()=>[w.value?(g(),b("span",Qt,"搜索中...")):(g(),b("svg",Yt,[...e[35]||(e[35]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"},null,-1)])])),e[36]||(e[36]=d(" 搜索 ",-1))]),_:1},8,["disabled"]),i(ee,{size:"sm",variant:"outline",onClick:Pe},{default:n(()=>[...e[37]||(e[37]=[d(" 重置 ",-1)])]),_:1})])]),i(p(Qe),{class:"[&_td]:py-3.5 [&_th]:py-3.5"},{default:n(()=>[i(p(Ye),null,{default:n(()=>[i(p(be),null,{default:n(()=>[i(p(R),{class:"whitespace-nowrap w-[60px]"},{default:n(()=>[...e[38]||(e[38]=[d("序号",-1)])]),_:1}),i(p(R),{class:"whitespace-nowrap w-[80px]"},{default:n(()=>[...e[39]||(e[39]=[d("类型",-1)])]),_:1}),i(p(R),{class:"whitespace-nowrap w-[80px]"},{default:n(()=>[...e[40]||(e[40]=[d("平台",-1)])]),_:1}),i(p(R),{class:"whitespace-nowrap w-[80px]"},{default:n(()=>[...e[41]||(e[41]=[d("语言",-1)])]),_:1}),i(p(R),{class:"whitespace-nowrap w-[100px]"},{default:n(()=>[...e[42]||(e[42]=[d("提及",-1)])]),_:1}),i(p(R),{class:"whitespace-nowrap w-[100px]"},{default:n(()=>[...e[43]||(e[43]=[d("话题",-1)])]),_:1}),i(p(R),{class:"whitespace-nowrap w-[120px]"},{default:n(()=>[...e[44]||(e[44]=[d("机器人",-1)])]),_:1}),i(p(R),{class:"whitespace-nowrap w-[100px]"},{default:n(()=>[...e[45]||(e[45]=[d("推文信息",-1)])]),_:1}),i(p(R),{class:"whitespace-nowrap w-[120px]"},{default:n(()=>[...e[46]||(e[46]=[d("推文后缀",-1)])]),_:1}),i(p(R),{class:"whitespace-nowrap w-[100px]"},{default:n(()=>[...e[47]||(e[47]=[d("备注",-1)])]),_:1}),i(p(R),{class:"whitespace-nowrap w-[120px]"},{default:n(()=>[...e[48]||(e[48]=[d("创建时间",-1)])]),_:1}),i(p(R),{class:"whitespace-nowrap w-[120px]"},{default:n(()=>[...e[49]||(e[49]=[d("发布时间",-1)])]),_:1}),i(p(R),{class:"whitespace-nowrap w-[80px]"},{default:n(()=>[...e[50]||(e[50]=[d("状态",-1)])]),_:1}),i(p(R),{class:"whitespace-nowrap text-right sticky right-0 bg-background z-10 w-[160px]"},{default:n(()=>[...e[51]||(e[51]=[d("操作",-1)])]),_:1})]),_:1})]),_:1}),i(p(We),null,{default:n(()=>[$.value.length?(g(!0),b(ne,{key:0},ce($.value,(a,o)=>(g(),Y(p(be),{key:a.id},{default:n(()=>[i(p(M),{class:"whitespace-nowrap w-[60px]"},{default:n(()=>[d(h(o+1),1)]),_:2},1024),i(p(M),{class:"whitespace-nowrap w-[80px]"},{default:n(()=>[d(h(a.type=="post"?"发帖":"回复评论"),1)]),_:2},1024),i(p(M),{class:"whitespace-nowrap w-[80px]"},{default:n(()=>[d(h(a.provider||"-"),1)]),_:2},1024),i(p(M),{class:"whitespace-nowrap w-[80px]"},{default:n(()=>[d(h(de[a.language]||"-"),1)]),_:2},1024),i(p(M),{class:"w-[100px] max-w-[80px] truncate",title:a.mentions},{default:n(()=>[d(h(a.mentions||"-"),1)]),_:2},1032,["title"]),i(p(M),{class:"w-[100px] max-w-[80px] truncate",title:a.tags},{default:n(()=>[d(h(a.tags.map(m=>m).join(",")||"-"),1)]),_:2},1032,["title"]),i(p(M),{class:"w-[120px] max-w-[100px] truncate",title:a.selected_accounts.map(m=>m.name).join(",")},{default:n(()=>[d(h(a.selected_accounts.map(m=>m.name).join(",")||"-"),1)]),_:2},1032,["title"]),i(p(M),{class:"w-[100px] max-w-[80px] truncate",title:a.prompt},{default:n(()=>[d(h(a.prompt_name||"-"),1)]),_:2},1032,["title"]),i(p(M),{class:"w-[120px] max-w-[100px] truncate",title:a.last_text},{default:n(()=>[d(h(a.last_text||"-"),1)]),_:2},1032,["title"]),i(p(M),{class:"whitespace-nowrap w-[100px]"},{default:n(()=>[t("div",{class:"max-w-[80px] truncate",title:a.task_remark},h(a.task_remark||"无"),9,Wt)]),_:2},1024),i(p(M),{class:"whitespace-nowrap w-[120px]"},{default:n(()=>[d(h(p(Se)(a.created_at)),1)]),_:2},1024),i(p(M),{class:"whitespace-nowrap w-[120px]"},{default:n(()=>[d(h(p(Se)(a.created_at)),1)]),_:2},1024),i(p(M),{class:"whitespace-nowrap w-[80px]"},{default:n(()=>[d(h(E[a.exec_status]||"--"),1)]),_:2},1024),i(p(M),{class:"text-right whitespace-nowrap sticky right-0 bg-background z-10 w-[160px]"},{default:n(()=>[t("div",Xt,[I.value==="once"?(g(),Y(ee,{key:0,size:"sm",variant:"outline",onClick:m=>Ie(a)},{default:n(()=>[...e[52]||(e[52]=[d(" 执行任务 ",-1)])]),_:1},8,["onClick"])):T("",!0),I.value==="timing"&&a.exec_status=="execting"||a.exec_status=="paused"?(g(),Y(ee,{key:1,size:"sm",variant:"outline",onClick:m=>je(a)},{default:n(()=>[d(h(a.exec_status=="execting"?"暂停任务":"继续任务"),1)]),_:2},1032,["onClick"])):T("",!0),i(ee,{size:"sm",variant:"outline",onClick:m=>Ke(a),class:"!text-blue-600 hover:!text-blue-700"},{default:n(()=>[...e[53]||(e[53]=[d("编辑任务",-1)])]),_:1},8,["onClick"]),t("button",{class:"inline-flex items-center justify-center font-medium gap-2 rounded-lg transition px-4 py-3 text-sm bg-white text-gray-700 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 dark:bg-gray-800 dark:text-gray-400 dark:ring-gray-700 dark:hover:bg-white/[0.03] dark:hover:text-gray-300 text-rose-600 ring-rose-200 hover:bg-rose-50 dark:text-rose-400 dark:ring-rose-500/30",onClick:m=>Ue(a,m)}," 删除任务 ",8,Jt)])]),_:2},1024)]),_:2},1024))),128)):(g(),Y(p(be),{key:1},{default:n(()=>[i(p(M),{colspan:15,class:"py-16 text-center text-gray-400 dark:text-white/40"},{default:n(()=>[...e[54]||(e[54]=[d("暂无数据",-1)])]),_:1})]),_:1}))]),_:1})]),_:1}),te.value>0?(g(),b("div",Ht,[i(p(Xe),{page:S.value,"onUpdate:page":e[7]||(e[7]=a=>S.value=a),total:te.value,"items-per-page":C.value,"sibling-count":1,"show-edges":""},{default:n(()=>[i(p(Je),null,{default:n(({items:a})=>[i(p(He)),(g(!0),b(ne,null,ce(a,(o,m)=>(g(),b(ne,{key:m},[o.type==="page"?(g(),Y(p(at),{key:0,value:o.value,"is-active":o.value===S.value},{default:n(()=>[d(h(o.value),1)]),_:2},1032,["value","is-active"])):(g(),Y(p(lt),{key:1,index:m},null,8,["index"]))],64))),128)),i(p(Ze))]),_:1})]),_:1},8,["page","total","items-per-page"])])):T("",!0)]),_:1}),le.value?(g(),Y(ot,{key:0,fullScreenBackdrop:!0,onClose:me},{body:n(()=>{var a;return[t("div",Zt,[e[75]||(e[75]=t("div",{style:{height:"24vh"}},null,-1)),t("h3",ea,h(P.value?"编辑任务":"新增任务"),1),t("form",{onSubmit:Ee(Be,["prevent"]),class:"space-y-4"},[t("div",ta,[t("div",null,[e[56]||(e[56]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[d("类型"),t("span",{class:"text-error-500"},"*")],-1)),A(t("select",{"onUpdate:modelValue":e[8]||(e[8]=o=>l.value.type=o),class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},[...e[55]||(e[55]=[t("option",{value:""},"请选择类型",-1),t("option",{value:"post"},"发帖",-1),t("option",{value:"reply_comment"},"回复评论",-1)])],512),[[Z,l.value.type]])]),t("div",null,[e[58]||(e[58]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[d("平台"),t("span",{class:"text-error-500"},"*")],-1)),A(t("select",{"onUpdate:modelValue":e[9]||(e[9]=o=>l.value.provider=o),onChange:f,class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},[...e[57]||(e[57]=[t("option",{value:""},"请选择平台",-1),t("option",{value:"twitter"},"Twitter",-1),t("option",{value:"facebook"},"Facebook",-1)])],544),[[Z,l.value.provider]])]),t("div",null,[e[60]||(e[60]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[d("语言"),t("span",{class:"text-error-500"},"*")],-1)),A(t("select",{"onUpdate:modelValue":e[10]||(e[10]=o=>l.value.language=o),class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},[...e[59]||(e[59]=[t("option",{value:""},"请选择语言",-1),t("option",{value:"zh"},"中文",-1),t("option",{value:"en"},"英文",-1),t("option",{value:"ja"},"日文",-1),t("option",{value:"ko"},"韩文",-1),t("option",{value:"es"},"西班牙文",-1),t("option",{value:"fr"},"法文",-1),t("option",{value:"de"},"德文",-1)])],512),[[Z,l.value.language]])])]),t("div",null,[e[62]||(e[62]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[d("推文信息"),t("span",{class:"text-error-500"},"*")],-1)),t("div",aa,[A(t("input",{"onUpdate:modelValue":e[11]||(e[11]=o=>l.value.prompt_display=o),type:"text",placeholder:"请输入推文信息或选择模板",onFocus:e[12]||(e[12]=o=>j.value=!0),onBlur:_,onInput:x,class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,544),[[F,l.value.prompt_display]]),t("div",la,[(g(),b("svg",{class:ye(["w-4 h-4 text-gray-400 transition-transform duration-200",{"rotate-180":j.value}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...e[61]||(e[61]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)])],2))]),j.value&&J.value.length>0?(g(),b("div",oa,[(g(!0),b(ne,null,ce(J.value,o=>(g(),b("div",{key:o.id,onMousedown:m=>U(o),class:"px-4 py-2 text-sm cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center justify-between"},[t("div",null,[t("div",sa,h(o.name),1)])],40,ra))),128))])):T("",!0)])]),t("div",null,[e[63]||(e[63]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[d("提及账号"),t("span",{class:"text-error-500"},"*")],-1)),A(t("input",{"onUpdate:modelValue":e[13]||(e[13]=o=>l.value.mentions=o),type:"text",placeholder:"多个提及账号使用逗号隔开 如：user1，user2",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[F,l.value.mentions]])]),t("div",null,[e[64]||(e[64]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[d("话题"),t("span",{class:"text-error-500"},"*")],-1)),A(t("input",{"onUpdate:modelValue":e[14]||(e[14]=o=>l.value.tags=o),type:"text",placeholder:"多个话题使用逗号隔开 如：品牌牛奶，优质水管",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[F,l.value.tags]])]),t("div",null,[e[65]||(e[65]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[d("机器人"),t("span",{class:"text-error-500"},"*")],-1)),(g(),Y(It,{modelValue:l.value.selected_accounts,"onUpdate:modelValue":e[15]||(e[15]=o=>l.value.selected_accounts=o),fetchApi:Me,labelKey:"name",valueKey:"id",onSelectionChange:v,key:`robot-selector-${P.value?q.value:"new"}-${r.value}`},null,8,["modelValue"]))]),l.value.type==="reply_comment"&&l.value.provider==="twitter"?(g(),b("div",na,[e[66]||(e[66]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},"Twitter回复ID",-1)),A(t("input",{"onUpdate:modelValue":e[16]||(e[16]=o=>l.value.twitter_reply_to_tweet_id=o),type:"text",placeholder:"请输入Twitter回复ID",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[F,l.value.twitter_reply_to_tweet_id]])])):T("",!0),l.value.type==="post"&&l.value.provider==="facebook"?(g(),b("div",da,[e[67]||(e[67]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},"Facebook页面ID",-1)),A(t("input",{"onUpdate:modelValue":e[17]||(e[17]=o=>l.value.facebook_page_id=o),type:"text",placeholder:"请输入Facebook页面ID",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[F,l.value.facebook_page_id]])])):T("",!0),l.value.type==="reply_comment"&&l.value.provider==="facebook"?(g(),b("div",ua,[e[68]||(e[68]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},"Facebook评论ID",-1)),A(t("input",{"onUpdate:modelValue":e[18]||(e[18]=o=>l.value.facebook_comment_id=o),type:"text",placeholder:"请输入Facebook评论ID",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[F,l.value.facebook_comment_id]])])):T("",!0),z.value==="timing"?(g(),b("div",ia,[e[71]||(e[71]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[d("执行频率"),t("span",{class:"text-error-500"},"*")],-1)),t("div",ca,[A(t("select",{"onUpdate:modelValue":e[19]||(e[19]=o=>l.value.exec_type=o),onChange:ve,class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},[...e[69]||(e[69]=[t("option",{value:""},"请选择频率类型",-1),t("option",{value:"fixed"},"指定日期",-1),t("option",{value:"daily"},"每天",-1),t("option",{value:"weekly"},"每周",-1),t("option",{value:"monthly"},"每月",-1)])],544),[[Z,l.value.exec_type]]),l.value.exec_type==="fixed"?A((g(),b("input",{key:0,"onUpdate:modelValue":e[20]||(e[20]=o=>l.value.exec_datetime=o),type:"datetime-local",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512)),[[F,l.value.exec_datetime]]):A((g(),b("select",{key:1,"onUpdate:modelValue":e[21]||(e[21]=o=>l.value.exec_nums=o),class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800",disabled:!l.value.exec_type},[e[70]||(e[70]=t("option",{value:""},"请选择执行次数",-1)),(g(!0),b(ne,null,ce(B.value,o=>(g(),b("option",{key:o.value,value:o.value},h(o.label),9,ga))),128))],8,pa)),[[Z,l.value.exec_nums]])])])):T("",!0),t("div",null,[e[72]||(e[72]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[d("推文后缀"),t("span",{class:"text-error-500"})],-1)),t("div",va,[A(t("textarea",{"onUpdate:modelValue":e[22]||(e[22]=o=>l.value.last_text=o),placeholder:"请输入推文后缀，最多300字",maxlength:"300",rows:"4",class:"dark:bg-dark-900 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800 resize-none"},null,512),[[F,l.value.last_text]]),t("div",ma,h(((a=l.value.last_text)==null?void 0:a.length)||0)+"/300 ",1)])]),t("div",null,[e[73]||(e[73]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},"备注",-1)),A(t("textarea",{"onUpdate:modelValue":e[23]||(e[23]=o=>l.value.task_remark=o),placeholder:"请输入备注信息（可选）",rows:"3",class:"dark:bg-dark-900 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800 resize-none"},null,512),[[F,l.value.task_remark]])]),t("div",fa,[i(ee,{type:"button",variant:"outline",onClick:me,disabled:N.value},{default:n(()=>[...e[74]||(e[74]=[d("取消",-1)])]),_:1},8,["disabled"]),i(ee,{type:"submit",disabled:N.value},{default:n(()=>[N.value?(g(),b("span",ya,"处理中...")):T("",!0),d(" "+h(P.value?"更新":"保存"),1)]),_:1},8,["disabled"])])],32)])]}),_:1})):T("",!0),i(tt,{isOpen:H.value,title:"删除",description:"确定要删除吗？此操作不可撤销。",isLoading:oe.value,triggerRect:ue.value,onClose:ke,onConfirm:De},null,8,["isOpen","isLoading","triggerRect"]),G.value?(g(),b("div",ba,[...e[76]||(e[76]=[t("div",{class:"flex flex-col items-center gap-3"},[t("div",{class:"animate-spin rounded-full h-12 w-12 border-4 border-gray-200 border-t-blue-600"}),t("span",{class:"text-blue-600 dark:text-blue-400 font-medium text-sm"},"任务正在执行，请稍后...")],-1)])])):T("",!0)])]),_:1}))}};export{$a as default};
