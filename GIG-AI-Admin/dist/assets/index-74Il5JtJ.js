import{r as n,w as W,o as X,c as k,a as u,b as t,t as p,d as l,e as r,g as B,f as b,h as i,u as s,F as I,i as G,j as g,n as Y,k as Z,l as x,v as _,p as ee}from"./index-C_WH1cgn.js";import{_ as ae,a as te}from"./AdminLayout-aCla68Vk.js";import{_ as re,f as le}from"./Primitive-rbbPGzXt.js";import{_ as V}from"./Button.vue_vue_type_script_setup_true_lang-C7mE4dwR.js";import{_ as se,a as oe}from"./DeleteConfirmDialog-Dv8WvOx6.js";import{g as ie,d as ne,u as de,a as ue,b as pe}from"./aiCofig-B7RPIK1X.js";import{_ as ge,a as fe,b as M,c,d as me,e as f,f as ce,g as ve,h as be,i as ye,j as ke,k as xe}from"./PaginationPrevious.vue_vue_type_script_setup_true_lang-BaJMHx_t.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./http-BKvr1fmS.js";const we={class:"space-y-5 sm:space-y-6"},he={class:"mb-4 flex items-center justify-between"},_e={class:"flex gap-2"},Ae={class:"flex items-center justify-end gap-2"},$e=["onClick"],Ce={key:0,class:"mt-4"},De={class:"relative z-10 w-full max-w-xl rounded-xl bg-white p-6 shadow-lg dark:bg-gray-900"},ze={class:"mb-4 text-lg font-semibold"},Ie=["value"],Ve={class:"flex justify-end gap-3 pt-2"},Te={key:0,class:"mr-2"},Ne={__name:"index",setup(Oe){const R=n("AI 服务配置"),T=n([]),w=n(1),S=n(20),O=n(0),N=n("");n(null),n(!1);const E=n([{title:"OpenAI",value:"openai"},{title:"Azure OpenAI",value:"azure"},{title:"Google Gemini",value:"gemini"},{title:"Anthropic",value:"anthropic"},{title:"Custom",value:"custom"},{title:"Grok",value:"grok"},{title:"Deepseek",value:"deepseek"}]),F={openai:"OpenAI",azure:"Azure OpenAI",gemini:"Google Gemini",anthropic:"Anthropic Claude",together:"Together Al",deepseek:"Deepseek",moonshot:"Moonshot",zhipuai:"智谱AI",custom:"自定义OpenAl兼容接口"};async function K(d){try{const e=await ne(d.id);m.value=!0,$.value=d.id,o.value={name:e.name||"",provider:e.provider||"",priority:e.priority||"",api_key:e.api_key||"",base_url:e.base_url||"",model:e.model||""},A.value=!0}catch(e){console.error("获取详情失败:",e),p.error("获取详情失败")}}function Q(d,e){D.value=d;const a=e.target.getBoundingClientRect();P.value={top:a.top,left:a.left,width:a.width,height:a.height,bottom:a.bottom},U.value=!0}async function q(){var d,e;if(D.value){C.value=!0;try{await pe(D.value.id),p.success("删除成功"),await z(),L()}catch(a){console.error("删除失败:",a),p.error("删除失败",{description:((e=(d=a.response)==null?void 0:d.data)==null?void 0:e.message)||a.message||"删除配置时发生错误"})}finally{C.value=!1}}}function L(){U.value=!1,D.value=null,C.value=!1}const A=n(!1),m=n(!1),$=n(null),y=n(!1),U=n(!1),C=n(!1),D=n(null),P=n({top:0,left:0,width:0,height:0}),o=n({name:"",provider:"",priority:"",api_key:"",base_url:"",model:""});function H(){m.value=!1,$.value=null,o.value={name:"",provider:"",priority:"",api_key:"",base_url:"",model:""},A.value=!0}function j(){A.value=!1,m.value=!1,$.value=null,o.value={name:"",provider:"",priority:"",api_key:"",base_url:"",model:""}}async function J(){var d,e;if(!y.value){if(!o.value.name||o.value.name.trim()===""){p.error("请填写配置名称",{description:"配置名称不能为空"});return}if(!o.value.provider||o.value.provider===""){p.error("请选择平台名称",{description:"平台名称不能为空"});return}if(!o.value.api_key||o.value.api_key.trim()===""){p.error("请填写API Key",{description:"API Key不能为空"});return}if(!o.value.model||o.value.model.trim()===""){p.error("请填写模型名称",{description:"模型名称不能为空"});return}if(!o.value.priority||o.value.priority===""){p.error("请填写优先级",{description:"优先级不能为空"});return}y.value=!0;try{const a={name:o.value.name.trim(),provider:o.value.provider,priority:o.value.priority,api_key:o.value.api_key.trim(),base_url:o.value.base_url.trim(),model:o.value.model.trim()};m.value?(await de($.value,a),p.success("配置更新成功")):(await ue(a),p.success("配置新增成功")),j(),await z()}catch(a){console.error(m.value?"更新失败:":"新增失败:",a),p.error(m.value?"更新失败":"新增失败",{description:((e=(d=a.response)==null?void 0:d.data)==null?void 0:e.message)||a.message||(m.value?"更新配置时发生错误":"新增配置时发生错误")})}finally{y.value=!1}}}const z=async()=>{var d,e;try{let a=await ie({search:N.value,page:w.value});T.value=a.results,O.value=a.count}catch(a){console.error("获取列表失败:",a),p.error("获取列表失败",{description:((e=(d=a.response)==null?void 0:d.data)==null?void 0:e.message)||a.message||"获取配置列表时发生错误"})}};return W(w,d=>{console.log("Page changed to:",d),z()}),X(()=>{z()}),(d,e)=>(u(),k(ae,null,{default:t(()=>[l(te,{pageTitle:R.value},null,8,["pageTitle"]),r("div",we,[l(re,null,{default:t(()=>[r("div",he,[e[8]||(e[8]=r("div",{class:"flex items-center gap-3"},null,-1)),r("div",_e,[l(V,{size:"sm",onClick:H},{default:t(()=>[...e[7]||(e[7]=[i("新增",-1)])]),_:1})])]),l(s(ge),{class:"[&_td]:py-3.5 [&_th]:py-3.5"},{default:t(()=>[l(s(fe),null,{default:t(()=>[l(s(M),null,{default:t(()=>[l(s(c),{class:"whitespace-nowrap"},{default:t(()=>[...e[9]||(e[9]=[i("序号",-1)])]),_:1}),l(s(c),{class:"whitespace-nowrap"},{default:t(()=>[...e[10]||(e[10]=[i("配置名称",-1)])]),_:1}),l(s(c),{class:"whitespace-nowrap"},{default:t(()=>[...e[11]||(e[11]=[i("平台名称",-1)])]),_:1}),l(s(c),{class:"whitespace-nowrap"},{default:t(()=>[...e[12]||(e[12]=[i("key",-1)])]),_:1}),l(s(c),{class:"whitespace-nowrap"},{default:t(()=>[...e[13]||(e[13]=[i("基础地址",-1)])]),_:1}),l(s(c),{class:"whitespace-nowrap"},{default:t(()=>[...e[14]||(e[14]=[i("状态",-1)])]),_:1}),l(s(c),{class:"whitespace-nowrap"},{default:t(()=>[...e[15]||(e[15]=[i("优先级",-1)])]),_:1}),l(s(c),{class:"whitespace-nowrap"},{default:t(()=>[...e[16]||(e[16]=[i("创建时间",-1)])]),_:1}),l(s(c),{class:"whitespace-nowrap text-right"},{default:t(()=>[...e[17]||(e[17]=[i("操作",-1)])]),_:1})]),_:1})]),_:1}),l(s(me),null,{default:t(()=>[T.value.length?(u(!0),b(I,{key:0},G(T.value,(a,v)=>(u(),k(s(M),{key:a.id},{default:t(()=>[l(s(f),{class:"whitespace-nowrap"},{default:t(()=>[i(g(v+1),1)]),_:2},1024),l(s(f),{class:"whitespace-nowrap"},{default:t(()=>[i(g(a.name),1)]),_:2},1024),l(s(f),{class:"whitespace-nowrap"},{default:t(()=>[i(g(F[a.provider]),1)]),_:2},1024),l(s(f),{class:"whitespace-nowrap"},{default:t(()=>[i(g(a.api_key),1)]),_:2},1024),l(s(f),{class:"whitespace-nowrap"},{default:t(()=>[i(g(a.base_url),1)]),_:2},1024),l(s(f),{class:"whitespace-nowrap"},{default:t(()=>[r("span",{class:Y(["inline-flex items-center rounded-full px-2 py-0.5 text-xs font-medium ring-1 ring-inset",a.enabled?"bg-emerald-50 text-emerald-600 ring-emerald-200 dark:bg-emerald-500/10 dark:text-emerald-400 dark:ring-emerald-500/30":"bg-rose-50 text-rose-600 ring-rose-200 dark:bg-rose-500/10 dark:text-rose-400 dark:ring-rose-500/30"])},g(a.enabled?"正常":"禁用"),3)]),_:2},1024),l(s(f),{class:"whitespace-nowrap"},{default:t(()=>[i(g(a.priority),1)]),_:2},1024),l(s(f),{class:"whitespace-nowrap"},{default:t(()=>[i(g(s(le)(a.created_at)),1)]),_:2},1024),l(s(f),{class:"text-right whitespace-nowrap"},{default:t(()=>[r("div",Ae,[l(V,{size:"sm",variant:"outline",onClick:h=>K(a)},{default:t(()=>[...e[18]||(e[18]=[i("编辑",-1)])]),_:1},8,["onClick"]),r("button",{class:"inline-flex items-center justify-center font-medium gap-2 rounded-lg transition px-4 py-3 text-sm bg-white text-gray-700 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 dark:bg-gray-800 dark:text-gray-400 dark:ring-gray-700 dark:hover:bg-white/[0.03] dark:hover:text-gray-300 text-rose-600 ring-rose-200 hover:bg-rose-50 dark:text-rose-400 dark:ring-rose-500/30",onClick:h=>Q(a,h)}," 删除 ",8,$e)])]),_:2},1024)]),_:2},1024))),128)):(u(),k(s(M),{key:1},{default:t(()=>[l(s(f),{colspan:7,class:"py-16 text-center text-gray-400 dark:text-white/40"},{default:t(()=>[...e[19]||(e[19]=[i("暂无数据",-1)])]),_:1})]),_:1}))]),_:1})]),_:1}),O.value>0?(u(),b("div",Ce,[l(s(ce),{page:w.value,"onUpdate:page":e[0]||(e[0]=a=>w.value=a),total:O.value,"items-per-page":S.value,"sibling-count":1},{default:t(()=>[l(s(ve),null,{default:t(({items:a})=>[l(s(be)),(u(!0),b(I,null,G(a,(v,h)=>(u(),b(I,{key:h},[v.type==="page"?(u(),k(s(ye),{key:0,value:v.value,"is-active":v.value===w.value},{default:t(()=>[i(g(v.value),1)]),_:2},1032,["value","is-active"])):(u(),k(s(ke),{key:1,index:h},null,8,["index"]))],64))),128)),l(s(xe))]),_:1})]),_:1},8,["page","total","items-per-page"])])):B("",!0)]),_:1}),A.value?(u(),k(se,{key:0,fullScreenBackdrop:!0,onClose:j},{body:t(()=>[r("div",De,[r("h3",ze,g(m.value?"编辑服务配置":"新增服务配置"),1),r("form",{onSubmit:Z(J,["prevent"]),class:"space-y-4"},[r("div",null,[e[20]||(e[20]=r("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[i("配置名称"),r("span",{class:"text-error-500"},"*")],-1)),x(r("input",{"onUpdate:modelValue":e[1]||(e[1]=a=>o.value.name=a),type:"text",placeholder:"如：OpenAI GPT-4配置",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[_,o.value.name]])]),r("div",null,[e[22]||(e[22]=r("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[i("平台名称"),r("span",{class:"text-error-500"},"*")],-1)),x(r("select",{"onUpdate:modelValue":e[2]||(e[2]=a=>o.value.provider=a),class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},[e[21]||(e[21]=r("option",{value:""},"请选择平台",-1)),(u(!0),b(I,null,G(E.value,(a,v)=>(u(),b("option",{value:a.value,key:v},g(a.title),9,Ie))),128))],512),[[ee,o.value.provider]])]),r("div",null,[e[23]||(e[23]=r("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[i("key"),r("span",{class:"text-error-500"},"*")],-1)),x(r("input",{"onUpdate:modelValue":e[3]||(e[3]=a=>o.value.api_key=a),type:"password",placeholder:"请输入key",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[_,o.value.api_key]])]),r("div",null,[e[24]||(e[24]=r("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},"基础地址",-1)),x(r("input",{"onUpdate:modelValue":e[4]||(e[4]=a=>o.value.base_url=a),type:"text",placeholder:"如：https://api.openai.com/v1",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[_,o.value.base_url]])]),r("div",null,[e[25]||(e[25]=r("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[i("模型名称"),r("span",{class:"text-error-500"},"*")],-1)),x(r("input",{"onUpdate:modelValue":e[5]||(e[5]=a=>o.value.model=a),type:"text",placeholder:"如：gpt-4、claude-3-sonnet",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[_,o.value.model]])]),r("div",null,[e[26]||(e[26]=r("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[i("优先级"),r("span",{class:"text-error-500"},"*")],-1)),x(r("input",{"onUpdate:modelValue":e[6]||(e[6]=a=>o.value.priority=a),type:"number",placeholder:"如：8",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[_,o.value.priority]])]),r("div",Ve,[l(V,{type:"button",variant:"outline",onClick:j,disabled:y.value},{default:t(()=>[...e[27]||(e[27]=[i("取消",-1)])]),_:1},8,["disabled"]),l(V,{type:"submit",disabled:y.value},{default:t(()=>[y.value?(u(),b("span",Te,"处理中...")):B("",!0),i(" "+g(m.value?"更新":"保存"),1)]),_:1},8,["disabled"])])],32)])]),_:1})):B("",!0),l(oe,{isOpen:U.value,title:"删除",description:"确定要删除吗？此操作不可撤销。",isLoading:C.value,triggerRect:P.value,onClose:L,onConfirm:q},null,8,["isOpen","isLoading","triggerRect"])])]),_:1}))}};export{Ne as default};
