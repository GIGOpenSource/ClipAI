import{r as p,f as ue,w as be,j as he,c as b,o as g,a as t,C as A,D as F,K as Pe,t as h,B as R,F as se,v as ie,m as me,u as Oe,z as W,A as d,x as i,E as u,n as fe,J as X,y as c,I as qe,H as T}from"./index-C48miiTf.js";import{a as Fe,_ as Ee}from"./AdminLayout-C6b243UD.js";import{_ as Ne,a as Ge,b as ye,c as z,d as Qe,e as D,P as Ye,f as We,g as Xe,h as Je,i as He,j as Ze,k as et,l as tt}from"./DeleteConfirmDialog-DVx0dMiq.js";import{a as ae,_ as at,f as we}from"./chevron-right-B88JNwVU.js";import{_ as lt}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{e as Se,f as Ae,p as ot,h as rt}from"./index-DwLEtfjI.js";import{g as st}from"./prompts-DDFs28cL.js";import{g as nt}from"./pool-BT4AK5BM.js";const dt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAVCAYAAACpF6WWAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAHpSURBVHgBtVVRTvJAEJ7Z7Z/8f/Kr5QRyBDmBPBtB9AKiYOKbeAM9gfBmYip6AVOU+CregBtYT0CxJprY3XHaaq3QGqnxS5rt7sx8O518M0X4ArXdp2Kq4e+za7cLblYcZhkq2w91tnYzgpwHpUqDs3TiT6SV5rgFGvdCA4JJvGoNraSPQChzVB0InGBPiI7xx9+yjwvOu4/x/lKrj0xFeEQIgyATIuJgNIUQ5c95UJEfJoMh+7kCqKZe5BEb1qdIGWYYAuKsb/0/r+2MlnwlughqgjTMbtC35kOSSsMr8hVm0m5ABuyTwpCXEuSAgF9AaqZBfbWUd/RWklQQ7V+dLrS/TWqzVKoN74DoC1KhhjBLpgEurbkO5EQmabU55kzlYnyA2pWG6iT1OBNpUFNfwxrL6ePzucC+Dz1+cyAPqR21Xy45BcgtqZWdx6VgJfA7gOowaTMgB1abXhm1vlmpj0p9q2BP2n8kfonGQtr5TJkG45D7fhM06xfDSdZebXguku4lG2GmTDWrASEciG97DRhNLEr6xfOUZVRU3Jp80ibA3hQh+u51NGSimhLd8GH5qjt3O+kbfz7LyKluj4dM2OKLW5OOkmSchMEXqGifiqnfSWXLW05zlOSP+eK43zcaT4sX1r/7NN9XGQO8MiUQW74AAAAASUVORK5CYII=",ut={class:"robot-selector-container"},it={class:"search-section"},ct={class:"search-input-group"},pt={class:"search-buttons"},gt=["disabled"],vt={class:"selection-section"},mt={class:"selection-box"},ft={class:"selection-header"},yt={class:"select-all-label"},bt=["checked","indeterminate"],xt={key:0,class:"loading-state"},kt={key:1,class:"empty-state"},_t={key:2,class:"robot-list"},wt=["checked","onChange"],ht={class:"robot-name"},St={key:0,class:"loading-more"},At={key:1,class:"no-more-data"},Vt={__name:"RobotSelector",props:{fetchApi:{type:Function,required:!0},modelValue:{type:Array,default:()=>[]},labelKey:{type:String,default:"name"},valueKey:{type:String,default:"id"}},emits:["update:modelValue","selectionChange"],setup(B,{emit:J}){const n=B,V=J,S=p(""),$=p([]),H=p(!1),M=p(!1),U=p(!1),L=p(1),O=p(!0),N=p(0),Z=p(20),w=p(!1),ne=p([]),G=p(0),C=ue(()=>{if(!S.value.trim())return $.value;const r=S.value.toLowerCase();return $.value.filter(v=>E(v).toLowerCase().includes(r))}),Q=ue(()=>n.modelValue.map(r=>String(typeof r=="object"?r[n.valueKey]:r)));be([$,w],()=>{w.value&&n.modelValue.length===0?console.log("全选状态：robots 变化，所有机器人应该显示为选中"):w.value&&n.modelValue.length>0&&console.log("反选状态：robots 变化，根据 modelValue 决定选中状态")},{deep:!0});const ee=ue(()=>w.value?n.modelValue.length===0:C.value.length>0&&C.value.every(r=>Y(r))),P=ue(()=>{if(w.value)return n.modelValue.length>0;const r=C.value.filter(v=>Y(v)).length;return r>0&&r<C.value.length}),q=ue(()=>w.value?n.modelValue.length===0?{selected:!0,selected_accounts:[]}:{selectStatus:!1,selected_accounts:n.modelValue.map(r=>({id:String(typeof r=="object"?r[n.valueKey]:r),name:typeof r=="object"&&(r[n.labelKey]||r[n.valueKey])||String(r)}))}:n.modelValue.length>0?{selected:!0,selected_accounts:n.modelValue.map(r=>({id:String(typeof r=="object"?r[n.valueKey]:r),name:typeof r=="object"&&(r[n.labelKey]||r[n.valueKey])||String(r)}))}:{selected:!1,selected_accounts:[]}),E=r=>{const v=r[n.labelKey]||r[n.valueKey]||String(r);return(r.remark?`(${r.remark})`:"")+v},Y=r=>{if(w.value){if(n.modelValue.length===0)return console.log(`全选状态：机器人 ${r[n.valueKey]} 应该显示为选中`),!0;const x=String(r[n.valueKey]),_=n.modelValue.some(K=>String(typeof K=="object"?K[n.valueKey]:K)===x),I=!_;return console.log(`反选模式：机器人 ${x} 是否在未选中列表中: ${_}, 应该显示为选中: ${I}`),I}const v=String(r[n.valueKey]),f=Q.value.includes(v);return console.log(`普通模式：机器人 ${v} 是否选中: ${f}`),console.log("当前 modelValue:",n.modelValue),console.log("selectedRobotIds:",Q.value),f},le=r=>{const v=String(r[n.valueKey]),f=Y(r);if(console.log("=== toggleRobot 被调用 ==="),console.log("机器人:",r),console.log("机器人ID:",v),console.log("当前是否选中:",f),console.log("是否全局全选:",w.value),console.log("当前modelValue:",n.modelValue),w.value){if(n.modelValue.length===0){const _={id:String(v),name:r[n.labelKey]||String(v)};V("update:modelValue",[_]),console.log("从全局全选中移除项目，进入反选模式，反选列表:",[_])}else{let _=[...n.modelValue];if(f){const I={id:String(v),name:r[n.labelKey]||String(v)};_.push(I),console.log("添加到反选列表:",I),V("update:modelValue",_)}else _=_.filter(I=>String(typeof I=="object"?I[n.valueKey]:I)!==v),console.log("从反选列表中移除项目"),_.length===0?(V("update:modelValue",[]),console.log("反选列表为空，回到真正的全选状态")):V("update:modelValue",_)}me(()=>{V("selectionChange",q.value)});return}let x=[...n.modelValue];f?x=x.filter(_=>String(typeof _=="object"?_[n.valueKey]:_)!==v):(x.push(r),console.log("添加机器人到选择列表:",r),console.log("新的选择列表:",x)),console.log("准备发送 update:modelValue 事件:",x),V("update:modelValue",x),me(()=>{console.log("触发 selectionChange 事件:",q.value),V("selectionChange",q.value)})},oe=()=>{if(!ee.value)w.value=!0,V("update:modelValue",[]),console.log("=== 启用全局全选模式 ==="),console.log("全选模式：selected: true, selected_accounts: []");else if(w.value)if(n.modelValue.length>0)V("update:modelValue",[]),console.log("从反选状态回到真正的全选状态");else{w.value=!1;const v=C.value.map(x=>String(x[n.valueKey])),f=n.modelValue.filter(x=>{const _=String(typeof x=="object"?x[n.valueKey]:x);return!v.includes(_)});V("update:modelValue",f),console.log("取消全局全选模式")}else{w.value=!1;const v=C.value.map(x=>String(x[n.valueKey])),f=n.modelValue.filter(x=>{const _=String(typeof x=="object"?x[n.valueKey]:x);return!v.includes(_)});V("update:modelValue",f)}me(()=>{V("selectionChange",q.value)})},de=async()=>{M.value=!0;try{w.value=!1,await l(!0)}finally{M.value=!1}},re=()=>{S.value="",w.value=!1,l(!0)},ce=r=>{const{scrollTop:v,scrollHeight:f,clientHeight:x}=r.target;v+x>=f-10&&O.value&&!U.value&&j()},l=async(r=!1)=>{r&&(L.value=1,$.value=[],O.value=!0),H.value=!0;try{const v={page:L.value,page_size:Z.value};S.value.trim()&&(v.remark=S.value.trim());const f=await n.fetchApi(v),x=f.results||f.data||[];if(N.value=f.count||f.total||0,r&&L.value===1&&!S.value.trim()&&(ne.value=f.results||f.data||[],G.value=f.count||f.total||0),r)$.value=x;else{const _=new Set($.value.map(K=>K[n.valueKey])),I=x.filter(K=>!_.has(K[n.valueKey]));$.value=[...$.value,...I],I.length>0&&(ne.value=[...ne.value,...I],G.value=f.count||f.total||0)}w.value&&n.modelValue.length===0?console.log("全选状态下加载数据，当前页机器人应该都显示为选中"):w.value&&n.modelValue.length>0&&console.log("反选状态下加载数据，根据 modelValue 决定选中状态"),O.value=$.value.length<N.value}catch(v){console.error("获取机器人列表失败:",v),r&&($.value=[])}finally{H.value=!1}},j=async()=>{if(!(U.value||!O.value)){U.value=!0,L.value+=1;try{await l(!1)}finally{U.value=!1}}};return be(S,r=>{r.trim()===""&&(w.value=!1,l(!0))}),he(()=>{l(!0)}),(r,v)=>(g(),b("div",ut,[t("div",it,[t("div",ct,[A(t("input",{"onUpdate:modelValue":v[0]||(v[0]=f=>S.value=f),type:"text",placeholder:"搜索机器人",class:"search-input",onKeyup:Pe(de,["enter"])},null,544),[[F,S.value]]),t("div",pt,[t("button",{type:"button",onClick:de,disabled:M.value,class:"search-btn"},h(M.value?"搜索中...":"搜索"),9,gt),t("button",{type:"button",onClick:re,class:"reset-btn"}," 重置 ")])])]),t("div",vt,[t("div",mt,[t("div",ft,[t("label",yt,[t("input",{type:"checkbox",checked:ee.value,indeterminate:P.value,onChange:oe,class:"select-all-checkbox"},null,40,bt),v[1]||(v[1]=t("span",{class:"select-all-text"},"全选",-1))])]),t("div",{class:"selection-list",ref:"selectionList",onScroll:ce},[H.value&&$.value.length===0?(g(),b("div",xt,[...v[2]||(v[2]=[t("div",{class:"loading-spinner"},null,-1),t("span",null,"加载中...",-1)])])):$.value.length===0?(g(),b("div",kt,h(S.value?"无搜索结果":"暂无机器人"),1)):(g(),b("div",_t,[(g(!0),b(se,null,ie(C.value,f=>(g(),b("label",{key:f.id,class:"robot-item"},[t("input",{type:"checkbox",checked:Y(f),onChange:x=>le(f),class:"robot-checkbox"},null,40,wt),t("span",ht,h(E(f)),1)]))),128)),U.value?(g(),b("div",St,[...v[3]||(v[3]=[t("div",{class:"loading-spinner-small"},null,-1),t("span",null,"加载更多...",-1)])])):!O.value&&$.value.length>0?(g(),b("div",At," 没有更多数据了 ")):R("",!0)]))],544)])])]))}},$t=lt(Vt,[["__scopeId","data-v-c4703836"]]),Ct=B=>Se("/tasks/simple/",{params:B}),jt=B=>Se(`/tasks/simple/${B}/`),It=B=>Ae("/tasks/simple/",B),Kt=(B,J)=>ot(`/tasks/simple/${B}/`,J),Dt=B=>rt(`/tasks/simple/${B}/`),Bt=(B,J)=>Ae(`/tasks/simple/${B}/schedule/`,J),Mt={class:"space-y-5 sm:space-y-6"},Ut={class:"flex justify-between items-center mb-4"},Tt={class:"relative"},zt={key:0,class:"absolute right-0 mt-2 w-48 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 z-50"},Rt={class:"py-1"},Lt={class:"mb-4 flex items-center gap-1 border-b border-gray-200"},Pt={key:0,class:"absolute bottom-0 left-1/2 transform -translate-x-1/2 w-12 h-0.5 bg-blue-600"},Ot={key:0,class:"absolute bottom-0 left-1/2 transform -translate-x-1/2 w-12 h-0.5 bg-blue-600"},qt={class:"mb-4 flex items-center justify-between"},Ft={class:"flex items-center gap-3"},Et={key:0,class:"mr-2"},Nt={key:1,class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Gt=["title"],Qt={class:"flex items-center justify-end gap-2"},Yt=["onClick"],Wt={key:0,class:"mt-4"},Xt={class:"relative z-10 w-full max-w-2xl rounded-xl bg-white p-6 shadow-lg dark:bg-gray-900"},Jt={class:"mb-4 text-lg font-semibold"},Ht={class:"grid grid-cols-3 gap-4"},Zt={class:"relative prompt-dropdown"},ea={class:"absolute right-3 top-1/2 transform -translate-y-1/2 pointer-events-none"},ta={key:0,class:"absolute z-50 w-full mt-1 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded-lg shadow-lg max-h-60 overflow-y-auto"},aa=["onMousedown"],la={class:"font-medium text-gray-900 dark:text-gray-100"},oa={key:0},ra={key:1},sa={key:2},na={key:3},da={class:"grid grid-cols-2 gap-4"},ua=["disabled"],ia=["value"],ca={class:"relative"},pa={class:"absolute bottom-2 right-2 text-xs text-gray-400"},ga={class:"flex justify-end gap-3 pt-2"},va={key:0,class:"mr-2"},ma={key:1,class:"fixed inset-0 bg-transparent flex items-center justify-center z-50"},Sa={__name:"new",setup(B){const J={execting:"执行中",paused:"已暂停",waiting:"等待中",completed:"已完成",part_success:" 部分成功",part_failure:"部分失败"},n=p("任务列表"),V=p([]),S=p(1),$=p(20),H=p(0),M=p("task_timing_type"),U=p("once"),L=p(!1),O=p(""),N=p(""),Z=p(""),w=p(!1),ne={zh:"中文",en:"英文",ja:"日文",ko:"韩文",es:"西班牙文",fr:"法文",de:"德文"},G=p([]);p([]);const C=p(!1),Q=p([]),ee=p(!1),P=p(!1),q=p(null),E=p(!1),Y=p(!1),le=p(!1),oe=p(null),de=p({top:0,left:0,width:0,height:0}),re=p(!1),ce=p(null),l=p({type:"",provider:"",language:"",text:"",last_text:"",mentions:"",tags:"",payload:"",selected_accounts:[],prompt:"",prompt_id:"",prompt_display:"",task_timing_type:"",exec_type:"",exec_datetime:"",exec_nums:"",twitter_reply_to_tweet_id:"",facebook_page_id:"",facebook_comment_id:"",task_orig_id:"",task_remark:"",frequency_value:""});p("once");const j=p({selected:!1,selectStatus:!1,selected_accounts:[]}),r=p(0),v=s=>{console.log("机器人选择状态变化:",s),j.value={...s}},f=()=>{console.log("平台变化:",l.value.provider),l.value.selected_accounts=[],j.value={selected:!1,selectStatus:!1,selected_accounts:[]},r.value=Date.now()},x=()=>{const s=l.value.prompt_display.toLowerCase();l.value.prompt_id="",l.value.prompt=l.value.prompt_display,s?Q.value=G.value.filter(e=>e.name.toLowerCase().includes(s)||e.content&&e.content.toLowerCase().includes(s)):Q.value=G.value,C.value=!0},_=()=>{setTimeout(()=>{C.value=!1},200)},I=s=>{l.value.prompt_display=s.name,l.value.prompt=s.id,l.value.prompt_id=s.id,C.value=!1},K=p([]),ge=()=>{switch(l.value.exec_datetime="",l.value.exec_nums="",l.value.exec_type){case"fixed":K.value=[];break;case"daily":case"weekly":case"monthly":K.value=Array.from({length:5},(s,e)=>({value:`${e+1}`,label:`${e+1}次`}));break;default:K.value=[]}},Ve=s=>{if(!s)return"";const e=new Date(s),a=e.getFullYear(),o=String(e.getMonth()+1).padStart(2,"0"),m=String(e.getDate()).padStart(2,"0"),y=String(e.getHours()).padStart(2,"0"),k=String(e.getMinutes()).padStart(2,"0"),Le=String(e.getSeconds()).padStart(2,"0");return`${a}-${o}-${m} ${y}:${k}:${Le}`},$e=s=>{if(!s)return"";const e=new Date(s),a=e.getFullYear(),o=String(e.getMonth()+1).padStart(2,"0"),m=String(e.getDate()).padStart(2,"0"),y=String(e.getHours()).padStart(2,"0"),k=String(e.getMinutes()).padStart(2,"0");return`${a}-${o}-${m}T${y}:${k}`};async function Ce(s){if(!re.value){re.value=!0,ce.value=s.id;try{const e=await Bt(String(s.id),{method:s.exec_status=="execting"?"pause":"resume"});console.log(e,"resres"),te()}catch(e){console.error("Failed to run task:",e)}finally{re.value=!1,ce.value=null}}}async function je(s){var e;try{const a=await jt(s.id);P.value=!0,q.value=s.id;let o="";Array.isArray(a.tags)?o=a.tags.join(","):o=a.tags||"";let m=[];if(console.log("=== 编辑时处理 selected_accounts ==="),console.log("原始 selected_accounts 数据:",a.selected_accounts),console.log("数据类型:",typeof a.selected_accounts),console.log("是否为数组:",Array.isArray(a.selected_accounts)),Array.isArray(a.selected_accounts)?m=a.selected_accounts.map(y=>{const k={id:String(y.id||y),name:y.name||y.remark||String(y.id||y)};return console.log("处理数组中的账户:",y,"->",k),k}):typeof a.selected_accounts=="object"&&a.selected_accounts!==null?m=Object.keys(a.selected_accounts).map(y=>{const k={id:String(y),name:a.selected_accounts[y]||String(y)};return console.log("处理对象中的账户:",y,"->",k),k}):typeof a.selected_accounts=="string"&&(m=a.selected_accounts.split(",").map(y=>{const k={id:String(y.trim()),name:String(y.trim())};return console.log("处理字符串中的账户:",y,"->",k),k})),console.log("处理后的 selectedAccountsValue:",m),l.value={type:a.type||"",provider:a.provider||"",language:a.language||"",text:a.text||"",last_text:a.last_text||"",mentions:a.mentions||"",tags:o,payload:a.payload||"",selected_accounts:m,exec_prom_text:!!a.prompt_id,prompt:a.prompt_id?a.prompt_id:null,prompt_text:a.prompt_id?null:a.prompt||"",prompt_display:a.prompt_id?((e=G.value.find(y=>y.id===a.prompt_id))==null?void 0:e.name)||a.prompt||"":a.prompt||"",task_timing_type:a.task_timing_type||M.value,exec_type:a.exec_type||"",exec_datetime:$e(a.exec_datetime)||"",exec_nums:a.exec_nums||"",twitter_reply_to_tweet_id:a.twitter_reply_to_tweet_id||"",facebook_page_id:a.facebook_page_id||"",facebook_comment_id:a.facebook_comment_id||"",task_remark:a.task_remark||"",frequency_value:a.frequency_value||""},M.value=a.task_timing_type,j.value={selected:!1,selectStatus:!1,selected_accounts:[]},console.log("=== 编辑模式表单数据填充完成 ==="),console.log("form.value.selected_accounts:",l.value.selected_accounts),console.log("selectionStatus.value:",j.value),console.log("原始 exec_datetime:",a.exec_datetime),console.log("转换后 exec_datetime:",l.value.exec_datetime),console.log("form.value.exec_type:",l.value.exec_type),a.exec_type){l.value.exec_type=a.exec_type;const y=l.value.exec_datetime,k=l.value.exec_nums;ge(),l.value.exec_datetime=y,l.value.exec_nums=k||a.exec_nums||""}ee.value=!0}catch(a){console.error("获取详情失败:",a),T.error("获取详情失败")}}function Ie(s,e){oe.value=s;const a=e.target.getBoundingClientRect();de.value={top:a.top,left:a.left,width:a.width,height:a.height,bottom:a.bottom},Y.value=!0}async function Ke(){var s,e;if(oe.value){le.value=!0;try{await Dt(oe.value.id),T.success("删除成功"),await te(),xe()}catch(a){console.error("删除失败:",a),T.error("删除失败",{description:((e=(s=a.response)==null?void 0:s.data)==null?void 0:e.message)||a.message||"删除任务时发生错误"})}finally{le.value=!1}}}function xe(){Y.value=!1,oe.value=null,le.value=!1}function ke(){P.value=!1,q.value=null,l.value={type:"",provider:"",language:"",text:"",mentions:"",tags:"",payload:"",selected_accounts:[],prompt:"",prompt_id:"",prompt_display:"",task_timing_type:M.value,exec_type:"",exec_datetime:"",exec_nums:"",twitter_reply_to_tweet_id:"",facebook_page_id:"",facebook_comment_id:"",task_remark:"",frequency_value:""},K.value=[],ee.value=!0}function ve(){ee.value=!1,P.value=!1,q.value=null,l.value={type:"",provider:"",language:"",text:"",mentions:"",tags:"",payload:"",selected_accounts:[],prompt:"",prompt_id:"",prompt_display:"",task_timing_type:"",exec_type:"",exec_datetime:"",exec_nums:"",twitter_reply_to_tweet_id:"",facebook_page_id:"",facebook_comment_id:"",task_remark:"",frequency_value:""},K.value=[]}async function De(){var e,a;if(E.value)return;if(!l.value.type||l.value.type.trim()===""){T.error("请选择类型",{description:"类型不能为空"});return}if(!l.value.provider||l.value.provider.trim()===""){T.error("请选择平台",{description:"平台不能为空"});return}if(!l.value.language||l.value.language.trim()===""){T.error("请选择语言",{description:"语言不能为空"});return}if(!(j.value.selected===!0||j.value.selectStatus===!1&&j.value.selected_accounts.length>0||l.value.selected_accounts.length>0)){T.error("请选择机器人",{description:"机器人不能为空"});return}if(M.value==="timing"){if(!l.value.exec_type||l.value.exec_type.trim()===""){T.error("请选择执行频率类型",{description:"执行频率类型不能为空"});return}if(l.value.exec_type==="fixed"){if(!l.value.exec_datetime||l.value.exec_datetime.trim()===""){T.error("请选择指定日期",{description:"指定日期不能为空"});return}}else if(!l.value.exec_nums||l.value.exec_nums.trim()===""){T.error("请选择执行次数",{description:"执行次数不能为空"});return}}E.value=!0;try{let o=[];l.value.tags&&l.value.tags.trim()!==""&&(o=l.value.tags.split(",").map(k=>k.trim()).filter(k=>k!==""));let m={};j.value.selected===!0&&j.value.selected_accounts.length===0?m={select_status:!0,selected_accounts:[]}:j.value.selected===!0&&j.value.selected_accounts.length>0?m={select_status:!0,selected_accounts:j.value.selected_accounts.map(k=>({id:String(k.id),name:k.name||String(k.id)}))}:j.value.selectStatus===!1?m={select_status:!1,selected_accounts:j.value.selected_accounts.map(k=>({id:String(k.id),name:k.name||String(k.id)}))}:m={select_status:!0,selected_accounts:[]};const y={type:l.value.type,provider:l.value.provider,language:l.value.language,text:l.value.text.trim(),last_text:l.value.last_text,mentions:l.value.mentions||"",tags:o,payload:"",...m,exec_prom_text:!!l.value.prompt_id,prompt:l.value.prompt_id?l.value.prompt_id:null,prompt_text:l.value.prompt_id?null:l.value.prompt||"",twitter_reply_to_tweet_id:"",facebook_page_id:"",facebook_comment_id:"",task_remark:l.value.task_remark.trim()||"",...M.value==="timing"?{exec_type:l.value.exec_type,...l.value.exec_type==="fixed"?{exec_datetime:Ve(l.value.exec_datetime)}:{exec_nums:l.value.exec_nums}}:{},task_timing_type:M.value};console.log("=== 提交给 createAutoPlay 的数据 ===",y),P.value?(await Kt(q.value,y),T.success("任务更新成功")):(await It(y),T.success("任务新增成功")),ve(),await te()}catch(o){console.error(P.value?"更新失败:":"新增失败:",o),T.error(P.value?"更新失败":"新增失败",{description:((a=(e=o.response)==null?void 0:e.data)==null?void 0:a.message)||o.message||(P.value?"更新任务时发生错误":"新增任务时发生错误")})}finally{E.value=!1}}const Be=async s=>{console.log(111);try{const e={page:s.page,provider:l.value.provider||""};s.search&&(e.remark=s.search);const a=await nt(e);console.log("=== API返回原始数据 ===",a);let o=a.results||a.data||[];return console.log("=== 过滤前的数据 ===",o),s.exclude_ids&&s.exclude_ids.length>0&&(console.log("=== 排除ID列表 ===",s.exclude_ids),o=o.filter(m=>{const y=s.exclude_ids.includes(String(m.id));return console.log(`项目 ${m.id} (${m.name}) 是否排除: ${y}`),!y})),s.include_ids&&s.include_ids.length>0&&(console.log("=== 包含ID列表 ===",s.include_ids),o=o.filter(m=>{const y=s.include_ids.includes(String(m.id));return console.log(`项目 ${m.id} (${m.name}) 是否包含: ${y}`),y})),console.log("=== 过滤后的数据 ===",o),{results:o,count:a.count||a.total||0,total:a.count||a.total||0}}catch(e){return console.error("获取机器人列表失败:",e),{results:[],count:0,total:0}}},Me=async()=>{try{const s=await st({page:1});G.value=s.results||s.data||[],Q.value=G.value}catch(s){console.error("获取提示词列表失败:",s)}},Ue=()=>{L.value=!L.value},Te=s=>{L.value=!1,M.value=s,ke()},ze=()=>{L.value=!1,M.value="timing",ke()},pe=async()=>{w.value=!0,S.value=1;try{await te()}finally{w.value=!1}},Re=()=>{O.value="",N.value="",Z.value="",S.value=1,te()},te=async()=>{var s,e;try{const a={page:S.value,page_size:$.value,task_timing_type:U.value};O.value&&(a.type=O.value),N.value&&(a.provider=N.value),Z.value&&(a.status=Z.value);let o=await Ct(a);V.value=o.results||o.data||[],H.value=o.count||o.total||0}catch(a){console.error("获取列表失败:",a),T.error("获取列表失败",{description:((e=(s=a.response)==null?void 0:s.data)==null?void 0:e.message)||a.message||"获取任务列表时发生错误"})}};be([S,U],()=>{te()});const _e=s=>{L.value&&!s.target.closest(".relative")&&(L.value=!1),C.value&&!s.target.closest(".prompt-dropdown")&&(C.value=!1)};return he(()=>{te(),Me(),document.addEventListener("click",_e)}),Oe(()=>{document.removeEventListener("click",_e)}),(s,e)=>(g(),W(Ee,null,{default:d(()=>[i(Fe,{pageTitle:n.value},null,8,["pageTitle"]),t("div",Mt,[i(He,null,{default:d(()=>[t("div",Ut,[e[27]||(e[27]=t("div",null,null,-1)),t("div",Tt,[i(ae,{size:"sm",class:"!text-blue-600 flex items-center gap-2 border border-blue-600 bg-white hover:bg-gray-50 dark:bg-gray-800 dark:border-blue-400 dark:text-blue-400 dark:hover:bg-gray-700",onClick:Ue},{default:d(()=>[...e[24]||(e[24]=[t("img",{src:dt,alt:""},null,-1),u(" 新建任务 ",-1),t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"})],-1)])]),_:1}),L.value?(g(),b("div",zt,[t("div",Rt,[t("button",{onClick:e[0]||(e[0]=a=>Te("once")),class:"w-full px-4 py-2 text-left text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center gap-2"},[...e[25]||(e[25]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})],-1),u(" 创建即时任务 ",-1)])]),t("button",{onClick:e[1]||(e[1]=a=>ze("timing")),class:"w-full px-4 py-2 text-left text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center gap-2"},[...e[26]||(e[26]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("circle",{cx:"12",cy:"12",r:"9","stroke-width":"2"}),t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6v6l4 2"}),t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 2v2M16 2v2"})],-1),u(" 创建定时任务 ",-1)])])])])):R("",!0)])]),t("div",Lt,[t("button",{class:fe(["px-4 py-2 text-sm font-medium transition-colors relative",U.value==="once"?"text-blue-600":"text-gray-500 hover:text-gray-700"]),onClick:e[2]||(e[2]=a=>U.value="once")},[U.value==="once"?(g(),b("div",Pt)):R("",!0),e[28]||(e[28]=t("svg",{class:"w-4 h-4 inline mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e[29]||(e[29]=u(" 即时任务列表 ",-1))],2),t("button",{class:fe(["px-4 py-2 text-sm font-medium transition-colors relative",U.value==="timing"?"text-blue-600":"text-gray-500 hover:text-gray-700"]),onClick:e[3]||(e[3]=a=>U.value="timing")},[U.value==="timing"?(g(),b("div",Ot)):R("",!0),e[30]||(e[30]=t("svg",{class:"w-4 h-4 inline mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("circle",{cx:"12",cy:"12",r:"9","stroke-width":"2"}),t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6v6l4 2"}),t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 2v2M16 2v2"})],-1)),e[31]||(e[31]=u(" 定时任务列表 ",-1))],2)]),t("div",qt,[t("div",Ft,[A(t("select",{"onUpdate:modelValue":e[4]||(e[4]=a=>O.value=a),onChange:pe,class:"w-48 h-10 px-4 rounded-lg border border-gray-300 bg-transparent text-sm text-gray-800 shadow-theme-xs focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:focus:border-brand-800"},[...e[32]||(e[32]=[t("option",{value:""},"请选择类型",-1),t("option",{value:"post"},"发帖",-1),t("option",{value:"reply_comment"},"回复评论",-1)])],544),[[X,O.value]]),A(t("select",{"onUpdate:modelValue":e[5]||(e[5]=a=>N.value=a),onChange:pe,class:"w-48 h-10 px-4 rounded-lg border border-gray-300 bg-transparent text-sm text-gray-800 shadow-theme-xs focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:focus:border-brand-800"},[...e[33]||(e[33]=[t("option",{value:""},"请选择平台",-1),t("option",{value:"twitter"},"Twitter",-1),t("option",{value:"facebook"},"Facebook",-1)])],544),[[X,N.value]]),A(t("select",{"onUpdate:modelValue":e[6]||(e[6]=a=>Z.value=a),onChange:pe,class:"w-48 h-10 px-4 rounded-lg border border-gray-300 bg-transparent text-sm text-gray-800 shadow-theme-xs focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:focus:border-brand-800"},[...e[34]||(e[34]=[t("option",{value:""},"请选择状态",-1),t("option",{value:"execting"},"执行中",-1),t("option",{value:"paused"},"已暂停",-1),t("option",{value:"completed"},"已完成",-1),t("option",{value:"part_success"},"部分成功",-1),t("option",{value:"part_failure"},"部分失败",-1)])],544),[[X,Z.value]]),i(ae,{size:"sm",onClick:pe,disabled:w.value},{default:d(()=>[w.value?(g(),b("span",Et,"搜索中...")):(g(),b("svg",Nt,[...e[35]||(e[35]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"},null,-1)])])),e[36]||(e[36]=u(" 搜索 ",-1))]),_:1},8,["disabled"]),i(ae,{size:"sm",variant:"outline",onClick:Re},{default:d(()=>[...e[37]||(e[37]=[u(" 重置 ",-1)])]),_:1})])]),i(c(Ne),{class:"[&_td]:py-3.5 [&_th]:py-3.5"},{default:d(()=>[i(c(Ge),null,{default:d(()=>[i(c(ye),null,{default:d(()=>[i(c(z),{class:"whitespace-nowrap w-[60px]"},{default:d(()=>[...e[38]||(e[38]=[u("序号",-1)])]),_:1}),i(c(z),{class:"whitespace-nowrap w-[80px]"},{default:d(()=>[...e[39]||(e[39]=[u("类型",-1)])]),_:1}),i(c(z),{class:"whitespace-nowrap w-[80px]"},{default:d(()=>[...e[40]||(e[40]=[u("平台",-1)])]),_:1}),i(c(z),{class:"whitespace-nowrap w-[80px]"},{default:d(()=>[...e[41]||(e[41]=[u("语言",-1)])]),_:1}),i(c(z),{class:"whitespace-nowrap w-[100px]"},{default:d(()=>[...e[42]||(e[42]=[u("提及",-1)])]),_:1}),i(c(z),{class:"whitespace-nowrap w-[100px]"},{default:d(()=>[...e[43]||(e[43]=[u("话题",-1)])]),_:1}),i(c(z),{class:"whitespace-nowrap w-[120px]"},{default:d(()=>[...e[44]||(e[44]=[u("机器人",-1)])]),_:1}),i(c(z),{class:"whitespace-nowrap w-[100px]"},{default:d(()=>[...e[45]||(e[45]=[u("推文信息",-1)])]),_:1}),i(c(z),{class:"whitespace-nowrap w-[120px]"},{default:d(()=>[...e[46]||(e[46]=[u("推文后缀",-1)])]),_:1}),i(c(z),{class:"whitespace-nowrap w-[100px]"},{default:d(()=>[...e[47]||(e[47]=[u("备注",-1)])]),_:1}),i(c(z),{class:"whitespace-nowrap w-[120px]"},{default:d(()=>[...e[48]||(e[48]=[u("创建时间",-1)])]),_:1}),i(c(z),{class:"whitespace-nowrap w-[120px]"},{default:d(()=>[...e[49]||(e[49]=[u("发布时间",-1)])]),_:1}),i(c(z),{class:"whitespace-nowrap w-[80px]"},{default:d(()=>[...e[50]||(e[50]=[u("状态",-1)])]),_:1}),i(c(z),{class:"whitespace-nowrap text-right sticky right-0 bg-background z-10 w-[160px]"},{default:d(()=>[...e[51]||(e[51]=[u("操作",-1)])]),_:1})]),_:1})]),_:1}),i(c(Qe),null,{default:d(()=>[V.value.length?(g(!0),b(se,{key:0},ie(V.value,(a,o)=>(g(),W(c(ye),{key:a.id},{default:d(()=>[i(c(D),{class:"whitespace-nowrap w-[60px]"},{default:d(()=>[u(h(o+1),1)]),_:2},1024),i(c(D),{class:"whitespace-nowrap w-[80px]"},{default:d(()=>[u(h(a.type=="post"?"发帖":"回复评论"),1)]),_:2},1024),i(c(D),{class:"whitespace-nowrap w-[80px]"},{default:d(()=>[u(h(a.provider||"-"),1)]),_:2},1024),i(c(D),{class:"whitespace-nowrap w-[80px]"},{default:d(()=>[u(h(ne[a.language]||"-"),1)]),_:2},1024),i(c(D),{class:"w-[100px] max-w-[80px] truncate",title:a.mentions},{default:d(()=>[u(h(a.mentions||"-"),1)]),_:2},1032,["title"]),i(c(D),{class:"w-[100px] max-w-[80px] truncate",title:a.tags},{default:d(()=>[u(h(a.tags.map(m=>m).join(",")||"-"),1)]),_:2},1032,["title"]),i(c(D),{class:"w-[120px] max-w-[100px] truncate",title:a.selected_accounts.map(m=>m.name).join(",")},{default:d(()=>[u(h(a.selected_accounts.map(m=>m.name).join(",")||"-"),1)]),_:2},1032,["title"]),i(c(D),{class:"w-[100px] max-w-[80px] truncate",title:a.prompt},{default:d(()=>[u(h(a.prompt_name||"-"),1)]),_:2},1032,["title"]),i(c(D),{class:"w-[120px] max-w-[100px] truncate",title:a.last_text},{default:d(()=>[u(h(a.last_text||"-"),1)]),_:2},1032,["title"]),i(c(D),{class:"whitespace-nowrap w-[100px]"},{default:d(()=>[t("div",{class:"max-w-[80px] truncate",title:a.task_remark},h(a.task_remark||"无"),9,Gt)]),_:2},1024),i(c(D),{class:"whitespace-nowrap w-[120px]"},{default:d(()=>[u(h(c(we)(a.created_at)),1)]),_:2},1024),i(c(D),{class:"whitespace-nowrap w-[120px]"},{default:d(()=>[u(h(c(we)(a.created_at)),1)]),_:2},1024),i(c(D),{class:"whitespace-nowrap w-[80px]"},{default:d(()=>[u(h(J[a.exec_status]||"--"),1)]),_:2},1024),i(c(D),{class:"text-right whitespace-nowrap sticky right-0 bg-background z-10 w-[160px]"},{default:d(()=>[t("div",Qt,[a.exec_status=="execting"||a.exec_status=="paused"?(g(),W(ae,{key:0,size:"sm",variant:"outline",onClick:m=>Ce(a)},{default:d(()=>[u(h(a.exec_status=="execting"?"暂停任务":"继续任务"),1)]),_:2},1032,["onClick"])):R("",!0),i(ae,{size:"sm",variant:"outline",onClick:m=>je(a),class:"!text-blue-600 hover:!text-blue-700"},{default:d(()=>[...e[52]||(e[52]=[u("编辑任务",-1)])]),_:1},8,["onClick"]),t("button",{class:"inline-flex items-center justify-center font-medium gap-2 rounded-lg transition px-4 py-3 text-sm bg-white text-gray-700 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 dark:bg-gray-800 dark:text-gray-400 dark:ring-gray-700 dark:hover:bg-white/[0.03] dark:hover:text-gray-300 text-rose-600 ring-rose-200 hover:bg-rose-50 dark:text-rose-400 dark:ring-rose-500/30",onClick:m=>Ie(a,m)}," 删除任务 ",8,Yt)])]),_:2},1024)]),_:2},1024))),128)):(g(),W(c(ye),{key:1},{default:d(()=>[i(c(D),{colspan:15,class:"py-16 text-center text-gray-400 dark:text-white/40"},{default:d(()=>[...e[53]||(e[53]=[u("暂无数据",-1)])]),_:1})]),_:1}))]),_:1})]),_:1}),H.value>0?(g(),b("div",Wt,[i(c(Ye),{page:S.value,"onUpdate:page":e[7]||(e[7]=a=>S.value=a),total:H.value,"items-per-page":$.value,"sibling-count":1,"show-edges":""},{default:d(()=>[i(c(We),null,{default:d(({items:a})=>[i(c(Xe)),(g(!0),b(se,null,ie(a,(o,m)=>(g(),b(se,{key:m},[o.type==="page"?(g(),W(c(et),{key:0,value:o.value,"is-active":o.value===S.value},{default:d(()=>[u(h(o.value),1)]),_:2},1032,["value","is-active"])):(g(),W(c(tt),{key:1,index:m},null,8,["index"]))],64))),128)),i(c(Je))]),_:1})]),_:1},8,["page","total","items-per-page"])])):R("",!0)]),_:1}),ee.value?(g(),W(at,{key:0,fullScreenBackdrop:!0,onClose:ve},{body:d(()=>{var a;return[t("div",Xt,[e[74]||(e[74]=t("div",{style:{height:"24vh"}},null,-1)),t("h3",Jt,h(P.value?"编辑任务":"新增任务"),1),t("form",{onSubmit:qe(De,["prevent"]),class:"space-y-4"},[t("div",Ht,[t("div",null,[e[55]||(e[55]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[u("类型"),t("span",{class:"text-error-500"},"*")],-1)),A(t("select",{"onUpdate:modelValue":e[8]||(e[8]=o=>l.value.type=o),class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},[...e[54]||(e[54]=[t("option",{value:""},"请选择类型",-1),t("option",{value:"post"},"发帖",-1),t("option",{value:"reply_comment"},"回复评论",-1)])],512),[[X,l.value.type]])]),t("div",null,[e[57]||(e[57]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[u("平台"),t("span",{class:"text-error-500"},"*")],-1)),A(t("select",{"onUpdate:modelValue":e[9]||(e[9]=o=>l.value.provider=o),onChange:f,class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},[...e[56]||(e[56]=[t("option",{value:""},"请选择平台",-1),t("option",{value:"twitter"},"Twitter",-1),t("option",{value:"facebook"},"Facebook",-1)])],544),[[X,l.value.provider]])]),t("div",null,[e[59]||(e[59]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[u("语言"),t("span",{class:"text-error-500"},"*")],-1)),A(t("select",{"onUpdate:modelValue":e[10]||(e[10]=o=>l.value.language=o),class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},[...e[58]||(e[58]=[t("option",{value:""},"请选择语言",-1),t("option",{value:"zh"},"中文",-1),t("option",{value:"en"},"英文",-1),t("option",{value:"ja"},"日文",-1),t("option",{value:"ko"},"韩文",-1),t("option",{value:"es"},"西班牙文",-1),t("option",{value:"fr"},"法文",-1),t("option",{value:"de"},"德文",-1)])],512),[[X,l.value.language]])])]),t("div",null,[e[61]||(e[61]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[u("推文信息"),t("span",{class:"text-error-500"},"*")],-1)),t("div",Zt,[A(t("input",{"onUpdate:modelValue":e[11]||(e[11]=o=>l.value.prompt_display=o),type:"text",placeholder:"请输入推文信息或选择模板",onFocus:e[12]||(e[12]=o=>C.value=!0),onBlur:_,onInput:x,class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,544),[[F,l.value.prompt_display]]),t("div",ea,[(g(),b("svg",{class:fe(["w-4 h-4 text-gray-400 transition-transform duration-200",{"rotate-180":C.value}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...e[60]||(e[60]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)])],2))]),C.value&&Q.value.length>0?(g(),b("div",ta,[(g(!0),b(se,null,ie(Q.value,o=>(g(),b("div",{key:o.id,onMousedown:m=>I(o),class:"px-4 py-2 text-sm cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center justify-between"},[t("div",null,[t("div",la,h(o.name),1)])],40,aa))),128))])):R("",!0)])]),t("div",null,[e[62]||(e[62]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[u("提及账号"),t("span",{class:"text-error-500"},"*")],-1)),A(t("input",{"onUpdate:modelValue":e[13]||(e[13]=o=>l.value.mentions=o),type:"text",placeholder:"多个提及账号使用逗号隔开 如：user1，user2",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[F,l.value.mentions]])]),t("div",null,[e[63]||(e[63]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[u("话题"),t("span",{class:"text-error-500"},"*")],-1)),A(t("input",{"onUpdate:modelValue":e[14]||(e[14]=o=>l.value.tags=o),type:"text",placeholder:"多个话题使用逗号隔开 如：品牌牛奶，优质水管",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[F,l.value.tags]])]),t("div",null,[e[64]||(e[64]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[u("机器人"),t("span",{class:"text-error-500"},"*")],-1)),(g(),W($t,{modelValue:l.value.selected_accounts,"onUpdate:modelValue":e[15]||(e[15]=o=>l.value.selected_accounts=o),fetchApi:Be,labelKey:"name",valueKey:"id",onSelectionChange:v,key:`robot-selector-${P.value?q.value:"new"}-${r.value}`},null,8,["modelValue"]))]),l.value.type==="reply_comment"&&l.value.provider==="twitter"?(g(),b("div",oa,[e[65]||(e[65]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},"Twitter回复ID",-1)),A(t("input",{"onUpdate:modelValue":e[16]||(e[16]=o=>l.value.twitter_reply_to_tweet_id=o),type:"text",placeholder:"请输入Twitter回复ID",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[F,l.value.twitter_reply_to_tweet_id]])])):R("",!0),l.value.type==="post"&&l.value.provider==="facebook"?(g(),b("div",ra,[e[66]||(e[66]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},"Facebook页面ID",-1)),A(t("input",{"onUpdate:modelValue":e[17]||(e[17]=o=>l.value.facebook_page_id=o),type:"text",placeholder:"请输入Facebook页面ID",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[F,l.value.facebook_page_id]])])):R("",!0),l.value.type==="reply_comment"&&l.value.provider==="facebook"?(g(),b("div",sa,[e[67]||(e[67]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},"Facebook评论ID",-1)),A(t("input",{"onUpdate:modelValue":e[18]||(e[18]=o=>l.value.facebook_comment_id=o),type:"text",placeholder:"请输入Facebook评论ID",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[F,l.value.facebook_comment_id]])])):R("",!0),M.value==="timing"?(g(),b("div",na,[e[70]||(e[70]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[u("执行频率"),t("span",{class:"text-error-500"},"*")],-1)),t("div",da,[A(t("select",{"onUpdate:modelValue":e[19]||(e[19]=o=>l.value.exec_type=o),onChange:ge,class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},[...e[68]||(e[68]=[t("option",{value:""},"请选择频率类型",-1),t("option",{value:"fixed"},"指定日期",-1),t("option",{value:"daily"},"每天",-1),t("option",{value:"weekly"},"每周",-1),t("option",{value:"monthly"},"每月",-1)])],544),[[X,l.value.exec_type]]),l.value.exec_type==="fixed"?A((g(),b("input",{key:0,"onUpdate:modelValue":e[20]||(e[20]=o=>l.value.exec_datetime=o),type:"datetime-local",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512)),[[F,l.value.exec_datetime]]):A((g(),b("select",{key:1,"onUpdate:modelValue":e[21]||(e[21]=o=>l.value.exec_nums=o),class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800",disabled:!l.value.exec_type},[e[69]||(e[69]=t("option",{value:""},"请选择执行次数",-1)),(g(!0),b(se,null,ie(K.value,o=>(g(),b("option",{key:o.value,value:o.value},h(o.label),9,ia))),128))],8,ua)),[[X,l.value.exec_nums]])])])):R("",!0),t("div",null,[e[71]||(e[71]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[u("推文后缀"),t("span",{class:"text-error-500"})],-1)),t("div",ca,[A(t("textarea",{"onUpdate:modelValue":e[22]||(e[22]=o=>l.value.last_text=o),placeholder:"请输入推文后缀，最多300字",maxlength:"300",rows:"4",class:"dark:bg-dark-900 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800 resize-none"},null,512),[[F,l.value.last_text]]),t("div",pa,h(((a=l.value.last_text)==null?void 0:a.length)||0)+"/300 ",1)])]),t("div",null,[e[72]||(e[72]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},"备注",-1)),A(t("textarea",{"onUpdate:modelValue":e[23]||(e[23]=o=>l.value.task_remark=o),placeholder:"请输入备注信息（可选）",rows:"3",class:"dark:bg-dark-900 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800 resize-none"},null,512),[[F,l.value.task_remark]])]),t("div",ga,[i(ae,{type:"button",variant:"outline",onClick:ve,disabled:E.value},{default:d(()=>[...e[73]||(e[73]=[u("取消",-1)])]),_:1},8,["disabled"]),i(ae,{type:"submit",disabled:E.value},{default:d(()=>[E.value?(g(),b("span",va,"处理中...")):R("",!0),u(" "+h(P.value?"更新":"保存"),1)]),_:1},8,["disabled"])])],32)])]}),_:1})):R("",!0),i(Ze,{isOpen:Y.value,title:"删除",description:"确定要删除吗？此操作不可撤销。",isLoading:le.value,triggerRect:de.value,onClose:xe,onConfirm:Ke},null,8,["isOpen","isLoading","triggerRect"]),re.value?(g(),b("div",ma,[...e[75]||(e[75]=[t("div",{class:"flex flex-col items-center gap-3"},[t("div",{class:"animate-spin rounded-full h-12 w-12 border-4 border-gray-200 border-t-blue-600"}),t("span",{class:"text-blue-600 dark:text-blue-400 font-medium text-sm"},"任务正在执行，请稍后...")],-1)])])):R("",!0)])]),_:1}))}};export{Sa as default};
