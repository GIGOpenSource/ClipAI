import{r as y,q as W,w as ge,o as ce,m as Ye,c as x,a as n,b as u,t as p,d as c,e as a,g as m,f as g,h as d,u as i,F as w,i as k,j as f,n as Z,k as fe,l as h,p as A,v as pe}from"./index-C_WH1cgn.js";import{_ as Ge,a as He}from"./AdminLayout-aCla68Vk.js";import{_ as Qe,f as ee}from"./Primitive-rbbPGzXt.js";import{_ as M}from"./Button.vue_vue_type_script_setup_true_lang-C7mE4dwR.js";import{_ as ye,a as We}from"./DeleteConfirmDialog-Dv8WvOx6.js";import{_ as Ze,a as er,b as re,c as _,d as rr,e as b,f as tr,g as ar,h as or,i as sr,j as lr,k as nr}from"./PaginationPrevious.vue_vue_type_script_setup_true_lang-BaJMHx_t.js";import{g as be,p as dr,a as ir,d as ur}from"./http-BKvr1fmS.js";import{g as gr}from"./keywrods-CrnNJUFp.js";import{g as cr}from"./prompts-BB-itMyd.js";import{a as fr}from"./index-D6Vgu1Lv.js";import{g as pr}from"./tag-DwiZTqes.js";import{g as yr}from"./aiCofig-B7RPIK1X.js";import{g as vr,r as br}from"./platform-CK4kvyLZ.js";import{a as _r}from"./follow-CyFdqDcA.js";import{T as te,P as ve}from"./platforms-DK9rrH31.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const mr=$=>be("/tasks/scheduled/",{params:$}),wr=$=>be(`/tasks/scheduled/${$}/`),kr=$=>ir("/tasks/scheduled/",$),xr=($,C)=>dr(`/tasks/scheduled/${$}/`,C),hr=$=>ur(`/tasks/scheduled/${$}/`),Ar={class:"space-y-5 sm:space-y-6"},Tr={class:"mb-4 flex items-center justify-between"},$r={class:"flex items-center justify-end gap-2"},Cr=["onClick"],Sr={key:0,class:"mt-4"},Fr={class:"relative z-10 w-full max-w-xl rounded-xl bg-white p-6 shadow-lg dark:bg-gray-900"},Or={class:"mb-4 text-lg font-semibold"},Ur={key:0},Vr={key:0},Mr=["value"],jr={class:"grid grid-cols-1 gap-4 sm:grid-cols-2 mt-4"},Nr=["disabled"],Dr=["value"],Pr={key:1},Lr={key:0},zr=["value"],Br={class:"grid grid-cols-1 gap-4 sm:grid-cols-2 mt-4"},Rr=["value"],Ir=["disabled"],Er=["value"],Kr={key:2,class:"grid grid-cols-1 gap-4 sm:grid-cols-2"},qr={class:"sm:col-span-2"},Jr=["value"],Xr={key:3,class:"grid grid-cols-1 gap-4 sm:grid-cols-2"},Yr=["value"],Gr=["value"],Hr=["value"],Qr=["value"],Wr={class:"sm:col-span-2"},Zr={class:"sm:col-span-2"},et={class:"relative tag-dropdown"},rt={key:0,class:"text-gray-400"},tt={key:1,class:"flex flex-wrap gap-1"},at={class:"px-1"},ot=["onClick"],st={class:"absolute right-3 top-1/2 transform -translate-y-1/2 pointer-events-none"},lt={key:0,class:"absolute z-50 w-full mt-1 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded-lg shadow-lg max-h-60 overflow-y-auto"},nt={key:0,class:"px-4 py-2 text-sm text-gray-500 dark:text-gray-400"},dt={key:1},it=["onClick"],ut={key:0,class:"text-blue-500"},gt={class:"mt-1 text-xs text-gray-500"},ct={class:"flex justify-end gap-3 pt-2"},ft={class:"relative z-10 w-full max-w-4xl rounded-xl bg-white p-6 shadow-lg dark:bg-gray-900"},pt={key:0,class:"flex items-center justify-center py-8"},yt={key:1,class:"space-y-4"},vt={class:"flex items-center justify-between mb-2"},bt={class:"text-sm font-medium text-gray-700 dark:text-gray-300"},_t={class:"text-sm text-gray-600 dark:text-gray-400 space-y-1"},mt={key:0},wt={key:1},kt={key:2},xt={key:2,class:"text-center py-8 text-gray-500 dark:text-gray-400"},ht={class:"flex justify-end gap-3 pt-4"},Bt={__name:"index",setup($){const C=localStorage.getItem("role"),ae=JSON.parse(localStorage.getItem("profile")),_e=y("任务列表"),S=y([]),P=y([]),E=y([]),K=y([]),q=y([]),L=y([]),F=y([]),O=y(!1),T=y(""),oe=y(!1),se=y(!1),me=y(!1),J=y(!1),z=y([]),j=y(1),le=y(20),X=y(0),B=y(!1),N=y(null),o=y({owner:C=="user"?ae.id:"",provider:"",type:"",keyword:"",prompt:"",ai_config_id:"",social_config_id:"",recurrence_type:"daily",day_of_month:1,time_of_day:"09:00",enabled:!0,tags:[],follow_target_ids:[],interval_value:1}),Y=y(!1),R=y(!1),I=y(null),ne=y({top:0,left:0,width:0,height:0}),U=W(()=>N.value!==null),V=W(()=>S.value.some(t=>t.type==="follow"));function we(){N.value=null,B.value=!0}async function ke(t){var r,e;N.value=t.id;try{const s=await wr(String(t.id));if(o.value={owner:s.owner??t.owner,provider:s.provider??t.provider,type:s.type??t.type,keyword:s.keyword_config_id??t.keyword_config_id,prompt:s.prompt_config_id??t.prompt_config_id,ai_config_id:s.ai_config_id??t.ai_config_id??"",social_config_id:s.social_config_id??t.social_config_id??"",recurrence_type:s.recurrence_type??t.recurrence_type,day_of_month:s.day_of_month??t.day_of_month,time_of_day:s.time_of_day??t.time_of_day,enabled:typeof s.enabled=="boolean"?s.enabled:t.enabled,tags:Array.isArray(s.tags)?s.tags:Array.isArray(t.tags)?t.tags:[],follow_target_ids:Array.isArray(s.follow_target_ids)?s.follow_target_ids:Array.isArray(t.follow_target_ids)?t.follow_target_ids:[],interval_value:s.interval_value??t.interval_value??1},s.follow_targets&&Array.isArray(s.follow_targets)&&s.follow_targets.length>0){const l=s.follow_targets.map(v=>v.id).filter(v=>v);o.value.follow_target_ids=l,T.value=l[0]||""}else o.value.follow_target_ids&&o.value.follow_target_ids.length>0?T.value=o.value.follow_target_ids[0]:T.value=""}catch(s){if(console.error("Failed to fetch task detail:",s),p.error("获取任务详情失败",{description:((e=(r=s.response)==null?void 0:r.data)==null?void 0:e.message)||s.message||"获取任务详情时发生错误"}),o.value={owner:t.owner,provider:t.provider,type:t.type,keyword:t.keyword_config_id,prompt:t.prompt_config_id,ai_config_id:t.ai_config_id??"",social_config_id:t.social_config_id??"",recurrence_type:t.recurrence_type,day_of_month:t.day_of_month,time_of_day:t.time_of_day,enabled:t.enabled,tags:Array.isArray(t.tags)?t.tags:[],follow_target_ids:Array.isArray(t.follow_target_ids)?t.follow_target_ids:[],interval_value:t.interval_value??1},t.follow_targets&&Array.isArray(t.follow_targets)&&t.follow_targets.length>0){const l=t.follow_targets.map(v=>v.id).filter(v=>v);o.value.follow_target_ids=l,T.value=l[0]||""}else o.value.follow_target_ids&&o.value.follow_target_ids.length>0?T.value=o.value.follow_target_ids[0]:T.value=""}B.value=!0}function G(){B.value=!1,N.value=null,o.value={owner:C=="user"?ae.id:"",provider:"",type:"",keyword:"",prompt:"",ai_config_id:"",social_config_id:"",recurrence_type:"daily",day_of_month:1,time_of_day:"09:00",enabled:!0,tags:[],follow_target_ids:[],interval_value:1},T.value=""}async function xe(){var t,r;if(o.value.tags.length>5){p.error("话题选择数量超限",{description:"最多只能选择5个话题"});return}if(o.value.type==="follow"){if(!o.value.owner){p.error("目标用户不能为空",{description:"请选择目标用户"});return}if(!o.value.type){p.error("类型不能为空",{description:"请选择类型"});return}if(!o.value.follow_target_ids||o.value.follow_target_ids.length===0){p.error("关注列表不能为空",{description:"请选择关注列表"});return}}else{if(!o.value.owner){p.error("目标用户不能为空",{description:"请选择目标用户"});return}if(!o.value.provider){p.error("平台不能为空",{description:"请选择平台"});return}if(!o.value.type){p.error("类型不能为空",{description:"请选择类型"});return}if(!o.value.keyword){p.error("关键词不能为空",{description:"请选择关键词"});return}if(!o.value.prompt){p.error("提示词不能为空",{description:"请选择提示词"});return}if(!o.value.ai_config_id){p.error("大模型不能为空",{description:"请选择大模型"});return}if(!o.value.social_config_id){p.error("平台账号不能为空",{description:"请选择平台账号"});return}if(!o.value.day_of_month){p.error("循环周期不能为空",{description:"请输入循环周期"});return}if(!o.value.time_of_day){p.error("执行时间不能为空",{description:"请选择执行时间"});return}}try{const e={type:o.value.type,enabled:o.value.enabled};o.value.type==="follow"?(e.owner=o.value.owner,e.provider=o.value.provider,e.follow_target_ids=o.value.follow_target_ids,e.interval_value=o.value.interval_value):(e.owner=o.value.owner,e.provider=o.value.provider,e.keyword_config_id=o.value.keyword,e.prompt_config_id=o.value.prompt,e.ai_config_id=o.value.ai_config_id,e.social_config_id=o.value.social_config_id,e.recurrence_type=o.value.recurrence_type,e.day_of_month=o.value.day_of_month,e.time_of_day=o.value.time_of_day,e.tags=o.value.tags),U.value?(await xr(String(N.value),e),p.success("任务更新成功")):(await kr(e),p.success("任务创建成功")),await D(),G()}catch(e){console.error("Failed to save task:",e),p.error(U.value?"更新失败":"创建失败",{description:((r=(t=e.response)==null?void 0:t.data)==null?void 0:r.message)||e.message||(U.value?"更新任务时发生错误":"创建任务时发生错误")})}}async function he(t){var r,e;try{J.value=!0,await br(String(t.id),{}),p.success("任务执行成功",{description:"任务已开始执行"}),D()}catch(s){console.error("Failed to run task:",s),p.error("执行失败",{description:((e=(r=s.response)==null?void 0:r.data)==null?void 0:e.message)||s.message||"执行任务时发生错误"})}finally{J.value=!1}}function de(){se.value=!1,z.value=[]}function Ae(t){return{pending:"等待中",running:"执行中",completed:"已完成",failed:"执行失败",cancelled:"已取消"}[t]||t||"未知状态"}function Te(t){return{pending:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200",running:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200",completed:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",failed:"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200",cancelled:"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200"}[t]||"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200"}function $e(t,r){I.value=t;const e=r.target.getBoundingClientRect();ne.value={top:e.top,left:e.left,width:e.width,height:e.height,bottom:e.bottom},Y.value=!0}async function Ce(){var t,r;if(I.value){R.value=!0;try{await hr(String(I.value.id)),p.success("任务删除成功"),await D(),ie()}catch(e){console.error("Failed to delete task:",e),p.error("删除失败",{description:((r=(t=e.response)==null?void 0:t.data)==null?void 0:r.message)||e.message||"删除任务时发生错误"})}finally{R.value=!1}}}function ie(){Y.value=!1,I.value=null,R.value=!1}function Se(t){return{daily:"日",weekly:"周",monthly:"月"}[t]||t}function Fe(t){const r=te.find(e=>e.value===t);return r?r.label:t}function Oe(t){const r=ve.find(e=>e.value===t);return r?r.label:t}function Ue(t){if(!t)return"--";const r=L.value.find(e=>e.id===t);return r?r.name:`账号${t}`}function Ve(t){if(!t||!Array.isArray(t)||t.length===0)return"--";const r=t.filter(s=>s&&s.id);return r.length===0?"--":r.map(s=>{const l=E.value.find(v=>v.id===s.id);return l?l.name:`账号${s.id}`}).join(", ")}function Me(t){return!t||!Array.isArray(t)||t.length===0?"--":t.map(e=>{const s=F.value.find(l=>l.id===e);return s?s.name:`话题${e}`}).join(", ")}function je(t){const r=F.value.find(e=>e.id===t);return r?r.name:`话题${t}`}function Ne(t){const r=o.value.tags.indexOf(t);r>-1&&o.value.tags.splice(r,1)}function De(){O.value=!O.value}function Pe(t){const r=o.value.tags.indexOf(t);r>-1?o.value.tags.splice(r,1):o.value.tags.length<5?o.value.tags.push(t):p.error("话题选择数量超限",{description:"最多只能选择5个话题"})}function Le(){T.value?o.value.follow_target_ids=[T.value]:o.value.follow_target_ids=[]}const H=y([]),Q=y([]),ze=W(()=>Q.value);async function D(){var t,r;try{const e=await mr({page:j.value,page_size:le.value}),s=e&&e.results?e.results:e;S.value=Array.isArray(s)?s.map(l=>({id:l.id,owner:l.owner,provider:l.provider,type:l.type,keyword_config_id:l.keyword_config_id,keyword_config:l.keyword_config,prompt_config_id:l.prompt_config_id,prompt_config:l.prompt_config,ai_config_id:l.ai_config_id,ai_config:l.ai_config,social_config_id:l.social_config_id,recurrence_type:l.recurrence_type,day_of_month:l.day_of_month,time_of_day:l.time_of_day,enabled:l.enabled,created_at:l.created_at,tags:l.tags,target_account:l.target_account,ai_accounts:l.ai_accounts,follow_result:l.follow_result,follow_target_ids:l.follow_target_ids,follow_targets:l.follow_targets})):[],console.log(S.value,"tasks.value"),X.value=e.count||0}catch(e){console.error("Failed to fetch tasks:",e),p.error("获取任务列表失败",{description:((r=(t=e.response)==null?void 0:t.data)==null?void 0:r.message)||e.message||"获取任务列表时发生错误"}),S.value=[]}}async function Be(){var t,r;if(C!="user")try{const e=await fr({}),s=e&&e.results?e.results:e;P.value=Array.isArray(s)?s.map(l=>({id:l.id??l.pk??l.uuid,name:l.username||l.name||l.email||`用户${l.id}`})):[]}catch(e){console.error("Failed to fetch users:",e),p.error("获取用户列表失败",{description:((r=(t=e.response)==null?void 0:t.data)==null?void 0:r.message)||e.message||"获取用户列表时发生错误"}),P.value=[]}}async function Re(){var t,r;try{const e=await gr(),s=e&&e.results?e.results:e;H.value=Array.isArray(s)?s.map(l=>({id:l.id,name:l.name,keyword:l.include_keywords})).filter(Boolean):[]}catch(e){console.error("Failed to fetch keywords:",e),p.error("获取关键词列表失败",{description:((r=(t=e.response)==null?void 0:t.data)==null?void 0:r.message)||e.message||"获取关键词列表时发生错误"}),H.value=[]}}async function Ie(){var t,r;try{const e=await cr(),s=e&&e.results?e.results:e;Q.value=Array.isArray(s)?s.map(l=>({id:l.id,name:l.name,content:l.content})):[]}catch(e){console.error("Failed to fetch prompts:",e),p.error("获取提示词列表失败",{description:((r=(t=e.response)==null?void 0:t.data)==null?void 0:r.message)||e.message||"获取提示词列表时发生错误"}),Q.value=[]}}async function Ee(){var t,r;try{E.value=[{id:"1",name:"AI账号1"},{id:"2",name:"AI账号2"},{id:"3",name:"AI账号3"}]}catch(e){console.error("Failed to fetch AI accounts:",e),p.error("获取AI账号列表失败",{description:((r=(t=e.response)==null?void 0:t.data)==null?void 0:r.message)||e.message||"获取AI账号列表时发生错误"}),E.value=[]}}async function Ke(){var t,r;try{const e=await pr({}),s=e&&e.results?e.results:e;F.value=Array.isArray(s)?s.map(l=>({id:l.id,name:l.name})):[]}catch(e){console.error("Failed to fetch tags:",e),p.error("获取话题列表失败",{description:((r=(t=e.response)==null?void 0:t.data)==null?void 0:r.message)||e.message||"获取话题列表时发生错误"}),F.value=[]}}async function qe(){try{const t=await _r({});K.value=t.results||[]}catch(t){console.error("获取关注列表失败:",t),K.value=[]}}async function Je(){var t,r;try{const e=await yr({search:"",page:1}),s=e&&e.results?e.results:e;q.value=Array.isArray(s)?s.map(l=>({id:l.id,name:l.name})):[]}catch(e){console.error("Failed to fetch models:",e),p.error("获取大模型列表失败",{description:((r=(t=e.response)==null?void 0:t.data)==null?void 0:r.message)||e.message||"获取大模型列表时发生错误"}),q.value=[]}}async function Xe(){var t,r;try{const e=await vr({}),s=e&&e.results?e.results:e;L.value=Array.isArray(s)?s.map(l=>({id:l.id,name:l.external_username||l.username||`账号${l.id}`})):[]}catch(e){console.error("Failed to fetch platform accounts:",e),p.error("获取平台账号列表失败",{description:((r=(t=e.response)==null?void 0:t.data)==null?void 0:r.message)||e.message||"获取平台账号列表时发生错误"}),L.value=[]}}ge(j,()=>{D()}),ge(()=>o.value.type,t=>{t==="follow"&&(o.value.provider="twitter")});function ue(t){O.value&&!t.target.closest(".tag-dropdown")&&(O.value=!1),oe.value&&!t.target.closest(".ai-account-dropdown")&&(oe.value=!1)}return ce(()=>{document.addEventListener("click",ue)}),Ye(()=>{document.removeEventListener("click",ue)}),ce(async()=>{await Promise.all([D(),Be(),Re(),Ie(),Ee(),qe(),Ke(),Je(),Xe()])}),(t,r)=>(n(),x(Ge,null,{default:u(()=>[c(He,{pageTitle:_e.value},null,8,["pageTitle"]),a("div",Ar,[c(Qe,null,{default:u(()=>[a("div",Tr,[r[16]||(r[16]=a("div",null,null,-1)),c(M,{size:"sm",onClick:we},{default:u(()=>[...r[15]||(r[15]=[d("新增",-1)])]),_:1})]),c(i(Ze),{class:"[&_td]:py-3.5 [&_th]:py-3.5"},{default:u(()=>[c(i(er),null,{default:u(()=>[c(i(re),null,{default:u(()=>[c(i(_),{class:"whitespace-nowrap"},{default:u(()=>[...r[17]||(r[17]=[d("序号",-1)])]),_:1}),c(i(_),{class:"whitespace-nowrap"},{default:u(()=>[...r[18]||(r[18]=[d("平台名称",-1)])]),_:1}),c(i(_),{class:"whitespace-nowrap"},{default:u(()=>[...r[19]||(r[19]=[d("关注账户",-1)])]),_:1}),c(i(_),{class:"whitespace-nowrap"},{default:u(()=>[...r[20]||(r[20]=[d("触发关键词",-1)])]),_:1}),c(i(_),{class:"whitespace-nowrap"},{default:u(()=>[...r[21]||(r[21]=[d("提示词",-1)])]),_:1}),c(i(_),{class:"whitespace-nowrap"},{default:u(()=>[...r[22]||(r[22]=[d("大模型",-1)])]),_:1}),c(i(_),{class:"whitespace-nowrap"},{default:u(()=>[...r[23]||(r[23]=[d("平台账户",-1)])]),_:1}),c(i(_),{class:"whitespace-nowrap"},{default:u(()=>[...r[24]||(r[24]=[d("任务类型",-1)])]),_:1}),c(i(_),{class:"whitespace-nowrap"},{default:u(()=>[...r[25]||(r[25]=[d("状态",-1)])]),_:1}),c(i(_),{class:"whitespace-nowrap"},{default:u(()=>[...r[26]||(r[26]=[d("循环周期",-1)])]),_:1}),c(i(_),{class:"whitespace-nowrap"},{default:u(()=>[...r[27]||(r[27]=[d("循环类型",-1)])]),_:1}),c(i(_),{class:"whitespace-nowrap"},{default:u(()=>[...r[28]||(r[28]=[d("执行时间",-1)])]),_:1}),c(i(_),{class:"whitespace-nowrap"},{default:u(()=>[...r[29]||(r[29]=[d("话题",-1)])]),_:1}),V.value?(n(),x(i(_),{key:0,class:"whitespace-nowrap"},{default:u(()=>[...r[30]||(r[30]=[d("对方账号",-1)])]),_:1})):m("",!0),V.value?(n(),x(i(_),{key:1,class:"whitespace-nowrap"},{default:u(()=>[...r[31]||(r[31]=[d("AI账号",-1)])]),_:1})):m("",!0),V.value?(n(),x(i(_),{key:2,class:"whitespace-nowrap"},{default:u(()=>[...r[32]||(r[32]=[d("执行结果",-1)])]),_:1})):m("",!0),c(i(_),{class:"whitespace-nowrap"},{default:u(()=>[...r[33]||(r[33]=[d("创建时间",-1)])]),_:1}),c(i(_),{class:"whitespace-nowrap text-right"},{default:u(()=>[...r[34]||(r[34]=[d("操作",-1)])]),_:1})]),_:1})]),_:1}),c(i(rr),null,{default:u(()=>[S.value.length?(n(!0),g(w,{key:0},k(S.value,(e,s)=>(n(),x(i(re),{key:e.id},{default:u(()=>{var l;return[c(i(b),{class:"whitespace-nowrap"},{default:u(()=>[d(f(s+1),1)]),_:2},1024),c(i(b),{class:"whitespace-nowrap"},{default:u(()=>[d(f(Oe(e.provider)),1)]),_:2},1024),c(i(b),{class:"whitespace-nowrap"},{default:u(()=>[d(f(e.follow_targets&&e.follow_targets.length>0?e.follow_targets[0].external_user_id:"--"),1)]),_:2},1024),c(i(b),{class:"whitespace-nowrap"},{default:u(()=>{var v;return[d(f(((v=e.keyword_config)==null?void 0:v.name)||"--"),1)]}),_:2},1024),c(i(b),{class:"max-w-[380px] truncate",title:(l=e.prompt_config)==null?void 0:l.name},{default:u(()=>{var v;return[d(f(((v=e.prompt_config)==null?void 0:v.name)||"--"),1)]}),_:2},1032,["title"]),c(i(b),{class:"whitespace-nowrap"},{default:u(()=>{var v;return[d(f(((v=e.ai_config)==null?void 0:v.name)||"--"),1)]}),_:2},1024),c(i(b),{class:"whitespace-nowrap"},{default:u(()=>[d(f(Ue(e.social_config_id)),1)]),_:2},1024),c(i(b),{class:"whitespace-nowrap"},{default:u(()=>[d(f(Fe(e.type)),1)]),_:2},1024),c(i(b),{class:"whitespace-nowrap"},{default:u(()=>[a("span",{class:Z(["inline-flex items-center rounded-full px-2 py-0.5 text-xs font-medium ring-1 ring-inset",e.enabled?"bg-emerald-50 text-emerald-600 ring-emerald-200 dark:bg-emerald-500/10 dark:text-emerald-400 dark:ring-emerald-500/30":"bg-rose-50 text-rose-600 ring-rose-200 dark:bg-rose-500/10 dark:text-rose-400 dark:ring-rose-500/30"])},f(e.enabled?"启用":"停用"),3)]),_:2},1024),c(i(b),{class:"whitespace-nowrap"},{default:u(()=>[d(f(e.day_of_month),1)]),_:2},1024),c(i(b),{class:"whitespace-nowrap"},{default:u(()=>[d(f(Se(e.recurrence_type)),1)]),_:2},1024),c(i(b),{class:"whitespace-nowrap"},{default:u(()=>[d(f(e.time_of_day),1)]),_:2},1024),c(i(b),{class:"whitespace-nowrap"},{default:u(()=>[d(f(Me(e.tags)),1)]),_:2},1024),V.value?(n(),x(i(b),{key:0,class:"whitespace-nowrap"},{default:u(()=>[d(f(e.target_account||"--"),1)]),_:2},1024)):m("",!0),V.value?(n(),x(i(b),{key:1,class:"whitespace-nowrap"},{default:u(()=>[d(f(Ve(e.ai_accounts)),1)]),_:2},1024)):m("",!0),V.value?(n(),x(i(b),{key:2,class:"whitespace-nowrap"},{default:u(()=>[d(f(e.completed?"已完成":"未完成"),1)]),_:2},1024)):m("",!0),c(i(b),{class:"whitespace-nowrap"},{default:u(()=>[d(f(i(ee)(e.created_at)),1)]),_:2},1024),c(i(b),{class:"text-right whitespace-nowrap"},{default:u(()=>[a("div",$r,[e.completed?m("",!0):(n(),x(M,{key:0,size:"sm",variant:"outline",onClick:v=>he(e),disabled:J.value},{default:u(()=>[...r[35]||(r[35]=[d("立即执行",-1)])]),_:1},8,["onClick","disabled"])),c(M,{size:"sm",variant:"outline",onClick:v=>ke(e)},{default:u(()=>[...r[36]||(r[36]=[d("编辑",-1)])]),_:1},8,["onClick"]),a("button",{class:"inline-flex items-center justify-center font-medium gap-2 rounded-lg transition px-4 py-3 text-sm bg-white text-gray-700 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 dark:bg-gray-800 dark:text-gray-400 dark:ring-gray-700 dark:hover:bg-white/[0.03] dark:hover:text-gray-300 text-rose-600 ring-rose-200 hover:bg-rose-50 dark:text-rose-400 dark:ring-rose-500/30",onClick:v=>$e(e,v)}," 删除 ",8,Cr)])]),_:2},1024)]}),_:2},1024))),128)):(n(),x(i(re),{key:1},{default:u(()=>[c(i(b),{colspan:10,class:"py-16 text-center text-gray-400 dark:text-white/40"},{default:u(()=>[...r[37]||(r[37]=[d("暂无数据",-1)])]),_:1})]),_:1}))]),_:1})]),_:1}),X.value>0?(n(),g("div",Sr,[c(i(tr),{page:j.value,"onUpdate:page":r[0]||(r[0]=e=>j.value=e),total:X.value,"items-per-page":le.value,"sibling-count":1},{default:u(()=>[c(i(ar),null,{default:u(({items:e})=>[c(i(or)),(n(!0),g(w,null,k(e,(s,l)=>(n(),g(w,{key:l},[s.type==="page"?(n(),x(i(sr),{key:0,value:s.value,"is-active":s.value===j.value},{default:u(()=>[d(f(s.value),1)]),_:2},1032,["value","is-active"])):(n(),x(i(lr),{key:1,index:l},null,8,["index"]))],64))),128)),c(i(nr))]),_:1})]),_:1},8,["page","total","items-per-page"])])):m("",!0)]),_:1}),B.value?(n(),x(ye,{key:0,fullScreenBackdrop:!0,onClose:G},{body:u(()=>[a("div",Fr,[a("h3",Or,f(U.value?"编辑任务":"新增任务"),1),a("form",{onSubmit:fe(xe,["prevent"]),class:"space-y-4"},[o.value.type==="follow"?(n(),g("div",Ur,[i(C)=="admin"?(n(),g("div",Vr,[r[39]||(r[39]=a("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[d("目标用户"),a("span",{class:"text-error-500"},"*")],-1)),h(a("select",{"onUpdate:modelValue":r[1]||(r[1]=e=>o.value.owner=e),class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},[r[38]||(r[38]=a("option",{value:"",disabled:""},"请选择目标用户",-1)),(n(!0),g(w,null,k(P.value,e=>(n(),g("option",{key:e.id,value:e.id},f(e.name),9,Mr))),128))],512),[[A,o.value.owner]])])):m("",!0),a("div",jr,[a("div",null,[r[41]||(r[41]=a("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[d("类型"),a("span",{class:"text-error-500"},"*")],-1)),h(a("select",{"onUpdate:modelValue":r[2]||(r[2]=e=>o.value.type=e),disabled:U.value,class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800 disabled:opacity-50 disabled:cursor-not-allowed"},[r[40]||(r[40]=a("option",{value:""},"请选择类型",-1)),(n(!0),g(w,null,k(i(te),e=>(n(),g("option",{key:e.value,value:e.value},f(e.label),9,Dr))),128))],8,Nr),[[A,o.value.type]])])])])):(n(),g("div",Pr,[i(C)=="admin"?(n(),g("div",Lr,[r[43]||(r[43]=a("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[d("目标用户"),a("span",{class:"text-error-500"},"*")],-1)),h(a("select",{"onUpdate:modelValue":r[3]||(r[3]=e=>o.value.owner=e),class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},[r[42]||(r[42]=a("option",{value:"",disabled:""},"请选择目标用户",-1)),(n(!0),g(w,null,k(P.value,e=>(n(),g("option",{key:e.id,value:e.id},f(e.name),9,zr))),128))],512),[[A,o.value.owner]])])):m("",!0),a("div",Br,[a("div",null,[r[45]||(r[45]=a("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[d("平台"),a("span",{class:"text-error-500"},"*")],-1)),h(a("select",{"onUpdate:modelValue":r[4]||(r[4]=e=>o.value.provider=e),class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},[r[44]||(r[44]=a("option",{value:""},"请选择平台",-1)),(n(!0),g(w,null,k(i(ve),e=>(n(),g("option",{key:e.value,value:e.value},f(e.label),9,Rr))),128))],512),[[A,o.value.provider]])]),a("div",null,[r[47]||(r[47]=a("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[d("类型"),a("span",{class:"text-error-500"},"*")],-1)),h(a("select",{"onUpdate:modelValue":r[5]||(r[5]=e=>o.value.type=e),disabled:U.value,class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800 disabled:opacity-50 disabled:cursor-not-allowed"},[r[46]||(r[46]=a("option",{value:""},"请选择类型",-1)),(n(!0),g(w,null,k(i(te),e=>(n(),g("option",{key:e.value,value:e.value},f(e.label),9,Er))),128))],8,Ir),[[A,o.value.type]])])])])),o.value.type==="follow"?(n(),g("div",Kr,[a("div",qr,[r[49]||(r[49]=a("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[d("关注账户"),a("span",{class:"text-error-500"},"*")],-1)),h(a("select",{"onUpdate:modelValue":r[6]||(r[6]=e=>T.value=e),onChange:Le,class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},[r[48]||(r[48]=a("option",{value:""},"请选择关注账户",-1)),(n(!0),g(w,null,k(K.value,e=>(n(),g("option",{key:e.id,value:e.id},f(e.external_user_id),9,Jr))),128))],544),[[A,T.value]])])])):(n(),g("div",Xr,[a("div",null,[r[51]||(r[51]=a("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[d("关键词"),a("span",{class:"text-error-500"},"*")],-1)),h(a("select",{"onUpdate:modelValue":r[7]||(r[7]=e=>o.value.keyword=e),class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},[r[50]||(r[50]=a("option",{value:""},"请选择关键词",-1)),(n(!0),g(w,null,k(H.value,e=>(n(),g("option",{key:e.id,value:e.id},f(e.name),9,Yr))),128))],512),[[A,o.value.keyword]])]),a("div",null,[r[53]||(r[53]=a("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[d("提示词"),a("span",{class:"text-error-500"},"*")],-1)),h(a("select",{"onUpdate:modelValue":r[8]||(r[8]=e=>o.value.prompt=e),class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},[r[52]||(r[52]=a("option",{value:""},"请选择提示词",-1)),(n(!0),g(w,null,k(ze.value,e=>(n(),g("option",{key:e.id,value:e.id},f(e.name),9,Gr))),128))],512),[[A,o.value.prompt]])]),a("div",null,[r[55]||(r[55]=a("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[d("大模型"),a("span",{class:"text-error-500"},"*")],-1)),h(a("select",{"onUpdate:modelValue":r[9]||(r[9]=e=>o.value.ai_config_id=e),class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},[r[54]||(r[54]=a("option",{value:""},"请选择大模型",-1)),(n(!0),g(w,null,k(q.value,e=>(n(),g("option",{key:e.id,value:e.id},f(e.name),9,Hr))),128))],512),[[A,o.value.ai_config_id]])]),a("div",null,[r[57]||(r[57]=a("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[d("平台账号"),a("span",{class:"text-error-500"},"*")],-1)),h(a("select",{"onUpdate:modelValue":r[10]||(r[10]=e=>o.value.social_config_id=e),class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},[r[56]||(r[56]=a("option",{value:""},"请选择平台账号",-1)),(n(!0),g(w,null,k(L.value,e=>(n(),g("option",{key:e.id,value:e.id},f(e.name),9,Qr))),128))],512),[[A,o.value.social_config_id]])]),a("div",null,[r[59]||(r[59]=a("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[d("循环类型"),a("span",{class:"text-error-500"},"*")],-1)),h(a("select",{"onUpdate:modelValue":r[11]||(r[11]=e=>o.value.recurrence_type=e),class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},[...r[58]||(r[58]=[a("option",{value:"daily"},"日",-1),a("option",{value:"weekly"},"周",-1),a("option",{value:"monthly"},"月",-1)])],512),[[A,o.value.recurrence_type]])]),a("div",null,[r[60]||(r[60]=a("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[d("循环周期"),a("span",{class:"text-error-500"},"*")],-1)),h(a("input",{"onUpdate:modelValue":r[12]||(r[12]=e=>o.value.day_of_month=e),type:"number",min:"1",placeholder:"如：1",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[pe,o.value.day_of_month,void 0,{number:!0}]])]),a("div",Wr,[r[61]||(r[61]=a("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[d("执行时间"),a("span",{class:"text-error-500"},"*")],-1)),h(a("input",{"onUpdate:modelValue":r[13]||(r[13]=e=>o.value.time_of_day=e),type:"time",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[pe,o.value.time_of_day]])]),a("div",Zr,[r[64]||(r[64]=a("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[d("话题"),a("span",{class:"text-gray-500 text-xs ml-1"},"(最多选择5个)")],-1)),a("div",et,[a("div",{onClick:De,class:"dark:bg-dark-900 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs cursor-pointer focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800 min-h-[44px] flex items-center"},[o.value.tags.length===0?(n(),g("div",rt,"请选择话题")):(n(),g("div",tt,[(n(!0),g(w,null,k(o.value.tags,e=>(n(),g("span",{key:e,class:"inline-flex items-center px-1.5 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200 whitespace-nowrap"},[a("span",at,f(je(e)),1),a("button",{type:"button",onClick:fe(s=>Ne(e),["stop"]),class:"inline-flex items-center justify-center w-3 h-3 rounded-full text-blue-400 hover:bg-blue-200 hover:text-blue-500 dark:hover:bg-blue-800 dark:hover:text-blue-300"}," X ",8,ot)]))),128))])),a("div",st,[(n(),g("svg",{class:Z(["w-4 h-4 text-gray-400 transition-transform duration-200",{"rotate-180":O.value}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...r[62]||(r[62]=[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)])],2))])]),O.value?(n(),g("div",lt,[F.value.length===0?(n(),g("div",nt," 暂无话题选项 ")):(n(),g("div",dt,[(n(!0),g(w,null,k(F.value,e=>(n(),g("div",{key:e.id,onClick:s=>Pe(e.id),class:"px-4 py-2 text-sm cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center justify-between"},[a("span",null,f(e.name),1),o.value.tags.includes(e.id)?(n(),g("div",ut,[...r[63]||(r[63]=[a("svg",{class:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20"},[a("path",{"fill-rule":"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z","clip-rule":"evenodd"})],-1)])])):m("",!0)],8,it))),128))]))])):m("",!0)]),a("div",gt," 已选择: "+f(o.value.tags.length)+"/5 ",1)]),a("div",null,[r[66]||(r[66]=a("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},"状态",-1)),h(a("select",{"onUpdate:modelValue":r[14]||(r[14]=e=>o.value.enabled=e),class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},[...r[65]||(r[65]=[a("option",{value:!0},"启用",-1),a("option",{value:!1},"停用",-1)])],512),[[A,o.value.enabled]])])])),a("div",ct,[c(M,{type:"button",variant:"outline",onClick:G},{default:u(()=>[...r[67]||(r[67]=[d("取消",-1)])]),_:1}),c(M,{type:"submit"},{default:u(()=>[...r[68]||(r[68]=[d("保存",-1)])]),_:1})])],32)])]),_:1})):m("",!0),c(We,{isOpen:Y.value,title:"删除",description:"确定要删除吗？此操作不可撤销。",isLoading:R.value,triggerRect:ne.value,onClose:ie,onConfirm:Ce},null,8,["isOpen","isLoading","triggerRect"]),se.value?(n(),x(ye,{key:1,fullScreenBackdrop:!0,onClose:de},{body:u(()=>[a("div",ft,[r[75]||(r[75]=a("h3",{class:"mb-4 text-lg font-semibold"},"执行结果",-1)),me.value?(n(),g("div",pt,[...r[69]||(r[69]=[a("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"},null,-1),a("span",{class:"ml-2 text-gray-600"},"加载中...",-1)])])):z.value&&z.value.length>0?(n(),g("div",yt,[(n(!0),g(w,null,k(z.value,(e,s)=>(n(),g("div",{key:s,class:"border border-gray-200 dark:border-gray-700 rounded-lg p-4"},[a("div",vt,[a("span",bt,"执行记录 "+f(s+1),1),a("span",{class:Z(["text-xs px-2 py-1 rounded-full",Te(e.status)])},f(Ae(e.status)),3)]),a("div",_t,[a("div",null,[r[70]||(r[70]=a("strong",null,"开始时间:",-1)),d(" "+f(i(ee)(e.started_at)),1)]),e.finished_at?(n(),g("div",mt,[r[71]||(r[71]=a("strong",null,"结束时间:",-1)),d(" "+f(i(ee)(e.finished_at)),1)])):m("",!0),e.error_message?(n(),g("div",wt,[r[72]||(r[72]=a("strong",null,"错误信息:",-1)),d(" "+f(e.error_message),1)])):m("",!0),e.result?(n(),g("div",kt,[r[73]||(r[73]=a("strong",null,"执行结果:",-1)),d(" "+f(e.result),1)])):m("",!0)])]))),128))])):(n(),g("div",xt," 暂无执行结果 ")),a("div",ht,[c(M,{type:"button",variant:"outline",onClick:de},{default:u(()=>[...r[74]||(r[74]=[d("关闭",-1)])]),_:1})])])]),_:1})):m("",!0)])]),_:1}))}};export{Bt as default};
