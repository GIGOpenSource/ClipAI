import{d as ye,r as p,f as Z,w as q,j as we,c as _,x as a,z as w,B as ee,A as e,a as t,E as o,y as s,t as i,n as te,C as K,J as X,F as U,v as O,H as F,o as c,D as Re,K as Ue}from"./index-CPBg-leY.js";import{_ as Fe,a as Te}from"./AdminLayout-BWlSSXP9.js";import{i as ae,_ as se,a as le,b as S,c as f,d as re,e as u,P as ke,f as be,g as _e,h as he,k as De,l as Ce,j as Ae}from"./DeleteConfirmDialog-C3ez2aH_.js";import{a as C,f as G,_ as oe}from"./chevron-right-BH6xvSO4.js";import{l as Ee,p as Ne,a as He,t as Ke,_ as Oe}from"./home-Di6v6-PN.js";import{_ as $e}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{h as Je}from"./index-BSm4yeEa.js";const Xe={class:"space-y-6"},qe={class:"flex items-center justify-between mb-4"},Ge={class:"mb-4"},Qe={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-4 dark:bg-gray-800 dark:border-gray-700"},We={class:"flex items-center justify-between"},Ye={class:"flex items-center gap-4"},Ze={class:"flex items-center gap-2"},et={class:"flex items-center gap-6"},tt={class:"flex items-center gap-4"},at={class:"text-sm text-emerald-600 dark:text-emerald-400 font-medium"},st={class:"text-sm text-red-600 dark:text-red-400 font-medium"},lt={class:"mt-4"},rt={class:"relative bg-white rounded-lg shadow-xl max-w-md w-full mx-4 dark:bg-gray-800"},ot={class:"p-6"},nt={class:"text-center"},it={class:"flex justify-center gap-3"},dt=ye({__name:"TaskDetail",props:{taskDetail:{}},emits:["close"],setup(g){const T=g,$=p(""),y=p(1),A=p(10),V=p(0),h=p(!1),M=p(!1),k=p([]),j=Z(()=>{const x=k.value.filter(d=>d.status==="success").length,l=k.value.filter(d=>d.status==="failed").length;return{success:x,failed:l}}),B=()=>{y.value=1,z()},P=()=>{console.log("重试按钮被点击"),console.log("失败数量:",j.value.failed),console.log("当前showRetryConfirm:",h.value),h.value=!0,console.log("设置后showRetryConfirm:",h.value)},z=async()=>{var x,l;M.value=!0;try{if(!((x=T.taskDetail)!=null&&x.id)){k.value=[],V.value=0;return}const d={simpletask_id:T.taskDetail.id,currentPage:y.value,pageSize:A.value};$.value&&$.value!=="all"&&(d.status=$.value);const D=await Ee(d);if(D&&D.results){const I=D.results||[];k.value=I.map(L=>({id:L.id||"",account:L.account||"",publish_time:L.created_at||"",status:L.success==="success"?"success":"failed",external_id:L.external_id||"",error_message:L.error_message||""})),V.value=((l=D.pagination)==null?void 0:l.total)||0}else k.value=[],V.value=0}catch(d){console.error("获取执行日志失败:",d),F.error("获取执行日志失败"),k.value=[],V.value=0}finally{M.value=!1}},E=async()=>{var x;try{h.value=!1;const l={simpletask_id:(x=T.taskDetail)==null?void 0:x.id},d=await Ne(l);d.message?F.success(d.message):F.success("已开始重新执行失败的任务"),await z()}catch(l){console.error("重新执行失败:",l),F.error("重新执行失败")}};return q(y,()=>{z()}),q(()=>T.taskDetail,x=>{x!=null&&x.id&&z()},{deep:!0}),we(()=>{z()}),(x,l)=>(c(),_("div",Xe,[a(ae,null,{default:e(()=>[t("div",qe,[l[7]||(l[7]=t("h3",{class:"text-lg font-semibold text-gray-900 dark:text-white"},"任务参数",-1)),a(C,{variant:"outline",onClick:l[0]||(l[0]=d=>x.$emit("close"))},{default:e(()=>[...l[6]||(l[6]=[o(" 返回 ",-1)])]),_:1})]),a(s(se),{class:"[&_td]:py-3.5 [&_th]:py-3.5"},{default:e(()=>[a(s(le),null,{default:e(()=>[a(s(S),null,{default:e(()=>[a(s(f),{class:"whitespace-nowrap"},{default:e(()=>[...l[8]||(l[8]=[o("序号",-1)])]),_:1}),a(s(f),{class:"whitespace-nowrap"},{default:e(()=>[...l[9]||(l[9]=[o("创建用户",-1)])]),_:1}),a(s(f),{class:"whitespace-nowrap"},{default:e(()=>[...l[10]||(l[10]=[o("类型",-1)])]),_:1}),a(s(f),{class:"whitespace-nowrap"},{default:e(()=>[...l[11]||(l[11]=[o("平台",-1)])]),_:1}),a(s(f),{class:"whitespace-nowrap"},{default:e(()=>[...l[12]||(l[12]=[o("语言",-1)])]),_:1}),a(s(f),{class:"whitespace-nowrap"},{default:e(()=>[...l[13]||(l[13]=[o("文本内容",-1)])]),_:1}),a(s(f),{class:"whitespace-nowrap"},{default:e(()=>[...l[14]||(l[14]=[o("提及",-1)])]),_:1}),a(s(f),{class:"whitespace-nowrap"},{default:e(()=>[...l[15]||(l[15]=[o("话题",-1)])]),_:1}),a(s(f),{class:"whitespace-nowrap"},{default:e(()=>[...l[16]||(l[16]=[o("提示词",-1)])]),_:1}),a(s(f),{class:"whitespace-nowrap"},{default:e(()=>[...l[17]||(l[17]=[o("备注",-1)])]),_:1}),a(s(f),{class:"whitespace-nowrap"},{default:e(()=>[...l[18]||(l[18]=[o("创建时间",-1)])]),_:1})]),_:1})]),_:1}),a(s(re),null,{default:e(()=>[g.taskDetail?(c(),w(s(S),{key:0},{default:e(()=>[a(s(u),{class:"whitespace-nowrap"},{default:e(()=>[...l[19]||(l[19]=[o("1",-1)])]),_:1}),a(s(u),{class:"whitespace-nowrap"},{default:e(()=>[o(i(g.taskDetail.owner_name||"--"),1)]),_:1}),a(s(u),{class:"whitespace-nowrap"},{default:e(()=>[t("span",{class:te(["inline-flex items-center rounded-full px-2 py-0.5 text-xs font-medium ring-1 ring-inset",g.taskDetail.type==="post"?"bg-blue-50 text-blue-600 ring-blue-200 dark:bg-blue-500/10 dark:text-blue-400 dark:ring-blue-500/30":g.taskDetail.type==="reply_comment"?"bg-purple-50 text-purple-600 ring-purple-200 dark:bg-purple-500/10 dark:text-purple-400 dark:ring-purple-500/30":"bg-orange-50 text-orange-600 ring-orange-200 dark:bg-orange-500/10 dark:text-orange-400 dark:ring-orange-500/30"])},i(g.taskDetail.type==="post"?"发帖":g.taskDetail.type==="reply_comment"?"回复评论":g.taskDetail.type==="reply_mention"?"回复消息":g.taskDetail.type),3)]),_:1}),a(s(u),{class:"whitespace-nowrap"},{default:e(()=>[o(i(g.taskDetail.provider||"--"),1)]),_:1}),a(s(u),{class:"whitespace-nowrap"},{default:e(()=>[o(i(g.taskDetail.language||"--"),1)]),_:1}),a(s(u),{class:"max-w-[200px] truncate",title:g.taskDetail.text},{default:e(()=>[o(i(g.taskDetail.text||"--"),1)]),_:1},8,["title"]),a(s(u),{class:"max-w-[150px] truncate",title:g.taskDetail.mentions},{default:e(()=>[o(i(g.taskDetail.mentions||"--"),1)]),_:1},8,["title"]),a(s(u),{class:"max-w-[150px] truncate",title:Array.isArray(g.taskDetail.tags)?g.taskDetail.tags.join(", "):g.taskDetail.tags},{default:e(()=>[o(i(Array.isArray(g.taskDetail.tags)?g.taskDetail.tags.join(", "):g.taskDetail.tags||"--"),1)]),_:1},8,["title"]),a(s(u),{class:"whitespace-nowrap"},{default:e(()=>[o(i(g.taskDetail.prompt_name||"--"),1)]),_:1}),a(s(u),{class:"whitespace-nowrap"},{default:e(()=>[o(i(g.taskDetail.task_remark||"--"),1)]),_:1}),a(s(u),{class:"whitespace-nowrap"},{default:e(()=>[o(i(s(G)(g.taskDetail.created_at)),1)]),_:1})]),_:1})):(c(),w(s(S),{key:1},{default:e(()=>[a(s(u),{colspan:11,class:"py-16 text-center text-gray-400 dark:text-white/40"},{default:e(()=>[...l[20]||(l[20]=[o(" 暂无数据 ",-1)])]),_:1})]),_:1}))]),_:1})]),_:1})]),_:1}),a(ae,null,{default:e(()=>[t("div",Ge,[l[24]||(l[24]=t("h3",{class:"text-lg font-semibold text-gray-900 dark:text-white mb-4"},"执行日志",-1)),t("div",Qe,[t("div",We,[t("div",Ye,[t("div",Ze,[l[22]||(l[22]=t("label",{class:"text-sm text-gray-600 dark:text-gray-400 whitespace-nowrap"},"发布状态",-1)),K(t("select",{"onUpdate:modelValue":l[1]||(l[1]=d=>$.value=d),onChange:B,class:"w-48 h-10 px-3 rounded-lg border border-gray-300 bg-white text-sm text-gray-800 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white dark:focus:border-blue-400 dark:focus:ring-blue-400"},[...l[21]||(l[21]=[t("option",{value:""},"请选择发布状态",-1),t("option",{value:"all"},"全部",-1),t("option",{value:"success"},"成功",-1),t("option",{value:"failed"},"失败",-1)])],544),[[X,$.value]])])]),t("div",et,[t("div",tt,[t("span",at," 成功: "+i(j.value.success),1),t("span",st," 失败: "+i(j.value.failed),1)]),a(C,{size:"sm",class:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors",onClick:P,disabled:j.value.failed===0},{default:e(()=>[...l[23]||(l[23]=[o(" 重新执行失败 ",-1)])]),_:1},8,["disabled"])])])])]),a(s(se),{class:"[&_td]:py-3.5 [&_th]:py-3.5"},{default:e(()=>[a(s(le),null,{default:e(()=>[a(s(S),null,{default:e(()=>[a(s(f),{class:"whitespace-nowrap"},{default:e(()=>[...l[25]||(l[25]=[o("ID",-1)])]),_:1}),a(s(f),{class:"whitespace-nowrap"},{default:e(()=>[...l[26]||(l[26]=[o("账号ID",-1)])]),_:1}),a(s(f),{class:"whitespace-nowrap"},{default:e(()=>[...l[27]||(l[27]=[o("发布时间",-1)])]),_:1}),a(s(f),{class:"whitespace-nowrap"},{default:e(()=>[...l[28]||(l[28]=[o("状态",-1)])]),_:1}),a(s(f),{class:"whitespace-nowrap"},{default:e(()=>[...l[29]||(l[29]=[o("外部ID",-1)])]),_:1}),a(s(f),{class:"whitespace-nowrap"},{default:e(()=>[...l[30]||(l[30]=[o("错误信息",-1)])]),_:1})]),_:1})]),_:1}),a(s(re),null,{default:e(()=>[M.value?(c(),w(s(S),{key:0},{default:e(()=>[a(s(u),{colspan:6,class:"py-16 text-center text-gray-400 dark:text-white/40"},{default:e(()=>[...l[31]||(l[31]=[t("div",{class:"flex items-center justify-center gap-2"},[t("svg",{class:"animate-spin h-5 w-5 text-blue-600",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]),o(" 加载中... ")],-1)])]),_:1})]),_:1})):k.value.length?(c(!0),_(U,{key:1},O(k.value,d=>(c(),w(s(S),{key:d.id},{default:e(()=>[a(s(u),{class:"whitespace-nowrap font-mono text-sm"},{default:e(()=>[o(i(d.id),1)]),_:2},1024),a(s(u),{class:"whitespace-nowrap font-mono text-sm"},{default:e(()=>[o(i(d.account||"--"),1)]),_:2},1024),a(s(u),{class:"whitespace-nowrap"},{default:e(()=>[o(i(s(G)(d.publish_time)),1)]),_:2},1024),a(s(u),{class:"whitespace-nowrap"},{default:e(()=>[t("span",{class:te(["inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium",d.status==="success"?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400":"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400"])},i(d.status==="success"?"成功":d.status==="failed"?"失败":d.status),3)]),_:2},1024),a(s(u),{class:"whitespace-nowrap font-mono text-sm max-w-[120px] truncate",title:d.external_id},{default:e(()=>[o(i(d.external_id||"--"),1)]),_:2},1032,["title"]),a(s(u),{class:"max-w-[200px] truncate text-red-600 dark:text-red-400",title:d.error_message},{default:e(()=>[o(i(d.error_message||"--"),1)]),_:2},1032,["title"])]),_:2},1024))),128)):(c(),w(s(S),{key:2},{default:e(()=>[a(s(u),{colspan:6,class:"py-16 text-center text-gray-400 dark:text-white/40"},{default:e(()=>[...l[32]||(l[32]=[o(" 暂无执行日志 ",-1)])]),_:1})]),_:1}))]),_:1})]),_:1}),t("div",lt,[a(s(ke),{page:y.value,"onUpdate:page":l[2]||(l[2]=d=>y.value=d),total:V.value,"items-per-page":A.value,"sibling-count":1,"show-edges":""},{default:e(()=>[a(s(be),null,{default:e(({items:d})=>[a(s(_e)),(c(!0),_(U,null,O(d,(D,I)=>(c(),_(U,{key:I},[D.type==="page"?(c(),w(s(De),{key:0,value:D.value,"is-active":D.value===y.value},{default:e(()=>[o(i(D.value),1)]),_:2},1032,["value","is-active"])):(c(),w(s(Ce),{key:1,index:I},null,8,["index"]))],64))),128)),a(s(he))]),_:1})]),_:1},8,["page","total","items-per-page"])])]),_:1}),h.value?(c(),w(oe,{key:0,onClose:l[5]||(l[5]=d=>h.value=!1)},{body:e(()=>[t("div",{class:"fixed inset-0 bg-black/50 backdrop-blur-sm",onClick:l[3]||(l[3]=d=>h.value=!1)}),t("div",rt,[t("div",ot,[t("div",nt,[l[35]||(l[35]=t("h3",{class:"text-lg font-semibold text-blue-600 dark:text-blue-400 mb-2"}," 确认重试失败任务? ",-1)),l[36]||(l[36]=t("p",{class:"text-gray-600 dark:text-gray-400 text-sm mb-6"}," 一键重新发送所有执行失败的机器人任务 (此操作仅能进行一次) ",-1)),t("div",it,[a(C,{onClick:E,class:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg text-sm font-medium"},{default:e(()=>[...l[33]||(l[33]=[o(" 确认重试 ",-1)])]),_:1}),a(C,{onClick:l[4]||(l[4]=d=>h.value=!1),variant:"outline",class:"border-blue-600 text-blue-600 hover:bg-blue-50 px-6 py-2 rounded-lg text-sm font-medium"},{default:e(()=>[...l[34]||(l[34]=[o(" 不重试 ",-1)])]),_:1})])])])])]),_:1})):ee("",!0)]))}}),ut=$e(dt,[["__scopeId","data-v-dbcc3ddc"]]),pt=g=>Je(`/tasks/logs/${g}/`),ct={key:0,class:"space-y-5 sm:space-y-6"},ft={key:1,class:"space-y-5 sm:space-y-6"},gt={class:"mb-4"},mt={class:"relative"},vt={class:"mb-4 flex items-center gap-3 flex-wrap"},xt=["value"],yt={class:"flex items-center gap-2"},wt={class:"flex items-center gap-2"},kt={key:0,class:"mr-2"},bt={key:1},_t={class:"inline-flex items-center text-emerald-600 dark:text-emerald-400 font-medium"},ht={class:"inline-flex items-center text-red-600 dark:text-red-400 font-medium"},Dt={class:"flex items-center justify-end gap-2"},Ct={class:"mt-4"},$t={class:"relative z-10 w-full max-w-3xl rounded-xl bg-white p-6 shadow-lg dark:bg-gray-900"},zt={class:"space-y-4"},St={class:"grid grid-cols-2 gap-4"},Vt={class:"text-sm text-gray-900 dark:text-white"},jt={class:"text-sm text-gray-900 dark:text-white"},It={class:"grid grid-cols-2 gap-4"},Lt={class:"text-sm text-gray-900 dark:text-white"},Mt={class:"text-sm text-gray-900 dark:text-white"},Bt={class:"text-sm text-gray-900 dark:text-white p-3 bg-gray-50 dark:bg-gray-800 rounded-lg"},Pt={class:"grid grid-cols-2 gap-4"},Rt={class:"text-sm text-gray-900 dark:text-white"},Ut={class:"text-sm text-emerald-600 dark:text-emerald-400 font-medium"},Ft={class:"flex justify-end gap-3 pt-6 mt-6 border-t border-gray-200 dark:border-gray-700"},Tt={class:"relative bg-white rounded-lg shadow-xl p-6 max-w-4xl mx-auto dark:bg-gray-900"},At={class:"mb-6"},Et={class:"mb-4 p-3 bg-gray-50 rounded-lg dark:bg-gray-800"},Nt={class:"text-sm text-gray-600 dark:text-gray-400"},Ht={class:"font-semibold text-gray-900 dark:text-white"},Kt={class:"flex justify-end gap-3"},Ot=ye({__name:"taskLog",setup(g){const T=p("任务日志"),$=p([]),y=p(1),A=p(20),V=p(0),h=p(0),M=p(!1),k=p([]),j=p(""),B=p(""),P=p(""),z=p(""),E=p(!1),x=p(!1),l=p({start:void 0,end:void 0}),d=Z(()=>{if(!l.value.start||!l.value.end)return"";const m=I(l.value.start),r=I(l.value.end);return`${m} 至 ${r}`}),D=Z(()=>l.value.start&&l.value.end),I=m=>{if(!m)return"";const r=m.year,n=String(m.month).padStart(2,"0"),v=String(m.day).padStart(2,"0");return`${r}-${n}-${v}`},L=p(!1),Q=p(!1),b=p(null),ne=p(!1),J=p(!1),W=p(null),ze=p({top:0,left:0,width:0,height:0});function Se(m){b.value=m,Q.value=!0}function ie(){L.value=!1,b.value=null}function Ve(){Q.value=!1,b.value=null}async function je(){if(W.value){J.value=!0;try{await pt(W.value.id.toString()),F.success("删除成功"),await R(),de()}catch(m){console.error("删除失败:",m);const r=m instanceof Error?m.message:"删除任务日志时发生错误";F.error("删除失败",{description:r})}finally{J.value=!1}}}function de(){ne.value=!1,W.value=null,J.value=!1}const N=async()=>{E.value=!0,y.value=1;try{await R()}finally{E.value=!1}},Ie=()=>{j.value="",B.value="",P.value="",z.value="",l.value={start:void 0,end:void 0},y.value=1,R()},Le=()=>{y.value=1,R()},Me=()=>{x.value=!0},Y=()=>{x.value=!1},Be=()=>{D.value&&(x.value=!1,N())},Pe=async()=>{try{const m=await He({});console.log(m.results,"res"),m&&m.results?k.value=m.results:k.value=[],console.log(k.value,"promptConfigs.value")}catch(m){console.error("获取提示词配置失败:",m),k.value=[]}},R=async()=>{var m,r;M.value=!0;try{const n={currentPage:y.value,pageSize:A.value,enterprise_id:localStorage.getItem("selectedUserId")||""};j.value&&(n.search=j.value),B.value&&(n.type=B.value),P.value&&(n.provider=P.value),z.value&&(n.prompt__id=parseInt(z.value)),l.value.start&&l.value.end&&(n.start_date=I(l.value.start),n.end_date=I(l.value.end));const v=await Ke(n);v&&v.results?($.value=v.results||[],V.value=((m=v.pagination)==null?void 0:m.total)||0,h.value=((r=v.pagination)==null?void 0:r.total_pages)||0):($.value=[],V.value=0,h.value=0)}catch(n){console.error("获取任务日志失败:",n);const v=n instanceof Error?n.message:"获取任务日志时发生错误";F.error("获取列表失败",{description:v}),$.value=[],V.value=0,h.value=0}finally{M.value=!1}};q(y,()=>{R()});const ue=p(localStorage.getItem("selectedUserId")||"");return q(ue,()=>{R()}),window.addEventListener("enterprise-data-changed",()=>{ue.value=localStorage.getItem("selectedUserId")||""}),we(()=>{Pe(),R()}),(m,r)=>(c(),w(Fe,null,{default:e(()=>[a(Te,{pageTitle:T.value},null,8,["pageTitle"]),Q.value?(c(),_("div",ct,[a(ut,{taskDetail:b.value,onClose:Ve},null,8,["taskDetail"])])):(c(),_("div",ft,[a(ae,null,{default:e(()=>[t("div",gt,[t("div",mt,[K(t("input",{"onUpdate:modelValue":r[0]||(r[0]=n=>j.value=n),type:"text",placeholder:"请输入文本内容",class:"w-64 h-10 px-4 pl-10 rounded-lg border border-gray-300 bg-transparent text-sm text-gray-800 shadow-theme-xs focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:focus:border-brand-800",onKeyup:Ue(N,["enter"])},null,544),[[Re,j.value]]),r[6]||(r[6]=t("svg",{class:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1))])]),t("div",vt,[K(t("select",{"onUpdate:modelValue":r[1]||(r[1]=n=>B.value=n),onChange:N,class:"w-48 h-10 px-4 rounded-lg border border-gray-300 bg-transparent text-sm text-gray-800 shadow-theme-xs focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:focus:border-brand-800"},[...r[7]||(r[7]=[t("option",{value:""},"请选择类型",-1),t("option",{value:"post"},"发帖",-1),t("option",{value:"reply_comment"},"回复评论",-1),t("option",{value:"reply_mention"},"回复消息",-1)])],544),[[X,B.value]]),K(t("select",{"onUpdate:modelValue":r[2]||(r[2]=n=>P.value=n),onChange:N,class:"w-48 h-10 px-4 rounded-lg border border-gray-300 bg-transparent text-sm text-gray-800 shadow-theme-xs focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:focus:border-brand-800"},[...r[8]||(r[8]=[t("option",{value:""},"请选择平台",-1),t("option",{value:"twitter"},"X",-1),t("option",{value:"facebook"},"Facebook",-1),t("option",{value:"instagram"},"Instagram",-1),t("option",{value:"threads"},"Threads",-1)])],544),[[X,P.value]]),K(t("select",{"onUpdate:modelValue":r[3]||(r[3]=n=>z.value=n),onChange:N,class:"w-48 h-10 px-4 rounded-lg border border-gray-300 bg-transparent text-sm text-gray-800 shadow-theme-xs focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:focus:border-brand-800"},[r[9]||(r[9]=t("option",{value:""},"请选择提示词",-1)),(c(!0),_(U,null,O(k.value,n=>(c(),_("option",{key:n.id,value:n.id},i(n.name),9,xt))),128))],544),[[X,z.value]]),t("div",yt,[a(C,{variant:"outline",onClick:Me,class:"px-4 py-2 h-10 min-w-[220px] justify-start text-left"},{default:e(()=>[r[10]||(r[10]=t("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)),o(" "+i(d.value||"选择日期时间段"),1)]),_:1})]),t("div",wt,[a(C,{size:"sm",onClick:N,disabled:E.value,class:"bg-blue-600 hover:bg-blue-700"},{default:e(()=>[E.value?(c(),_("span",kt,"查询中...")):(c(),_("span",bt,"查询"))]),_:1},8,["disabled"]),a(C,{size:"sm",variant:"outline",onClick:Ie},{default:e(()=>[...r[11]||(r[11]=[o(" 重置 ",-1)])]),_:1}),a(C,{size:"sm",onClick:Le,variant:"outline",class:"text-red-600 hover:text-red-700 border-red-200 hover:border-red-300"},{default:e(()=>[...r[12]||(r[12]=[o(" 刷新 ",-1)])]),_:1})])]),a(s(se),{class:"[&_td]:py-3.5 [&_th]:py-3.5"},{default:e(()=>[a(s(le),null,{default:e(()=>[a(s(S),null,{default:e(()=>[a(s(f),{class:"whitespace-nowrap"},{default:e(()=>[...r[13]||(r[13]=[o("序号",-1)])]),_:1}),a(s(f),{class:"whitespace-nowrap"},{default:e(()=>[...r[14]||(r[14]=[o("创建时间",-1)])]),_:1}),a(s(f),{class:"whitespace-nowrap"},{default:e(()=>[...r[15]||(r[15]=[o("创建用户",-1)])]),_:1}),a(s(f),{class:"whitespace-nowrap"},{default:e(()=>[...r[16]||(r[16]=[o("类型",-1)])]),_:1}),a(s(f),{class:"whitespace-nowrap"},{default:e(()=>[...r[17]||(r[17]=[o("平台",-1)])]),_:1}),a(s(f),{class:"whitespace-nowrap"},{default:e(()=>[...r[18]||(r[18]=[o("文本内容",-1)])]),_:1}),a(s(f),{class:"whitespace-nowrap"},{default:e(()=>[...r[19]||(r[19]=[o("提示词",-1)])]),_:1}),a(s(f),{class:"whitespace-nowrap"},{default:e(()=>[...r[20]||(r[20]=[o("机器人数量",-1)])]),_:1}),a(s(f),{class:"whitespace-nowrap"},{default:e(()=>[...r[21]||(r[21]=[o("发送成功数",-1)])]),_:1}),a(s(f),{class:"whitespace-nowrap"},{default:e(()=>[...r[22]||(r[22]=[o("发送失败数",-1)])]),_:1}),a(s(f),{class:"whitespace-nowrap text-right sticky right-0 bg-white dark:bg-gray-900 z-10"},{default:e(()=>[...r[23]||(r[23]=[o("操作",-1)])]),_:1})]),_:1})]),_:1}),a(s(re),null,{default:e(()=>[M.value?(c(),w(s(S),{key:0},{default:e(()=>[a(s(u),{colspan:11,class:"py-16 text-center text-gray-400 dark:text-white/40"},{default:e(()=>[...r[24]||(r[24]=[t("div",{class:"flex items-center justify-center gap-2"},[t("svg",{class:"animate-spin h-5 w-5 text-blue-600",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]),o(" 加载中... ")],-1)])]),_:1})]),_:1})):$.value.length?(c(!0),_(U,{key:1},O($.value,(n,v)=>(c(),w(s(S),{key:n.id},{default:e(()=>[a(s(u),{class:"whitespace-nowrap"},{default:e(()=>[o(i((y.value-1)*A.value+v+1),1)]),_:2},1024),a(s(u),{class:"whitespace-nowrap"},{default:e(()=>[o(i(s(G)(n.created_at)),1)]),_:2},1024),a(s(u),{class:"whitespace-nowrap"},{default:e(()=>[o(i(n.owner_name||"--"),1)]),_:2},1024),a(s(u),{class:"whitespace-nowrap"},{default:e(()=>[t("span",{class:te(["inline-flex items-center rounded-full px-2 py-0.5 text-xs font-medium ring-1 ring-inset",n.type==="post"?"bg-blue-50 text-blue-600 ring-blue-200 dark:bg-blue-500/10 dark:text-blue-400 dark:ring-blue-500/30":n.type==="reply_comment"?"bg-purple-50 text-purple-600 ring-purple-200 dark:bg-purple-500/10 dark:text-purple-400 dark:ring-purple-500/30":"bg-orange-50 text-orange-600 ring-orange-200 dark:bg-orange-500/10 dark:text-orange-400 dark:ring-orange-500/30"])},i(n.type==="post"?"发帖":n.type==="reply_comment"?"回复评论":n.type==="reply_mention"?"回复消息":n.type),3)]),_:2},1024),a(s(u),{class:"whitespace-nowrap"},{default:e(()=>[o(i(n.provider||"--"),1)]),_:2},1024),a(s(u),{class:"max-w-[300px] truncate",title:n.text},{default:e(()=>[o(i(n.text||"--"),1)]),_:2},1032,["title"]),a(s(u),{class:"max-w-[200px] truncate",title:n.prompt_name},{default:e(()=>[o(i(n.prompt_name||"--"),1)]),_:2},1032,["title"]),a(s(u),{class:"whitespace-nowrap"},{default:e(()=>[o(i(n.account_count||0),1)]),_:2},1024),a(s(u),{class:"whitespace-nowrap"},{default:e(()=>[t("span",_t,i(n.success_count||0),1)]),_:2},1024),a(s(u),{class:"whitespace-nowrap"},{default:e(()=>[t("span",ht,i(n.fail_count||0),1)]),_:2},1024),a(s(u),{class:"text-right whitespace-nowrap sticky right-0 bg-white dark:bg-gray-900 z-10"},{default:e(()=>[t("div",Dt,[a(C,{size:"sm",variant:"outline",onClick:H=>Se(n),class:"!text-blue-600 hover:!text-blue-700"},{default:e(()=>[...r[25]||(r[25]=[o(" 查看详情 ",-1)])]),_:1},8,["onClick"])])]),_:2},1024)]),_:2},1024))),128)):(c(),w(s(S),{key:2},{default:e(()=>[a(s(u),{colspan:10,class:"py-16 text-center text-gray-400 dark:text-white/40"},{default:e(()=>[...r[26]||(r[26]=[o("暂无数据",-1)])]),_:1})]),_:1}))]),_:1})]),_:1}),t("div",Ct,[a(s(ke),{page:y.value,"onUpdate:page":r[4]||(r[4]=n=>y.value=n),total:V.value,"items-per-page":A.value,"sibling-count":1,"show-edges":""},{default:e(()=>[a(s(be),null,{default:e(({items:n})=>[a(s(_e)),(c(!0),_(U,null,O(n,(v,H)=>(c(),_(U,{key:H},[v.type==="page"?(c(),w(s(De),{key:0,value:v.value,"is-active":v.value===y.value},{default:e(()=>[o(i(v.value),1)]),_:2},1032,["value","is-active"])):(c(),w(s(Ce),{key:1,index:H},null,8,["index"]))],64))),128)),a(s(he))]),_:1})]),_:1},8,["page","total","items-per-page"])])]),_:1}),L.value?(c(),w(oe,{key:0,fullScreenBackdrop:!0,onClose:ie},{body:e(()=>{var n,v,H,pe,ce,fe,ge,me,ve,xe;return[t("div",$t,[r[35]||(r[35]=t("h3",{class:"mb-6 text-lg font-semibold"},"任务日志详情",-1)),t("div",zt,[t("div",St,[t("div",null,[r[27]||(r[27]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-400 mb-1"},"创建时间",-1)),t("p",Vt,i(s(G)((n=b.value)==null?void 0:n.created_at)),1)]),t("div",null,[r[28]||(r[28]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-400 mb-1"},"创建用户",-1)),t("p",jt,i(((v=b.value)==null?void 0:v.owner_name)||"--"),1)])]),t("div",It,[t("div",null,[r[29]||(r[29]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-400 mb-1"},"类型",-1)),t("p",Lt,i(((H=b.value)==null?void 0:H.type)==="post"?"发帖":((pe=b.value)==null?void 0:pe.type)==="reply_comment"?"回复评论":((ce=b.value)==null?void 0:ce.type)==="reply_mention"?"回复消息":(fe=b.value)==null?void 0:fe.type),1)]),t("div",null,[r[30]||(r[30]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-400 mb-1"},"平台",-1)),t("p",Mt,i(((ge=b.value)==null?void 0:ge.provider)||"--"),1)])]),t("div",null,[r[31]||(r[31]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-400 mb-1"},"文本内容",-1)),t("p",Bt,i(((me=b.value)==null?void 0:me.text)||"--"),1)]),t("div",Pt,[t("div",null,[r[32]||(r[32]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-400 mb-1"},"机器人数量",-1)),t("p",Rt,i(((ve=b.value)==null?void 0:ve.account_count)||0),1)]),t("div",null,[r[33]||(r[33]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-400 mb-1"},"发送成功数",-1)),t("p",Ut,i(((xe=b.value)==null?void 0:xe.success_count)||0),1)])])]),t("div",Ft,[a(C,{variant:"outline",onClick:ie},{default:e(()=>[...r[34]||(r[34]=[o("关闭",-1)])]),_:1})])])]}),_:1})):ee("",!0),x.value?(c(),w(oe,{key:1,fullScreenBackdrop:!0,onClose:Y},{body:e(()=>[t("div",Tt,[t("div",{class:"flex items-center justify-between mb-4"},[r[37]||(r[37]=t("h3",{class:"text-lg font-semibold text-gray-900 dark:text-white"},"选择日期时间段",-1)),t("button",{onClick:Y,class:"text-gray-400 hover:text-gray-600 transition-colors dark:text-gray-500 dark:hover:text-gray-300"},[...r[36]||(r[36]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),t("div",At,[a(s(Oe),{modelValue:l.value,"onUpdate:modelValue":r[5]||(r[5]=n=>l.value=n),locale:"zh-CN",class:"border border-gray-200 rounded-lg dark:border-gray-700"},null,8,["modelValue"])]),t("div",Et,[t("p",Nt,[r[38]||(r[38]=o(" 已选择: ",-1)),t("span",Ht,i(d.value),1)])]),t("div",Kt,[a(C,{variant:"outline",class:"px-6 py-2 border-gray-300 text-gray-700 hover:bg-gray-50 dark:border-gray-600 dark:text-gray-300 dark:hover:bg-gray-800",onClick:Y},{default:e(()=>[...r[39]||(r[39]=[o(" 取消 ",-1)])]),_:1}),a(C,{variant:"primary",class:"px-6 py-2 bg-orange-500 hover:bg-orange-600 text-white",onClick:Be,disabled:!D.value},{default:e(()=>[...r[40]||(r[40]=[o(" 确定 ",-1)])]),_:1},8,["disabled"])])])]),_:1})):ee("",!0),a(Ae,{isOpen:ne.value,title:"删除",description:"确定要删除这条任务日志吗？此操作不可撤销。",isLoading:J.value,triggerRect:ze.value,onClose:de,onConfirm:je},null,8,["isOpen","isLoading","triggerRect"])]))]),_:1}))}}),Zt=$e(Ot,[["__scopeId","data-v-5f903d7b"]]);export{Zt as default};
