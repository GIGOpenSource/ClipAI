import{r as n,w as H,o as K,c as m,a as d,b as t,t as g,d as s,e as i,g as j,f as v,h as u,u as r,F as M,i as O,j as p,k as Q,l as W,v as X}from"./index-C_WH1cgn.js";import{_ as Y,a as Z}from"./AdminLayout-aCla68Vk.js";import{_ as ee,f as ae}from"./Primitive-rbbPGzXt.js";import{_ as z}from"./Button.vue_vue_type_script_setup_true_lang-C7mE4dwR.js";import{_ as te,a as se}from"./DeleteConfirmDialog-Dv8WvOx6.js";import{_ as re,a as le,b as R,c as A,d as oe,e as x,f as ne,g as ie,h as ue,i as de,j as ce,k as fe}from"./PaginationPrevious.vue_vue_type_script_setup_true_lang-BaJMHx_t.js";import"./http-BKvr1fmS.js";import{g as ge,u as pe,c as me,d as ve}from"./tag-DwiZTqes.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const _e={class:"space-y-5 sm:space-y-6"},ye={class:"mb-4 flex items-center justify-between"},he={class:"flex gap-2"},we={class:"flex items-center justify-end gap-2"},xe=["onClick"],be={key:0,class:"mt-4"},ke={class:"relative z-10 w-full max-w-md rounded-xl bg-white p-6 shadow-lg dark:bg-gray-900"},$e={class:"mb-4 text-lg font-semibold"},De={class:"mt-1 text-xs text-gray-500"},Ce={class:"flex justify-end gap-3 pt-2"},Te={key:1,class:"fixed top-4 right-4 bg-red-500 text-white p-2 rounded z-50"},Ve={__name:"tag",setup(Se){const I=n("话题列表"),_=n(!1),f=n(!1),b=n([]),k=n(""),L=JSON.parse(localStorage.getItem("profile")),$=n(!1),y=n(!1),D=n(!1),C=n(null),B=n({top:0,left:0,width:0,height:0}),h=n(1),N=n(20),T=n(0);n(""),n(!1);async function S(){var l,a;try{const e=await ge({page:h.value,page_size:N.value});e&&e.results&&(b.value=Array.isArray(e.results)?e.results.map(o=>({id:o.id,name:o.name,createdAt:o.created_at||o.createdAt})):[],T.value=e.count||0)}catch(e){console.error("Failed to fetch tags:",e),b.value=[],T.value=0,g.error("获取话题列表失败",{description:((a=(l=e.response)==null?void 0:l.data)==null?void 0:a.message)||e.message||"获取话题列表时发生错误"})}}const c=n({id:"",name:""});async function P(){f.value=!1,k.value="",V(),$.value=!0}async function U(l){var a,e;f.value=!0,k.value=l.id,$.value=!0;try{c.value={id:l.id,name:l.name}}catch(o){console.error("Failed to fetch tag detail:",o),g.error("获取话题详情失败",{description:((e=(a=o.response)==null?void 0:a.data)==null?void 0:e.message)||o.message||"获取话题详情时发生错误"}),c.value={id:l.id,name:l.name}}}function F(){$.value=!1,f.value=!1,k.value="",V()}function V(){c.value={id:"",name:""}}async function J(){var l,a;if(!_.value){if(!c.value.name||c.value.name.trim()===""){g.error("请填写话题名称",{description:"话题名称不能为空"});return}if(c.value.name.length>10){g.error("话题名称字数超限",{description:"话题名称最多只能输入10个字符"});return}_.value=!0;try{const e={name:c.value.name.trim()};f.value?await pe(k.value,e):await me(e),g.success(f.value?"话题更新成功":"话题新增成功"),F(),await S()}catch(e){console.error(f.value?"更新失败:":"新增失败:",e),g.error(f.value?"更新失败":"新增失败",{description:((a=(l=e.response)==null?void 0:l.data)==null?void 0:a.message)||e.message||(f.value?"更新话题时发生错误":"新增话题时发生错误")})}finally{_.value=!1}}}function q(l,a){console.log("onDelete called with:",l,a),C.value=l;const e=a.target.getBoundingClientRect();B.value={top:e.top,left:e.left,width:e.width,height:e.height,bottom:e.bottom},console.log("Setting showDeleteDialog to true, triggerRect:",B.value),y.value=!0}async function G(){var l,a;if(C.value){D.value=!0;try{await ve(C.value.id),g.success("删除成功"),await S(),E()}catch(e){console.error("删除失败:",e),g.error("删除失败",{description:((a=(l=e.response)==null?void 0:l.data)==null?void 0:a.message)||e.message||"删除话题时发生错误"})}finally{D.value=!1}}}function E(){y.value=!1,C.value=null,D.value=!1}return H(h,async l=>{var a,e;console.log("Page changed to:",l);try{await S()}catch(o){console.error("分页加载失败:",o),g.error("分页加载失败",{description:((e=(a=o.response)==null?void 0:a.data)==null?void 0:e.message)||o.message||"分页加载时发生错误"})}}),K(async()=>{await S()}),(l,a)=>(d(),m(Y,null,{default:t(()=>[s(Z,{pageTitle:I.value},null,8,["pageTitle"]),i("div",_e,[s(ee,null,{default:t(()=>[i("div",ye,[a[3]||(a[3]=i("div",{class:"flex items-center gap-3"},null,-1)),i("div",he,[s(z,{size:"sm",onClick:P},{default:t(()=>[...a[2]||(a[2]=[u("新增",-1)])]),_:1})])]),s(r(re),{class:"[&_td]:py-3.5 [&_th]:py-3.5"},{default:t(()=>[s(r(le),null,{default:t(()=>[s(r(R),null,{default:t(()=>[s(r(A),{class:"whitespace-nowrap"},{default:t(()=>[...a[4]||(a[4]=[u("序号",-1)])]),_:1}),s(r(A),{class:"whitespace-nowrap"},{default:t(()=>[...a[5]||(a[5]=[u("话题名称",-1)])]),_:1}),s(r(A),{class:"whitespace-nowrap"},{default:t(()=>[...a[6]||(a[6]=[u("创建时间",-1)])]),_:1}),s(r(A),{class:"whitespace-nowrap text-right"},{default:t(()=>[...a[7]||(a[7]=[u("操作",-1)])]),_:1})]),_:1})]),_:1}),s(r(oe),null,{default:t(()=>[b.value.length?(d(!0),v(M,{key:0},O(b.value,(e,o)=>(d(),m(r(R),{key:e.id},{default:t(()=>[s(r(x),{class:"whitespace-nowrap"},{default:t(()=>[u(p(o+1),1)]),_:2},1024),s(r(x),{class:"whitespace-nowrap"},{default:t(()=>[u(p(e.name),1)]),_:2},1024),s(r(x),{class:"whitespace-nowrap"},{default:t(()=>[u(p(r(ae)(e.createdAt)),1)]),_:2},1024),s(r(x),{class:"text-right whitespace-nowrap"},{default:t(()=>[i("div",we,[s(z,{size:"sm",variant:"outline",onClick:w=>U(e)},{default:t(()=>[...a[8]||(a[8]=[u("编辑",-1)])]),_:1},8,["onClick"]),r(L).is_staff&&r(L).is_superuser?(d(),v("button",{key:0,class:"inline-flex items-center justify-center font-medium gap-2 rounded-lg transition px-4 py-3 text-sm bg-white text-gray-700 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 dark:bg-gray-800 dark:text-gray-400 dark:ring-gray-700 dark:hover:bg-white/[0.03] dark:hover:text-gray-300 text-rose-600 ring-rose-200 hover:bg-rose-50 dark:text-rose-400 dark:ring-rose-500/30",onClick:w=>q(e,w)}," 删除 ",8,xe)):j("",!0)])]),_:2},1024)]),_:2},1024))),128)):(d(),m(r(R),{key:1},{default:t(()=>[s(r(x),{colspan:4,class:"py-16 text-center text-gray-400 dark:text-white/40"},{default:t(()=>[...a[9]||(a[9]=[u("暂无数据",-1)])]),_:1})]),_:1}))]),_:1})]),_:1}),T.value>0?(d(),v("div",be,[s(r(ne),{page:h.value,"onUpdate:page":a[0]||(a[0]=e=>h.value=e),total:T.value,"items-per-page":N.value,"sibling-count":1},{default:t(()=>[s(r(ie),null,{default:t(({items:e})=>[s(r(ue)),(d(!0),v(M,null,O(e,(o,w)=>(d(),v(M,{key:w},[o.type==="page"?(d(),m(r(de),{key:0,value:o.value,"is-active":o.value===h.value},{default:t(()=>[u(p(o.value),1)]),_:2},1032,["value","is-active"])):(d(),m(r(ce),{key:1,index:w},null,8,["index"]))],64))),128)),s(r(fe))]),_:1})]),_:1},8,["page","total","items-per-page"])])):j("",!0)]),_:1}),$.value?(d(),m(te,{key:0,fullScreenBackdrop:!0,onClose:F},{body:t(()=>[i("div",ke,[i("h3",$e,p(f.value?"编辑话题":"新增话题"),1),i("form",{onSubmit:Q(J,["prevent"]),class:"space-y-4"},[i("div",null,[a[10]||(a[10]=i("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[u("话题名称"),i("span",{class:"text-error-500"},"*"),i("span",{class:"text-gray-500 text-xs ml-1"},"(最多10个字符)")],-1)),W(i("input",{"onUpdate:modelValue":a[1]||(a[1]=e=>c.value.name=e),type:"text",placeholder:"请输入话题名称",maxlength:"10",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[X,c.value.name]]),i("div",De," 已输入: "+p(c.value.name.length)+"/10 ",1)]),i("div",Ce,[s(z,{type:"button",variant:"outline",onClick:F},{default:t(()=>[...a[11]||(a[11]=[u("取消",-1)])]),_:1}),s(z,{type:"submit",disabled:_.value},{default:t(()=>[u(p(_.value?"保存中...":"保存"),1)]),_:1},8,["disabled"])])],32)])]),_:1})):j("",!0),s(se,{isOpen:y.value,title:"删除",description:"确定要删除吗？此操作不可撤销。",isLoading:D.value,triggerRect:B.value,onClose:E,onConfirm:G},null,8,["isOpen","isLoading","triggerRect"]),y.value?(d(),v("div",Te," 弹窗应该显示: "+p(y.value),1)):j("",!0)])]),_:1}))}};export{Ve as default};
