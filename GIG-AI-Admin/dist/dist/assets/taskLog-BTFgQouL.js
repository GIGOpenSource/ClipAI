import{d as ye,r as f,f as Z,w as q,j as we,c as b,o as g,x as a,z as y,B as ee,A as e,a as t,E as o,y as s,t as d,n as te,C as H,J as X,F as R,v as K,H as U,D as Re,K as Ue}from"./index-BHC7kEdK.js";import{_ as Fe,a as Te}from"./AdminLayout-Dg6K-VCk.js";import{i as ae,_ as se,a as le,b as z,c,d as re,e as p,P as ke,f as be,g as _e,h as he,k as De,l as Ce,j as Ae}from"./DeleteConfirmDialog-DSDvSMLe.js";import{a as D,f as G,_ as oe}from"./chevron-right-GkbwViRt.js";import{l as Ee,p as Ne,a as He,t as Ke,_ as Oe}from"./home-Bt8g2g2j.js";import{_ as $e}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{h as Je}from"./index-DwLEtfjI.js";const Xe={class:"space-y-6"},qe={class:"flex items-center justify-between mb-4"},Ge={class:"mb-4"},Qe={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-4 dark:bg-gray-800 dark:border-gray-700"},We={class:"flex items-center justify-between"},Ye={class:"flex items-center gap-4"},Ze={class:"flex items-center gap-2"},et={class:"flex items-center gap-6"},tt={class:"flex items-center gap-4"},at={class:"text-sm text-emerald-600 dark:text-emerald-400 font-medium"},st={class:"text-sm text-red-600 dark:text-red-400 font-medium"},lt={class:"mt-4"},rt={class:"relative bg-white rounded-lg shadow-xl max-w-md w-full mx-4 dark:bg-gray-800"},ot={class:"p-6"},nt={class:"text-center"},it={class:"flex justify-center gap-3"},dt=ye({__name:"TaskDetail",props:{taskDetail:{}},emits:["close"],setup(O){const F=O,C=f(""),x=f(1),T=f(10),S=f(0),_=f(!1),L=f(!1),w=f([]),V=Z(()=>{const i=w.value.filter(u=>u.status==="success").length,l=w.value.filter(u=>u.status==="failed").length;return{success:i,failed:l}}),M=()=>{x.value=1,$()},B=()=>{console.log("重试按钮被点击"),console.log("失败数量:",V.value.failed),console.log("当前showRetryConfirm:",_.value),_.value=!0,console.log("设置后showRetryConfirm:",_.value)},$=async()=>{var i,l;L.value=!0;try{if(!((i=F.taskDetail)!=null&&i.id)){w.value=[],S.value=0;return}const u={simpletask_id:F.taskDetail.id,currentPage:x.value,pageSize:T.value};C.value&&C.value!=="all"&&(u.status=C.value);const h=await Ee(u);if(h&&h.results){const j=h.results||[];w.value=j.map(I=>({id:I.id||"",account:I.account||"",publish_time:I.created_at||"",status:I.success==="success"?"success":"failed",external_id:I.external_id||"",error_message:I.error_message||""})),S.value=((l=h.pagination)==null?void 0:l.total)||0}else w.value=[],S.value=0}catch(u){console.error("获取执行日志失败:",u),U.error("获取执行日志失败"),w.value=[],S.value=0}finally{L.value=!1}},A=async()=>{var i;try{_.value=!1;const l={simpletask_id:(i=F.taskDetail)==null?void 0:i.id},u=await Ne(l);u.message?U.success(u.message):U.success("已开始重新执行失败的任务"),await $()}catch(l){console.error("重新执行失败:",l),U.error("重新执行失败")}};return q(x,()=>{$()}),q(()=>F.taskDetail,i=>{i!=null&&i.id&&$()},{deep:!0}),we(()=>{$()}),(i,l)=>(g(),b("div",Xe,[a(ae,null,{default:e(()=>[t("div",qe,[l[7]||(l[7]=t("h3",{class:"text-lg font-semibold text-gray-900 dark:text-white"},"任务参数",-1)),a(D,{variant:"outline",onClick:l[0]||(l[0]=u=>i.$emit("close"))},{default:e(()=>[...l[6]||(l[6]=[o(" 返回 ",-1)])]),_:1})]),a(s(se),{class:"[&_td]:py-3.5 [&_th]:py-3.5"},{default:e(()=>[a(s(le),null,{default:e(()=>[a(s(z),null,{default:e(()=>[a(s(c),{class:"whitespace-nowrap"},{default:e(()=>[...l[8]||(l[8]=[o("序号",-1)])]),_:1}),a(s(c),{class:"whitespace-nowrap"},{default:e(()=>[...l[9]||(l[9]=[o("创建用户",-1)])]),_:1}),a(s(c),{class:"whitespace-nowrap"},{default:e(()=>[...l[10]||(l[10]=[o("类型",-1)])]),_:1}),a(s(c),{class:"whitespace-nowrap"},{default:e(()=>[...l[11]||(l[11]=[o("平台",-1)])]),_:1}),a(s(c),{class:"whitespace-nowrap"},{default:e(()=>[...l[12]||(l[12]=[o("语言",-1)])]),_:1}),a(s(c),{class:"whitespace-nowrap"},{default:e(()=>[...l[13]||(l[13]=[o("文本内容",-1)])]),_:1}),a(s(c),{class:"whitespace-nowrap"},{default:e(()=>[...l[14]||(l[14]=[o("提及",-1)])]),_:1}),a(s(c),{class:"whitespace-nowrap"},{default:e(()=>[...l[15]||(l[15]=[o("话题",-1)])]),_:1}),a(s(c),{class:"whitespace-nowrap"},{default:e(()=>[...l[16]||(l[16]=[o("提示词",-1)])]),_:1}),a(s(c),{class:"whitespace-nowrap"},{default:e(()=>[...l[17]||(l[17]=[o("备注",-1)])]),_:1}),a(s(c),{class:"whitespace-nowrap"},{default:e(()=>[...l[18]||(l[18]=[o("创建时间",-1)])]),_:1})]),_:1})]),_:1}),a(s(re),null,{default:e(()=>[i.taskDetail?(g(),y(s(z),{key:0},{default:e(()=>[a(s(p),{class:"whitespace-nowrap"},{default:e(()=>[...l[19]||(l[19]=[o("1",-1)])]),_:1}),a(s(p),{class:"whitespace-nowrap"},{default:e(()=>[o(d(i.taskDetail.owner_name||"--"),1)]),_:1}),a(s(p),{class:"whitespace-nowrap"},{default:e(()=>[t("span",{class:te(["inline-flex items-center rounded-full px-2 py-0.5 text-xs font-medium ring-1 ring-inset",i.taskDetail.type==="post"?"bg-blue-50 text-blue-600 ring-blue-200 dark:bg-blue-500/10 dark:text-blue-400 dark:ring-blue-500/30":i.taskDetail.type==="reply_comment"?"bg-purple-50 text-purple-600 ring-purple-200 dark:bg-purple-500/10 dark:text-purple-400 dark:ring-purple-500/30":"bg-orange-50 text-orange-600 ring-orange-200 dark:bg-orange-500/10 dark:text-orange-400 dark:ring-orange-500/30"])},d(i.taskDetail.type==="post"?"发帖":i.taskDetail.type==="reply_comment"?"回复评论":i.taskDetail.type==="reply_mention"?"回复消息":i.taskDetail.type),3)]),_:1}),a(s(p),{class:"whitespace-nowrap"},{default:e(()=>[o(d(i.taskDetail.provider||"--"),1)]),_:1}),a(s(p),{class:"whitespace-nowrap"},{default:e(()=>[o(d(i.taskDetail.language||"--"),1)]),_:1}),a(s(p),{class:"max-w-[200px] truncate",title:i.taskDetail.text},{default:e(()=>[o(d(i.taskDetail.text||"--"),1)]),_:1},8,["title"]),a(s(p),{class:"max-w-[150px] truncate",title:i.taskDetail.mentions},{default:e(()=>[o(d(i.taskDetail.mentions||"--"),1)]),_:1},8,["title"]),a(s(p),{class:"max-w-[150px] truncate",title:Array.isArray(i.taskDetail.tags)?i.taskDetail.tags.join(", "):i.taskDetail.tags},{default:e(()=>[o(d(Array.isArray(i.taskDetail.tags)?i.taskDetail.tags.join(", "):i.taskDetail.tags||"--"),1)]),_:1},8,["title"]),a(s(p),{class:"whitespace-nowrap"},{default:e(()=>[o(d(i.taskDetail.prompt_name||"--"),1)]),_:1}),a(s(p),{class:"whitespace-nowrap"},{default:e(()=>[o(d(i.taskDetail.task_remark||"--"),1)]),_:1}),a(s(p),{class:"whitespace-nowrap"},{default:e(()=>[o(d(s(G)(i.taskDetail.created_at)),1)]),_:1})]),_:1})):(g(),y(s(z),{key:1},{default:e(()=>[a(s(p),{colspan:11,class:"py-16 text-center text-gray-400 dark:text-white/40"},{default:e(()=>[...l[20]||(l[20]=[o(" 暂无数据 ",-1)])]),_:1})]),_:1}))]),_:1})]),_:1})]),_:1}),a(ae,null,{default:e(()=>[t("div",Ge,[l[24]||(l[24]=t("h3",{class:"text-lg font-semibold text-gray-900 dark:text-white mb-4"},"执行日志",-1)),t("div",Qe,[t("div",We,[t("div",Ye,[t("div",Ze,[l[22]||(l[22]=t("label",{class:"text-sm text-gray-600 dark:text-gray-400 whitespace-nowrap"},"发布状态",-1)),H(t("select",{"onUpdate:modelValue":l[1]||(l[1]=u=>C.value=u),onChange:M,class:"w-48 h-10 px-3 rounded-lg border border-gray-300 bg-white text-sm text-gray-800 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white dark:focus:border-blue-400 dark:focus:ring-blue-400"},[...l[21]||(l[21]=[t("option",{value:""},"请选择发布状态",-1),t("option",{value:"all"},"全部",-1),t("option",{value:"success"},"成功",-1),t("option",{value:"failed"},"失败",-1)])],544),[[X,C.value]])])]),t("div",et,[t("div",tt,[t("span",at," 成功: "+d(V.value.success),1),t("span",st," 失败: "+d(V.value.failed),1)]),a(D,{size:"sm",class:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors",onClick:B,disabled:V.value.failed===0},{default:e(()=>[...l[23]||(l[23]=[o(" 重新执行失败 ",-1)])]),_:1},8,["disabled"])])])])]),a(s(se),{class:"[&_td]:py-3.5 [&_th]:py-3.5"},{default:e(()=>[a(s(le),null,{default:e(()=>[a(s(z),null,{default:e(()=>[a(s(c),{class:"whitespace-nowrap"},{default:e(()=>[...l[25]||(l[25]=[o("ID",-1)])]),_:1}),a(s(c),{class:"whitespace-nowrap"},{default:e(()=>[...l[26]||(l[26]=[o("账号ID",-1)])]),_:1}),a(s(c),{class:"whitespace-nowrap"},{default:e(()=>[...l[27]||(l[27]=[o("发布时间",-1)])]),_:1}),a(s(c),{class:"whitespace-nowrap"},{default:e(()=>[...l[28]||(l[28]=[o("状态",-1)])]),_:1}),a(s(c),{class:"whitespace-nowrap"},{default:e(()=>[...l[29]||(l[29]=[o("外部ID",-1)])]),_:1}),a(s(c),{class:"whitespace-nowrap"},{default:e(()=>[...l[30]||(l[30]=[o("错误信息",-1)])]),_:1})]),_:1})]),_:1}),a(s(re),null,{default:e(()=>[L.value?(g(),y(s(z),{key:0},{default:e(()=>[a(s(p),{colspan:6,class:"py-16 text-center text-gray-400 dark:text-white/40"},{default:e(()=>[...l[31]||(l[31]=[t("div",{class:"flex items-center justify-center gap-2"},[t("svg",{class:"animate-spin h-5 w-5 text-blue-600",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]),o(" 加载中... ")],-1)])]),_:1})]),_:1})):w.value.length?(g(!0),b(R,{key:1},K(w.value,u=>(g(),y(s(z),{key:u.id},{default:e(()=>[a(s(p),{class:"whitespace-nowrap font-mono text-sm"},{default:e(()=>[o(d(u.id),1)]),_:2},1024),a(s(p),{class:"whitespace-nowrap font-mono text-sm"},{default:e(()=>[o(d(u.account||"--"),1)]),_:2},1024),a(s(p),{class:"whitespace-nowrap"},{default:e(()=>[o(d(s(G)(u.publish_time)),1)]),_:2},1024),a(s(p),{class:"whitespace-nowrap"},{default:e(()=>[t("span",{class:te(["inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium",u.status==="success"?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400":"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400"])},d(u.status==="success"?"成功":u.status==="failed"?"失败":u.status),3)]),_:2},1024),a(s(p),{class:"whitespace-nowrap font-mono text-sm max-w-[120px] truncate",title:u.external_id},{default:e(()=>[o(d(u.external_id||"--"),1)]),_:2},1032,["title"]),a(s(p),{class:"max-w-[200px] truncate text-red-600 dark:text-red-400",title:u.error_message},{default:e(()=>[o(d(u.error_message||"--"),1)]),_:2},1032,["title"])]),_:2},1024))),128)):(g(),y(s(z),{key:2},{default:e(()=>[a(s(p),{colspan:6,class:"py-16 text-center text-gray-400 dark:text-white/40"},{default:e(()=>[...l[32]||(l[32]=[o(" 暂无执行日志 ",-1)])]),_:1})]),_:1}))]),_:1})]),_:1}),t("div",lt,[a(s(ke),{page:x.value,"onUpdate:page":l[2]||(l[2]=u=>x.value=u),total:S.value,"items-per-page":T.value,"sibling-count":1,"show-edges":""},{default:e(()=>[a(s(be),null,{default:e(({items:u})=>[a(s(_e)),(g(!0),b(R,null,K(u,(h,j)=>(g(),b(R,{key:j},[h.type==="page"?(g(),y(s(De),{key:0,value:h.value,"is-active":h.value===x.value},{default:e(()=>[o(d(h.value),1)]),_:2},1032,["value","is-active"])):(g(),y(s(Ce),{key:1,index:j},null,8,["index"]))],64))),128)),a(s(he))]),_:1})]),_:1},8,["page","total","items-per-page"])])]),_:1}),_.value?(g(),y(oe,{key:0,onClose:l[5]||(l[5]=u=>_.value=!1)},{body:e(()=>[t("div",{class:"fixed inset-0 bg-black/50 backdrop-blur-sm",onClick:l[3]||(l[3]=u=>_.value=!1)}),t("div",rt,[t("div",ot,[t("div",nt,[l[35]||(l[35]=t("h3",{class:"text-lg font-semibold text-blue-600 dark:text-blue-400 mb-2"}," 确认重试失败任务? ",-1)),l[36]||(l[36]=t("p",{class:"text-gray-600 dark:text-gray-400 text-sm mb-6"}," 一键重新发送所有执行失败的机器人任务 (此操作仅能进行一次) ",-1)),t("div",it,[a(D,{onClick:A,class:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg text-sm font-medium"},{default:e(()=>[...l[33]||(l[33]=[o(" 确认重试 ",-1)])]),_:1}),a(D,{onClick:l[4]||(l[4]=u=>_.value=!1),variant:"outline",class:"border-blue-600 text-blue-600 hover:bg-blue-50 px-6 py-2 rounded-lg text-sm font-medium"},{default:e(()=>[...l[34]||(l[34]=[o(" 不重试 ",-1)])]),_:1})])])])])]),_:1})):ee("",!0)]))}}),ut=$e(dt,[["__scopeId","data-v-dbcc3ddc"]]),pt=O=>Je(`/tasks/logs/${O}/`),ft={key:0,class:"space-y-5 sm:space-y-6"},gt={key:1,class:"space-y-5 sm:space-y-6"},ct={class:"mb-4"},mt={class:"relative"},vt={class:"mb-4 flex items-center gap-3 flex-wrap"},xt=["value"],yt={class:"flex items-center gap-2"},wt={class:"flex items-center gap-2"},kt={key:0,class:"mr-2"},bt={key:1},_t={class:"inline-flex items-center text-emerald-600 dark:text-emerald-400 font-medium"},ht={class:"inline-flex items-center text-red-600 dark:text-red-400 font-medium"},Dt={class:"flex items-center justify-end gap-2"},Ct={class:"mt-4"},$t={class:"relative z-10 w-full max-w-3xl rounded-xl bg-white p-6 shadow-lg dark:bg-gray-900"},zt={class:"space-y-4"},St={class:"grid grid-cols-2 gap-4"},Vt={class:"text-sm text-gray-900 dark:text-white"},jt={class:"text-sm text-gray-900 dark:text-white"},It={class:"grid grid-cols-2 gap-4"},Lt={class:"text-sm text-gray-900 dark:text-white"},Mt={class:"text-sm text-gray-900 dark:text-white"},Bt={class:"text-sm text-gray-900 dark:text-white p-3 bg-gray-50 dark:bg-gray-800 rounded-lg"},Pt={class:"grid grid-cols-2 gap-4"},Rt={class:"text-sm text-gray-900 dark:text-white"},Ut={class:"text-sm text-emerald-600 dark:text-emerald-400 font-medium"},Ft={class:"flex justify-end gap-3 pt-6 mt-6 border-t border-gray-200 dark:border-gray-700"},Tt={class:"relative bg-white rounded-lg shadow-xl p-6 max-w-4xl mx-auto dark:bg-gray-900"},At={class:"mb-6"},Et={class:"mb-4 p-3 bg-gray-50 rounded-lg dark:bg-gray-800"},Nt={class:"text-sm text-gray-600 dark:text-gray-400"},Ht={class:"font-semibold text-gray-900 dark:text-white"},Kt={class:"flex justify-end gap-3"},Ot=ye({__name:"taskLog",setup(O){const F=f("任务日志"),C=f([]),x=f(1),T=f(20),S=f(0),_=f(0),L=f(!1),w=f([]),V=f(""),M=f(""),B=f(""),$=f(""),A=f(!1),i=f(!1),l=f({start:void 0,end:void 0}),u=Z(()=>{if(!l.value.start||!l.value.end)return"";const m=j(l.value.start),r=j(l.value.end);return`${m} 至 ${r}`}),h=Z(()=>l.value.start&&l.value.end),j=m=>{if(!m)return"";const r=m.year,n=String(m.month).padStart(2,"0"),v=String(m.day).padStart(2,"0");return`${r}-${n}-${v}`},I=f(!1),Q=f(!1),k=f(null),ne=f(!1),J=f(!1),W=f(null),ze=f({top:0,left:0,width:0,height:0});function Se(m){k.value=m,Q.value=!0}function ie(){I.value=!1,k.value=null}function Ve(){Q.value=!1,k.value=null}async function je(){if(W.value){J.value=!0;try{await pt(W.value.id.toString()),U.success("删除成功"),await P(),de()}catch(m){console.error("删除失败:",m);const r=m instanceof Error?m.message:"删除任务日志时发生错误";U.error("删除失败",{description:r})}finally{J.value=!1}}}function de(){ne.value=!1,W.value=null,J.value=!1}const E=async()=>{A.value=!0,x.value=1;try{await P()}finally{A.value=!1}},Ie=()=>{V.value="",M.value="",B.value="",$.value="",l.value={start:void 0,end:void 0},x.value=1,P()},Le=()=>{x.value=1,P()},Me=()=>{i.value=!0},Y=()=>{i.value=!1},Be=()=>{h.value&&(i.value=!1,E())},Pe=async()=>{try{const m=await He({});console.log(m.results,"res"),m&&m.results?w.value=m.results:w.value=[],console.log(w.value,"promptConfigs.value")}catch(m){console.error("获取提示词配置失败:",m),w.value=[]}},P=async()=>{var m,r;L.value=!0;try{const n={currentPage:x.value,pageSize:T.value,enterprise_id:localStorage.getItem("selectedUserId")||""};V.value&&(n.search=V.value),M.value&&(n.type=M.value),B.value&&(n.provider=B.value),$.value&&(n.prompt__id=parseInt($.value)),l.value.start&&l.value.end&&(n.start_date=j(l.value.start),n.end_date=j(l.value.end));const v=await Ke(n);v&&v.results?(C.value=v.results||[],S.value=((m=v.pagination)==null?void 0:m.total)||0,_.value=((r=v.pagination)==null?void 0:r.total_pages)||0):(C.value=[],S.value=0,_.value=0)}catch(n){console.error("获取任务日志失败:",n);const v=n instanceof Error?n.message:"获取任务日志时发生错误";U.error("获取列表失败",{description:v}),C.value=[],S.value=0,_.value=0}finally{L.value=!1}};q(x,()=>{P()});const ue=f(localStorage.getItem("selectedUserId")||"");return q(ue,()=>{P()}),window.addEventListener("enterprise-data-changed",()=>{ue.value=localStorage.getItem("selectedUserId")||""}),we(()=>{Pe(),P()}),(m,r)=>(g(),y(Fe,null,{default:e(()=>[a(Te,{pageTitle:F.value},null,8,["pageTitle"]),Q.value?(g(),b("div",ft,[a(ut,{taskDetail:k.value,onClose:Ve},null,8,["taskDetail"])])):(g(),b("div",gt,[a(ae,null,{default:e(()=>[t("div",ct,[t("div",mt,[H(t("input",{"onUpdate:modelValue":r[0]||(r[0]=n=>V.value=n),type:"text",placeholder:"请输入文本内容",class:"w-64 h-10 px-4 pl-10 rounded-lg border border-gray-300 bg-transparent text-sm text-gray-800 shadow-theme-xs focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:focus:border-brand-800",onKeyup:Ue(E,["enter"])},null,544),[[Re,V.value]]),r[6]||(r[6]=t("svg",{class:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1))])]),t("div",vt,[H(t("select",{"onUpdate:modelValue":r[1]||(r[1]=n=>M.value=n),onChange:E,class:"w-48 h-10 px-4 rounded-lg border border-gray-300 bg-transparent text-sm text-gray-800 shadow-theme-xs focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:focus:border-brand-800"},[...r[7]||(r[7]=[t("option",{value:""},"请选择类型",-1),t("option",{value:"post"},"发帖",-1),t("option",{value:"reply_comment"},"回复评论",-1),t("option",{value:"reply_mention"},"回复消息",-1)])],544),[[X,M.value]]),H(t("select",{"onUpdate:modelValue":r[2]||(r[2]=n=>B.value=n),onChange:E,class:"w-48 h-10 px-4 rounded-lg border border-gray-300 bg-transparent text-sm text-gray-800 shadow-theme-xs focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:focus:border-brand-800"},[...r[8]||(r[8]=[t("option",{value:""},"请选择平台",-1),t("option",{value:"twitter"},"X",-1),t("option",{value:"facebook"},"Facebook",-1),t("option",{value:"instagram"},"Instagram",-1),t("option",{value:"threads"},"Threads",-1)])],544),[[X,B.value]]),H(t("select",{"onUpdate:modelValue":r[3]||(r[3]=n=>$.value=n),onChange:E,class:"w-48 h-10 px-4 rounded-lg border border-gray-300 bg-transparent text-sm text-gray-800 shadow-theme-xs focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:focus:border-brand-800"},[r[9]||(r[9]=t("option",{value:""},"请选择提示词",-1)),(g(!0),b(R,null,K(w.value,n=>(g(),b("option",{key:n.id,value:n.id},d(n.name),9,xt))),128))],544),[[X,$.value]]),t("div",yt,[a(D,{variant:"outline",onClick:Me,class:"px-4 py-2 h-10 min-w-[220px] justify-start text-left"},{default:e(()=>[r[10]||(r[10]=t("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)),o(" "+d(u.value||"选择日期时间段"),1)]),_:1})]),t("div",wt,[a(D,{size:"sm",onClick:E,disabled:A.value,class:"bg-blue-600 hover:bg-blue-700"},{default:e(()=>[A.value?(g(),b("span",kt,"查询中...")):(g(),b("span",bt,"查询"))]),_:1},8,["disabled"]),a(D,{size:"sm",variant:"outline",onClick:Ie},{default:e(()=>[...r[11]||(r[11]=[o(" 重置 ",-1)])]),_:1}),a(D,{size:"sm",onClick:Le,variant:"outline",class:"text-red-600 hover:text-red-700 border-red-200 hover:border-red-300"},{default:e(()=>[...r[12]||(r[12]=[o(" 刷新 ",-1)])]),_:1})])]),a(s(se),{class:"[&_td]:py-3.5 [&_th]:py-3.5"},{default:e(()=>[a(s(le),null,{default:e(()=>[a(s(z),null,{default:e(()=>[a(s(c),{class:"whitespace-nowrap"},{default:e(()=>[...r[13]||(r[13]=[o("序号",-1)])]),_:1}),a(s(c),{class:"whitespace-nowrap"},{default:e(()=>[...r[14]||(r[14]=[o("创建时间",-1)])]),_:1}),a(s(c),{class:"whitespace-nowrap"},{default:e(()=>[...r[15]||(r[15]=[o("创建用户",-1)])]),_:1}),a(s(c),{class:"whitespace-nowrap"},{default:e(()=>[...r[16]||(r[16]=[o("类型",-1)])]),_:1}),a(s(c),{class:"whitespace-nowrap"},{default:e(()=>[...r[17]||(r[17]=[o("平台",-1)])]),_:1}),a(s(c),{class:"whitespace-nowrap"},{default:e(()=>[...r[18]||(r[18]=[o("文本内容",-1)])]),_:1}),a(s(c),{class:"whitespace-nowrap"},{default:e(()=>[...r[19]||(r[19]=[o("提示词",-1)])]),_:1}),a(s(c),{class:"whitespace-nowrap"},{default:e(()=>[...r[20]||(r[20]=[o("机器人数量",-1)])]),_:1}),a(s(c),{class:"whitespace-nowrap"},{default:e(()=>[...r[21]||(r[21]=[o("发送成功数",-1)])]),_:1}),a(s(c),{class:"whitespace-nowrap"},{default:e(()=>[...r[22]||(r[22]=[o("发送失败数",-1)])]),_:1}),a(s(c),{class:"whitespace-nowrap text-right sticky right-0 bg-white dark:bg-gray-900 z-10"},{default:e(()=>[...r[23]||(r[23]=[o("操作",-1)])]),_:1})]),_:1})]),_:1}),a(s(re),null,{default:e(()=>[L.value?(g(),y(s(z),{key:0},{default:e(()=>[a(s(p),{colspan:11,class:"py-16 text-center text-gray-400 dark:text-white/40"},{default:e(()=>[...r[24]||(r[24]=[t("div",{class:"flex items-center justify-center gap-2"},[t("svg",{class:"animate-spin h-5 w-5 text-blue-600",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]),o(" 加载中... ")],-1)])]),_:1})]),_:1})):C.value.length?(g(!0),b(R,{key:1},K(C.value,(n,v)=>(g(),y(s(z),{key:n.id},{default:e(()=>[a(s(p),{class:"whitespace-nowrap"},{default:e(()=>[o(d((x.value-1)*T.value+v+1),1)]),_:2},1024),a(s(p),{class:"whitespace-nowrap"},{default:e(()=>[o(d(s(G)(n.created_at)),1)]),_:2},1024),a(s(p),{class:"whitespace-nowrap"},{default:e(()=>[o(d(n.owner_name||"--"),1)]),_:2},1024),a(s(p),{class:"whitespace-nowrap"},{default:e(()=>[t("span",{class:te(["inline-flex items-center rounded-full px-2 py-0.5 text-xs font-medium ring-1 ring-inset",n.type==="post"?"bg-blue-50 text-blue-600 ring-blue-200 dark:bg-blue-500/10 dark:text-blue-400 dark:ring-blue-500/30":n.type==="reply_comment"?"bg-purple-50 text-purple-600 ring-purple-200 dark:bg-purple-500/10 dark:text-purple-400 dark:ring-purple-500/30":"bg-orange-50 text-orange-600 ring-orange-200 dark:bg-orange-500/10 dark:text-orange-400 dark:ring-orange-500/30"])},d(n.type==="post"?"发帖":n.type==="reply_comment"?"回复评论":n.type==="reply_mention"?"回复消息":n.type),3)]),_:2},1024),a(s(p),{class:"whitespace-nowrap"},{default:e(()=>[o(d(n.provider||"--"),1)]),_:2},1024),a(s(p),{class:"max-w-[300px] truncate",title:n.text},{default:e(()=>[o(d(n.text||"--"),1)]),_:2},1032,["title"]),a(s(p),{class:"max-w-[200px] truncate",title:n.prompt_name},{default:e(()=>[o(d(n.prompt_name||"--"),1)]),_:2},1032,["title"]),a(s(p),{class:"whitespace-nowrap"},{default:e(()=>[o(d(n.account_count||0),1)]),_:2},1024),a(s(p),{class:"whitespace-nowrap"},{default:e(()=>[t("span",_t,d(n.success_count||0),1)]),_:2},1024),a(s(p),{class:"whitespace-nowrap"},{default:e(()=>[t("span",ht,d(n.fail_count||0),1)]),_:2},1024),a(s(p),{class:"text-right whitespace-nowrap sticky right-0 bg-white dark:bg-gray-900 z-10"},{default:e(()=>[t("div",Dt,[a(D,{size:"sm",variant:"outline",onClick:N=>Se(n),class:"!text-blue-600 hover:!text-blue-700"},{default:e(()=>[...r[25]||(r[25]=[o(" 查看详情 ",-1)])]),_:1},8,["onClick"])])]),_:2},1024)]),_:2},1024))),128)):(g(),y(s(z),{key:2},{default:e(()=>[a(s(p),{colspan:10,class:"py-16 text-center text-gray-400 dark:text-white/40"},{default:e(()=>[...r[26]||(r[26]=[o("暂无数据",-1)])]),_:1})]),_:1}))]),_:1})]),_:1}),t("div",Ct,[a(s(ke),{page:x.value,"onUpdate:page":r[4]||(r[4]=n=>x.value=n),total:S.value,"items-per-page":T.value,"sibling-count":1,"show-edges":""},{default:e(()=>[a(s(be),null,{default:e(({items:n})=>[a(s(_e)),(g(!0),b(R,null,K(n,(v,N)=>(g(),b(R,{key:N},[v.type==="page"?(g(),y(s(De),{key:0,value:v.value,"is-active":v.value===x.value},{default:e(()=>[o(d(v.value),1)]),_:2},1032,["value","is-active"])):(g(),y(s(Ce),{key:1,index:N},null,8,["index"]))],64))),128)),a(s(he))]),_:1})]),_:1},8,["page","total","items-per-page"])])]),_:1}),I.value?(g(),y(oe,{key:0,fullScreenBackdrop:!0,onClose:ie},{body:e(()=>{var n,v,N,pe,fe,ge,ce,me,ve,xe;return[t("div",$t,[r[35]||(r[35]=t("h3",{class:"mb-6 text-lg font-semibold"},"任务日志详情",-1)),t("div",zt,[t("div",St,[t("div",null,[r[27]||(r[27]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-400 mb-1"},"创建时间",-1)),t("p",Vt,d(s(G)((n=k.value)==null?void 0:n.created_at)),1)]),t("div",null,[r[28]||(r[28]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-400 mb-1"},"创建用户",-1)),t("p",jt,d(((v=k.value)==null?void 0:v.owner_name)||"--"),1)])]),t("div",It,[t("div",null,[r[29]||(r[29]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-400 mb-1"},"类型",-1)),t("p",Lt,d(((N=k.value)==null?void 0:N.type)==="post"?"发帖":((pe=k.value)==null?void 0:pe.type)==="reply_comment"?"回复评论":((fe=k.value)==null?void 0:fe.type)==="reply_mention"?"回复消息":(ge=k.value)==null?void 0:ge.type),1)]),t("div",null,[r[30]||(r[30]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-400 mb-1"},"平台",-1)),t("p",Mt,d(((ce=k.value)==null?void 0:ce.provider)||"--"),1)])]),t("div",null,[r[31]||(r[31]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-400 mb-1"},"文本内容",-1)),t("p",Bt,d(((me=k.value)==null?void 0:me.text)||"--"),1)]),t("div",Pt,[t("div",null,[r[32]||(r[32]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-400 mb-1"},"机器人数量",-1)),t("p",Rt,d(((ve=k.value)==null?void 0:ve.account_count)||0),1)]),t("div",null,[r[33]||(r[33]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-400 mb-1"},"发送成功数",-1)),t("p",Ut,d(((xe=k.value)==null?void 0:xe.success_count)||0),1)])])]),t("div",Ft,[a(D,{variant:"outline",onClick:ie},{default:e(()=>[...r[34]||(r[34]=[o("关闭",-1)])]),_:1})])])]}),_:1})):ee("",!0),i.value?(g(),y(oe,{key:1,fullScreenBackdrop:!0,onClose:Y},{body:e(()=>[t("div",Tt,[t("div",{class:"flex items-center justify-between mb-4"},[r[37]||(r[37]=t("h3",{class:"text-lg font-semibold text-gray-900 dark:text-white"},"选择日期时间段",-1)),t("button",{onClick:Y,class:"text-gray-400 hover:text-gray-600 transition-colors dark:text-gray-500 dark:hover:text-gray-300"},[...r[36]||(r[36]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),t("div",At,[a(s(Oe),{modelValue:l.value,"onUpdate:modelValue":r[5]||(r[5]=n=>l.value=n),locale:"zh-CN",class:"border border-gray-200 rounded-lg dark:border-gray-700"},null,8,["modelValue"])]),t("div",Et,[t("p",Nt,[r[38]||(r[38]=o(" 已选择: ",-1)),t("span",Ht,d(u.value),1)])]),t("div",Kt,[a(D,{variant:"outline",class:"px-6 py-2 border-gray-300 text-gray-700 hover:bg-gray-50 dark:border-gray-600 dark:text-gray-300 dark:hover:bg-gray-800",onClick:Y},{default:e(()=>[...r[39]||(r[39]=[o(" 取消 ",-1)])]),_:1}),a(D,{variant:"primary",class:"px-6 py-2 bg-orange-500 hover:bg-orange-600 text-white",onClick:Be,disabled:!h.value},{default:e(()=>[...r[40]||(r[40]=[o(" 确定 ",-1)])]),_:1},8,["disabled"])])])]),_:1})):ee("",!0),a(Ae,{isOpen:ne.value,title:"删除",description:"确定要删除这条任务日志吗？此操作不可撤销。",isLoading:J.value,triggerRect:ze.value,onClose:de,onConfirm:je},null,8,["isOpen","isLoading","triggerRect"])]))]),_:1}))}}),Zt=$e(Ot,[["__scopeId","data-v-5f903d7b"]]);export{Zt as default};
